{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/browserify/lib/_empty.js","node_modules/d/index.js","node_modules/deferred/_ext.js","node_modules/deferred/assimilate.js","node_modules/deferred/deferred.js","node_modules/deferred/dynamic-queue.js","node_modules/deferred/ext/_process-arguments.js","node_modules/deferred/ext/array/every.js","node_modules/deferred/ext/array/find.js","node_modules/deferred/ext/array/map.js","node_modules/deferred/ext/array/reduce.js","node_modules/deferred/ext/array/some.js","node_modules/deferred/ext/function/call-async.js","node_modules/deferred/ext/function/delay.js","node_modules/deferred/ext/function/gate.js","node_modules/deferred/ext/function/promisify-sync.js","node_modules/deferred/ext/function/promisify.js","node_modules/deferred/ext/promise/_array.js","node_modules/deferred/ext/promise/aside.js","node_modules/deferred/ext/promise/catch.js","node_modules/deferred/ext/promise/cb.js","node_modules/deferred/ext/promise/finally.js","node_modules/deferred/ext/promise/get.js","node_modules/deferred/ext/promise/invoke-async.js","node_modules/deferred/ext/promise/invoke.js","node_modules/deferred/ext/promise/map.js","node_modules/deferred/ext/promise/reduce.js","node_modules/deferred/ext/promise/some.js","node_modules/deferred/ext/promise/spread.js","node_modules/deferred/index.js","node_modules/deferred/invoke-async.js","node_modules/deferred/is-promise.js","node_modules/deferred/lib/some-every.js","node_modules/deferred/monitor.js","node_modules/deferred/profiler.js","node_modules/deferred/valid-promise.js","node_modules/es5-ext/array/from/index.js","node_modules/es5-ext/array/from/is-implemented.js","node_modules/es5-ext/array/from/shim.js","node_modules/es5-ext/array/of/index.js","node_modules/es5-ext/array/of/is-implemented.js","node_modules/es5-ext/array/of/shim.js","node_modules/es5-ext/array/to-array.js","node_modules/es5-ext/error/is-error.js","node_modules/es5-ext/function/#/partial.js","node_modules/es5-ext/function/#/spread.js","node_modules/es5-ext/function/_define-length.js","node_modules/es5-ext/function/is-arguments.js","node_modules/es5-ext/function/is-function.js","node_modules/es5-ext/function/noop.js","node_modules/es5-ext/iterable/is.js","node_modules/es5-ext/iterable/validate-object.js","node_modules/es5-ext/math/sign/index.js","node_modules/es5-ext/math/sign/is-implemented.js","node_modules/es5-ext/math/sign/shim.js","node_modules/es5-ext/number/to-integer.js","node_modules/es5-ext/number/to-pos-integer.js","node_modules/es5-ext/object/_iterate.js","node_modules/es5-ext/object/assign/index.js","node_modules/es5-ext/object/assign/is-implemented.js","node_modules/es5-ext/object/assign/shim.js","node_modules/es5-ext/object/for-each.js","node_modules/es5-ext/object/is-array-like.js","node_modules/es5-ext/object/is-callable.js","node_modules/es5-ext/object/is-object.js","node_modules/es5-ext/object/keys/index.js","node_modules/es5-ext/object/keys/is-implemented.js","node_modules/es5-ext/object/keys/shim.js","node_modules/es5-ext/object/mixin.js","node_modules/es5-ext/object/normalize-options.js","node_modules/es5-ext/object/valid-callable.js","node_modules/es5-ext/object/valid-object.js","node_modules/es5-ext/object/valid-value.js","node_modules/es5-ext/string/#/contains/index.js","node_modules/es5-ext/string/#/contains/is-implemented.js","node_modules/es5-ext/string/#/contains/shim.js","node_modules/es5-ext/string/#/pad.js","node_modules/es5-ext/string/#/repeat/index.js","node_modules/es5-ext/string/#/repeat/is-implemented.js","node_modules/es5-ext/string/#/repeat/shim.js","node_modules/es5-ext/string/is-string.js","node_modules/es6-promise/dist/es6-promise.js","node_modules/es6-symbol/index.js","node_modules/es6-symbol/is-implemented.js","node_modules/es6-symbol/is-symbol.js","node_modules/es6-symbol/polyfill.js","node_modules/es6-symbol/validate-symbol.js","node_modules/event-emitter/index.js","node_modules/event-emitter/unify.js","node_modules/next-tick/index.js","node_modules/process/browser.js","node_modules/spark-md5/spark-md5.js","node_modules/striptags/striptags.js","node_modules/timers-ext/max-timeout.js","node_modules/timers-ext/valid-timeout.js","src/Ajax.js","src/ApiObject.js","src/ApiResponse.js","src/Base.js","src/Cache.js","src/Client.js","src/Collection.js","src/Collections.js","src/Container.js","src/Deleted.js","src/File.js","src/Group.js","src/Groups.js","src/Idb.js","src/Item.js","src/ItemMaps.js","src/Items.js","src/Library.js","src/Localizations.js","src/Log.js","src/MultiFetch.js","src/Net.js","src/Preferences.js","src/Search.js","src/Searches.js","src/Tag.js","src/Tags.js","src/Url.js","src/User.js","src/Utils.js","src/libzotero.js"],"names":[],"mappings":"AAAA;ACAA;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9BA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChJA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACVA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1GA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACTA;AACA;AACA;AACA;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACTA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7BA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtBA;AACA;AACA;AACA;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACdA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACPA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;;ACNA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClBA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AC/7BA;AACA;AACA;AACA;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClBA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AClDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/rBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA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","file":"libzotero.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","","'use strict';\n\nvar assign        = require('es5-ext/object/assign')\n  , normalizeOpts = require('es5-ext/object/normalize-options')\n  , isCallable    = require('es5-ext/object/is-callable')\n  , contains      = require('es5-ext/string/#/contains')\n\n  , d;\n\nd = module.exports = function (dscr, value/*, options*/) {\n\tvar c, e, w, options, desc;\n\tif ((arguments.length < 2) || (typeof dscr !== 'string')) {\n\t\toptions = value;\n\t\tvalue = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[2];\n\t}\n\tif (dscr == null) {\n\t\tc = w = true;\n\t\te = false;\n\t} else {\n\t\tc = contains.call(dscr, 'c');\n\t\te = contains.call(dscr, 'e');\n\t\tw = contains.call(dscr, 'w');\n\t}\n\n\tdesc = { value: value, configurable: c, enumerable: e, writable: w };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n};\n\nd.gs = function (dscr, get, set/*, options*/) {\n\tvar c, e, options, desc;\n\tif (typeof dscr !== 'string') {\n\t\toptions = set;\n\t\tset = get;\n\t\tget = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[3];\n\t}\n\tif (get == null) {\n\t\tget = undefined;\n\t} else if (!isCallable(get)) {\n\t\toptions = get;\n\t\tget = set = undefined;\n\t} else if (set == null) {\n\t\tset = undefined;\n\t} else if (!isCallable(set)) {\n\t\toptions = set;\n\t\tset = undefined;\n\t}\n\tif (dscr == null) {\n\t\tc = true;\n\t\te = false;\n\t} else {\n\t\tc = contains.call(dscr, 'c');\n\t\te = contains.call(dscr, 'e');\n\t}\n\n\tdesc = { get: get, set: set, configurable: c, enumerable: e };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n};\n","'use strict';\n\nvar callable   = require('es5-ext/object/valid-callable')\n  , d          = require('d')\n  , isCallable = require('es5-ext/object/is-callable')\n  , ee         = require('event-emitter')\n  , isPromise  = require('./is-promise')\n\n  , create = Object.create, defineProperty = Object.defineProperty\n  , deferred, resolve, reject;\n\nmodule.exports = exports = function (name, unres, onres, res) {\n\tname = String(name);\n\t(callable(res) && ((onres == null) || callable(onres)) && callable(unres));\n\tdefineProperty(exports._unresolved, name, d(unres));\n\texports._onresolve[name] = onres;\n\tdefineProperty(exports._resolved, name, d(res));\n\texports._names.push(name);\n};\n\nexports._names = ['done', 'then', 'valueOf'];\n\nexports._unresolved = ee(create(Function.prototype, {\n\tthen: d(function (win, fail) {\n\t\tvar def;\n\t\tif (!this.pending) this.pending = [];\n\t\tdef = deferred();\n\t\tthis.pending.push('then', [win, fail, def.resolve, def.reject]);\n\t\treturn def.promise;\n\t}),\n\tdone: d(function (win, fail) {\n\t\t((win == null) || callable(win));\n\t\t((fail == null) || callable(fail));\n\t\tif (!this.pending) this.pending = [];\n\t\tthis.pending.push('done', arguments);\n\t}),\n\tresolved: d(false),\n\treturnsPromise: d(true),\n\tvalueOf: d(function () { return this; })\n}));\n\nexports._onresolve = {\n\tthen: function (win, fail, resolve, reject) {\n\t\tvar value, cb = this.failed ? fail : win;\n\t\tif (cb == null) {\n\t\t\tif (this.failed) reject(this.value);\n\t\t\telse resolve(this.value);\n\t\t\treturn;\n\t\t}\n\t\tif (isCallable(cb)) {\n\t\t\tif (isPromise(cb)) {\n\t\t\t\tif (cb.resolved) {\n\t\t\t\t\tif (cb.failed) reject(cb.value);\n\t\t\t\t\telse resolve(cb.value);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tcb.done(resolve, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttry { value = cb(this.value); } catch (e) {\n\t\t\t\treject(e);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tresolve(value);\n\t\t\treturn;\n\t\t}\n\t\tresolve(cb);\n\t},\n\tdone: function (win, fail) {\n\t\tif (this.failed) {\n\t\t\tif (fail) {\n\t\t\t\tfail(this.value);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthrow this.value;\n\t\t}\n\t\tif (win) win(this.value);\n\t}\n};\n\nexports._resolved = ee(create(Function.prototype, {\n\tthen: d(function (win, fail) {\n\t\tvar value, cb = this.failed ? fail : win;\n\t\tif (cb == null) return this;\n\t\tif (isCallable(cb)) {\n\t\t\tif (isPromise(cb)) return cb;\n\t\t\ttry { value = cb(this.value); } catch (e) { return reject(e); }\n\t\t\treturn resolve(value);\n\t\t}\n\t\treturn resolve(cb);\n\t}),\n\tdone: d(function (win, fail) {\n\t\t((win == null) || callable(win));\n\t\t((fail == null) || callable(fail));\n\t\tif (this.failed) {\n\t\t\tif (fail) {\n\t\t\t\tfail(this.value);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthrow this.value;\n\t\t}\n\t\tif (win) win(this.value);\n\t}),\n\tresolved: d(true),\n\treturnsPromise: d(true),\n\tvalueOf: d(function () { return this.value; })\n}));\n\ndeferred = require('./deferred');\nresolve = deferred.resolve;\nreject = deferred.reject;\ndeferred.extend = exports;\n","// Assimilate eventual foreign promise\n\n'use strict';\n\nvar isObject  = require('es5-ext/object/is-object')\n  , isPromise = require('./is-promise')\n  , deferred  = require('./deferred')\n  , nextTick  = require('next-tick')\n\n  , getPrototypeOf = Object.getPrototypeOf;\n\nmodule.exports = function self(value) {\n\tvar then, done, def, resolve, reject;\n\tif (!value) return value;\n\ttry {\n\t\tthen = value.then;\n\t} catch (e) {\n\t\treturn value;\n\t}\n\tif (typeof then !== 'function') return value;\n\tif (isPromise(value)) return value;\n\tif (!isObject(value)) return value;\n\tif (!getPrototypeOf(value)) return value;\n\ttry {\n\t\tdone = value.done;\n\t} catch (ignore) {}\n\tdef = deferred();\n\tresolve = function (value) { def.resolve(self(value)); };\n\treject = function (value) { def.reject(value); };\n\tif (typeof done === 'function') {\n\t\ttry {\n\t\t\tdone.call(value, resolve, reject);\n\t\t} catch (e) {\n\t\t\treturn def.reject(e);\n\t\t}\n\t\treturn def.promise;\n\t}\n\ttry {\n\t\tthen.call(value, function (value) { nextTick(function () {\n\t\t\tresolve(value);\n\t\t}); }, function (value) { nextTick(function () {\n\t\t\treject(value);\n\t\t}); });\n\t} catch (e) {\n\t\treturn def.reject(e);\n\t}\n\treturn def.promise;\n};\n","// Returns function that returns deferred or promise object.\n//\n// 1. If invoked without arguments then deferred object is returned\n//    Deferred object consist of promise (unresolved) function and resolve\n//    function through which we resolve promise\n// 2. If invoked with one argument then promise is returned which resolved value\n//    is given argument. Argument may be any value (even undefined),\n//    if it's promise then same promise is returned\n// 3. If invoked with more than one arguments then promise that resolves with\n//    array of all resolved arguments is returned.\n\n'use strict';\n\nvar isError    = require('es5-ext/error/is-error')\n  , noop       = require('es5-ext/function/noop')\n  , isPromise  = require('./is-promise')\n\n  , every = Array.prototype.every, push = Array.prototype.push\n\n  , Deferred, createDeferred, count = 0, timeout, extendShim, ext\n  , protoSupported = Boolean(isPromise.__proto__)\n  , resolve, assimilate;\n\nextendShim = function (promise) {\n\text._names.forEach(function (name) {\n\t\tpromise[name] = function () {\n\t\t\treturn promise.__proto__[name].apply(promise, arguments);\n\t\t};\n\t});\n\tpromise.returnsPromise = true;\n\tpromise.resolved = promise.__proto__.resolved;\n};\n\nresolve = function (value, failed) {\n\tvar promise = function (win, fail) { return promise.then(win, fail); };\n\tpromise.value = value;\n\tpromise.failed = failed;\n\tpromise.__proto__ = ext._resolved;\n\tif (!protoSupported) { extendShim(promise); }\n\tif (createDeferred._profile) createDeferred._profile(true);\n\treturn promise;\n};\n\nDeferred = function () {\n\tvar promise = function (win, fail) { return promise.then(win, fail); };\n\tif (!count) timeout = setTimeout(noop, 1e9);\n\t++count;\n\tif (createDeferred._monitor) promise.monitor = createDeferred._monitor();\n\tpromise.__proto__ = ext._unresolved;\n\tif (!protoSupported) extendShim(promise);\n\t(createDeferred._profile && createDeferred._profile());\n\tthis.promise = promise;\n\tthis.resolve = this.resolve.bind(this);\n\tthis.reject = this.reject.bind(this);\n};\n\nDeferred.prototype = {\n\tresolved: false,\n\t_settle: function (value) {\n\t\tvar i, name, data, deps, dPromise, nuDeps;\n\t\tthis.promise.value = value;\n\t\tthis.promise.__proto__ = ext._resolved;\n\t\tif (!protoSupported) this.promise.resolved = true;\n\t\tdeps = this.promise.dependencies;\n\t\tdelete this.promise.dependencies;\n\t\twhile (deps) {\n\t\t\tfor (i = 0; (dPromise = deps[i]); ++i) {\n\t\t\t\tdPromise.value = value;\n\t\t\t\tdPromise.failed = this.failed;\n\t\t\t\tdPromise.__proto__ = ext._resolved;\n\t\t\t\tif (!protoSupported) dPromise.resolved = true;\n\t\t\t\tdelete dPromise.pending;\n\t\t\t\tif (dPromise.dependencies) {\n\t\t\t\t\tif (!nuDeps) nuDeps = dPromise.dependencies;\n\t\t\t\t\telse push.apply(nuDeps, dPromise.dependencies);\n\t\t\t\t\tdelete dPromise.dependencies;\n\t\t\t\t}\n\t\t\t}\n\t\t\tdeps = nuDeps;\n\t\t\tnuDeps = null;\n\t\t}\n\t\tif ((data = this.promise.pending)) {\n\t\t\tfor (i = 0; (name = data[i]); ++i) {\n\t\t\t\text._onresolve[name].apply(this.promise, data[++i]);\n\t\t\t}\n\t\t\tdelete this.promise.pending;\n\t\t}\n\t\treturn this.promise;\n\t},\n\tresolve: function (value) {\n\t\tif (this.resolved) return this.promise;\n\t\tthis.resolved = true;\n\t\tif (!--count) clearTimeout(timeout);\n\t\tif (this.promise.monitor) clearTimeout(this.promise.monitor);\n\t\tvalue = assimilate(value);\n\t\tif (isPromise(value)) {\n\t\t\tif (!value.resolved) {\n\t\t\t\tif (!value.dependencies) {\n\t\t\t\t\tvalue.dependencies = [];\n\t\t\t\t}\n\t\t\t\tvalue.dependencies.push(this.promise);\n\t\t\t\tif (this.promise.pending) {\n\t\t\t\t\tif (value.pending) {\n\t\t\t\t\t\tpush.apply(value.pending, this.promise.pending);\n\t\t\t\t\t\tthis.promise.pending = value.pending;\n\t\t\t\t\t\tif (this.promise.dependencies) {\n\t\t\t\t\t\t\tthis.promise.dependencies.forEach(function self(dPromise) {\n\t\t\t\t\t\t\t\tdPromise.pending = value.pending;\n\t\t\t\t\t\t\t\tif (dPromise.dependencies) {\n\t\t\t\t\t\t\t\t\tdPromise.dependencies.forEach(self);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalue.pending = this.promise.pending;\n\t\t\t\t\t}\n\t\t\t\t} else if (value.pending) {\n\t\t\t\t\tthis.promise.pending = value.pending;\n\t\t\t\t} else {\n\t\t\t\t\tthis.promise.pending = value.pending = [];\n\t\t\t\t}\n\t\t\t\treturn this.promise;\n\t\t\t}\n\t\t\tthis.promise.failed = value.failed;\n\t\t\tvalue = value.value;\n\t\t}\n\t\treturn this._settle(value);\n\t},\n\treject: function (error) {\n\t\tif (this.resolved) return this.promise;\n\t\tthis.resolved = true;\n\t\tif (!--count) clearTimeout(timeout);\n\t\tif (this.promise.monitor) clearTimeout(this.promise.monitor);\n\t\tthis.promise.failed = true;\n\t\treturn this._settle(error);\n\t}\n};\n\nmodule.exports = createDeferred = function (value) {\n\tvar l = arguments.length, d, waiting, initialized, result;\n\tif (!l) return new Deferred();\n\tif (l > 1) {\n\t\td = new Deferred();\n\t\twaiting = 0;\n\t\tresult = new Array(l);\n\t\tevery.call(arguments, function (value, index) {\n\t\t\tvalue = assimilate(value);\n\t\t\tif (!isPromise(value)) {\n\t\t\t\tresult[index] = value;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (value.resolved) {\n\t\t\t\tif (value.failed) {\n\t\t\t\t\td.reject(value.value);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tresult[index] = value.value;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t++waiting;\n\t\t\tvalue.done(function (value) {\n\t\t\t\tresult[index] = value;\n\t\t\t\tif (!--waiting && initialized) d.resolve(result);\n\t\t\t}, d.reject);\n\t\t\treturn true;\n\t\t});\n\t\tinitialized = true;\n\t\tif (!waiting) d.resolve(result);\n\t\treturn d.promise;\n\t}\n\tvalue = assimilate(value);\n\tif (isPromise(value)) return value;\n\treturn resolve(value, isError(value));\n};\n\ncreateDeferred.Deferred = Deferred;\ncreateDeferred.reject = function (value) { return resolve(value, true); };\ncreateDeferred.resolve = function (value) {\n\tvalue = assimilate(value);\n\tif (isPromise(value)) return value;\n\treturn resolve(value, false);\n};\next = require('./_ext');\nassimilate = require('./assimilate');\n","// Dynamic queue handler\n// Allows to create a promise queue, where new promises can be added to queue until last promise in\n// a queue resolves. Queue promise resolves with `undefined` value, when last promises resolves.\n\n'use strict';\n\nvar aFrom          = require('es5-ext/array/from')\n  , ensureIterable = require('es5-ext/iterable/validate-object')\n  , assign         = require('es5-ext/object/assign')\n  , deferred       = require('./deferred')\n  , isPromise      = require('./is-promise')\n  , assimilate     = require('./assimilate')\n\n  , DynamicQueue;\n\nmodule.exports = DynamicQueue = function (list) {\n\tif (!(this instanceof DynamicQueue)) return new DynamicQueue(list);\n\tlist = aFrom(ensureIterable(list));\n\n\tassign(this, deferred());\n\tlist.every(this.add, this);\n\tif (!this.waiting) {\n\t\tthis.resolve();\n\t\treturn;\n\t}\n\tthis.initialized = true;\n};\n\nDynamicQueue.prototype = {\n\twaiting: 0,\n\tinitialized: false,\n\tadd: function (value) {\n\t\tif (this.promise.resolved) throw new Error(\"Queue was already resolved\");\n\t\t++this.waiting;\n\t\tvalue = assimilate(value);\n\t\tif (isPromise(value)) {\n\t\t\tif (!value.resolved) {\n\t\t\t\tvalue.done(this._processValue.bind(this), this.reject);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (value.failed) {\n\t\t\t\tthis.reject(value.value);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn this._processValue();\n\t},\n\t_processValue: function () {\n\t\tif (this.promise.resolved) return;\n\t\tif (!--this.waiting && this.initialized) this.resolve();\n\t\treturn true;\n\t}\n};\n","'use strict';\n\nvar arrayOf    = require('es5-ext/array/of')\n  , deferred   = require('../deferred')\n  , isPromise  = require('../is-promise')\n  , assimilate = require('../assimilate')\n\n  , push = Array.prototype.push, slice = Array.prototype.slice;\n\nmodule.exports = function (args, length) {\n\tvar i, l, arg;\n\tif ((length != null) && (args.length !== length)) {\n\t\targs = slice.call(args, 0, length);\n\t\tif (args.length < length) {\n\t\t\tpush.apply(args, new Array(length - args.length));\n\t\t}\n\t}\n\tfor (i = 0, l = args.length; i < l; ++i) {\n\t\targ = assimilate(args[i]);\n\t\tif (isPromise(arg)) {\n\t\t\tif (!arg.resolved) {\n\t\t\t\tif (l > 1) return deferred.apply(null, args);\n\t\t\t\treturn arg(arrayOf);\n\t\t\t}\n\t\t\tif (arg.failed) return arg;\n\t\t\targs[i] = arg.value;\n\t\t}\n\t}\n\treturn args;\n};\n","// Promise aware Array's every\n\n'use strict';\n\nmodule.exports = require('../../lib/some-every')(false);\n","// Promise aware Array's find\n// Additionally differs from some that it returns *first in order* item that matches constraint\n\n'use strict';\n\nvar assign     = require('es5-ext/object/assign')\n  , value      = require('es5-ext/object/valid-value')\n  , callable   = require('es5-ext/object/valid-callable')\n  , deferred   = require('../../deferred')\n  , isPromise  = require('../../is-promise')\n  , assimilate = require('../../assimilate')\n\n  , call = Function.prototype.call\n  , resolve = deferred.resolve\n  , Find;\n\nFind = function (list, cb, context) {\n\tthis.list = list;\n\tthis.cb = cb;\n\tthis.context = context;\n\tthis.length = list.length >>> 0;\n\n\twhile (this.current < this.length) {\n\t\tif (this.current in list) {\n\t\t\tassign(this, deferred());\n\t\t\tthis.processCb = this.processCb.bind(this);\n\t\t\tthis.process();\n\t\t\treturn this.promise;\n\t\t}\n\t\t++this.current;\n\t}\n\treturn resolve(undefined);\n};\n\nFind.prototype = {\n\tcurrent: 0,\n\tprocess: function () {\n\t\tvar value = assimilate(this.list[this.current]);\n\t\tif (isPromise(value)) {\n\t\t\tif (!value.resolved) {\n\t\t\t\tvalue.done(this.processCb, this.reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (value.failed) {\n\t\t\t\tthis.reject(value.value);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvalue = value.value;\n\t\t}\n\t\tthis.processCb(value);\n\t},\n\tprocessCb: function (listValue) {\n\t\tvar value;\n\t\tif (this.cb) {\n\t\t\ttry {\n\t\t\t\tvalue = call.call(this.cb, this.context, listValue, this.current, this.list);\n\t\t\t} catch (e) {\n\t\t\t\tthis.reject(e);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvalue = assimilate(value);\n\t\t\tif (isPromise(value)) {\n\t\t\t\tif (!value.resolved) {\n\t\t\t\t\tvalue.done(this.processValue.bind(this, listValue), this.reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (value.failed) {\n\t\t\t\t\tthis.reject(value.value);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvalue = value.value;\n\t\t\t}\n\t\t} else {\n\t\t\tvalue = listValue;\n\t\t}\n\t\tthis.processValue(listValue, value);\n\t},\n\tprocessValue: function (listValue, value) {\n\t\tif (value) {\n\t\t\tthis.resolve(listValue);\n\t\t\treturn;\n\t\t}\n\t\twhile (++this.current < this.length) {\n\t\t\tif (this.current in this.list) {\n\t\t\t\tthis.process();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis.resolve(undefined);\n\t}\n};\n\nmodule.exports = function (cb/*, thisArg*/) {\n\tvalue(this);\n\t((cb == null) || callable(cb));\n\n\treturn new Find(this, cb, arguments[1]);\n};\n","// Promise aware Array's map\n\n'use strict';\n\nvar assign     = require('es5-ext/object/assign')\n  , value      = require('es5-ext/object/valid-value')\n  , callable   = require('es5-ext/object/valid-callable')\n  , deferred   = require('../../deferred')\n  , isPromise  = require('../../is-promise')\n  , assimilate = require('../../assimilate')\n\n  , every = Array.prototype.every\n  , call = Function.prototype.call\n\n  , DMap;\n\nDMap = function (list, cb, context) {\n\tthis.list = list;\n\tthis.cb = cb;\n\tthis.context = context;\n\tthis.result = new Array(list.length >>> 0);\n\n\tassign(this, deferred());\n\tevery.call(list, this.process, this);\n\tif (!this.waiting) return this.resolve(this.result);\n\tthis.initialized = true;\n\n\treturn this.promise;\n};\n\nDMap.prototype = {\n\twaiting: 0,\n\tinitialized: false,\n\tprocess: function (value, index) {\n\t\t++this.waiting;\n\t\tvalue = assimilate(value);\n\t\tif (isPromise(value)) {\n\t\t\tif (!value.resolved) {\n\t\t\t\tvalue.done(this.processCb.bind(this, index), this.reject);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (value.failed) {\n\t\t\t\tthis.reject(value.value);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvalue = value.value;\n\t\t}\n\t\treturn this.processCb(index, value);\n\t},\n\tprocessCb: function (index, value) {\n\t\tif (this.promise.resolved) return false;\n\t\tif (this.cb) {\n\t\t\ttry {\n\t\t\t\tvalue = call.call(this.cb, this.context, value, index, this.list);\n\t\t\t} catch (e) {\n\t\t\t\tthis.reject(e);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvalue = assimilate(value);\n\t\t\tif (isPromise(value)) {\n\t\t\t\tif (!value.resolved) {\n\t\t\t\t\tvalue.done(this.processValue.bind(this, index), this.reject);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tif (value.failed) {\n\t\t\t\t\tthis.reject(value.value);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tvalue = value.value;\n\t\t\t}\n\t\t}\n\t\tthis.processValue(index, value);\n\t\treturn true;\n\t},\n\tprocessValue: function (index, value) {\n\t\tif (this.promise.resolved) return;\n\t\tthis.result[index] = value;\n\t\tif (!--this.waiting && this.initialized) this.resolve(this.result);\n\t}\n};\n\nmodule.exports = function (cb/*, thisArg*/) {\n\tvalue(this);\n\t((cb == null) || callable(cb));\n\n\treturn new DMap(this, cb, arguments[1]);\n};\n","// Promise aware Array's reduce\n\n'use strict';\n\nvar assign     = require('es5-ext/object/assign')\n  , value      = require('es5-ext/object/valid-value')\n  , callable   = require('es5-ext/object/valid-callable')\n  , deferred   = require('../../deferred')\n  , isPromise  = require('../../is-promise')\n  , assimilate = require('../../assimilate')\n\n  , call = Function.prototype.call\n  , hasOwnProperty = Object.prototype.hasOwnProperty\n  , resolve = deferred.resolve\n  , Reduce;\n\nReduce = function (list, cb, initial, initialized) {\n\tthis.list = list;\n\tthis.cb = cb;\n\tthis.initialized = initialized;\n\tthis.length = list.length >>> 0;\n\n\tinitial = assimilate(initial);\n\tif (isPromise(initial)) {\n\t\tif (!initial.resolved) {\n\t\t\tassign(this, deferred());\n\t\t\tinitial.done(function (initial) {\n\t\t\t\tthis.value = initial;\n\t\t\t\tthis.init();\n\t\t\t}.bind(this), this.reject);\n\t\t\treturn this.promise;\n\t\t}\n\t\tthis.value = initial.value;\n\t\tif (initial.failed) return initial;\n\t} else {\n\t\tthis.value = initial;\n\t}\n\n\treturn this.init();\n};\n\nReduce.prototype = {\n\tcurrent: 0,\n\tstate: false,\n\tinit: function () {\n\t\twhile (this.current < this.length) {\n\t\t\tif (hasOwnProperty.call(this.list, this.current)) break;\n\t\t\t++this.current;\n\t\t}\n\t\tif (this.current === this.length) {\n\t\t\tif (!this.initialized) {\n\t\t\t\tthrow new Error(\"Reduce of empty array with no initial value\");\n\t\t\t}\n\t\t\treturn this.resolve ? this.resolve(this.value) : resolve(this.value);\n\t\t}\n\t\tif (!this.promise) assign(this, deferred());\n\t\tthis.processCb = this.processCb.bind(this);\n\t\tthis.processValue = this.processValue.bind(this);\n\t\tthis.continue();\n\t\treturn this.promise;\n\t},\n\tcontinue: function () {\n\t\tvar result;\n\t\twhile (!this.state) {\n\t\t\tresult = this.process();\n\t\t\tif (this.state !== 'cb') break;\n\t\t\tresult = this.processCb(result);\n\t\t\tif (this.state !== 'value') break;\n\t\t\tthis.processValue(result);\n\t\t}\n\t},\n\tprocess: function () {\n\t\tvar value = assimilate(this.list[this.current]);\n\t\tif (isPromise(value)) {\n\t\t\tif (!value.resolved) {\n\t\t\t\tvalue.done(function (result) {\n\t\t\t\t\tresult = this.processCb(result);\n\t\t\t\t\tif (this.state !== 'value') return;\n\t\t\t\t\tthis.processValue(result);\n\t\t\t\t\tif (!this.state) this.continue();\n\t\t\t\t}.bind(this), this.reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (value.failed) {\n\t\t\t\tthis.reject(value.value);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvalue = value.value;\n\t\t}\n\t\tthis.state = 'cb';\n\t\treturn value;\n\t},\n\tprocessCb: function (value) {\n\t\tif (!this.initialized) {\n\t\t\tthis.initialized = true;\n\t\t\tthis.state = 'value';\n\t\t\treturn value;\n\t\t}\n\t\tif (this.cb) {\n\t\t\ttry {\n\t\t\t\tvalue = call.call(this.cb, undefined, this.value, value, this.current,\n\t\t\t\t\tthis.list);\n\t\t\t} catch (e) {\n\t\t\t\tthis.reject(e);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvalue = assimilate(value);\n\t\t\tif (isPromise(value)) {\n\t\t\t\tif (!value.resolved) {\n\t\t\t\t\tvalue.done(function (result) {\n\t\t\t\t\t\tthis.state = 'value';\n\t\t\t\t\t\tthis.processValue(result);\n\t\t\t\t\t\tif (!this.state) this.continue();\n\t\t\t\t\t}.bind(this), this.reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (value.failed) {\n\t\t\t\t\tthis.reject(value.value);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvalue = value.value;\n\t\t\t}\n\t\t}\n\t\tthis.state = 'value';\n\t\treturn value;\n\t},\n\tprocessValue: function (value) {\n\t\tthis.value = value;\n\t\twhile (++this.current < this.length) {\n\t\t\tif (hasOwnProperty.call(this.list, this.current)) {\n\t\t\t\tthis.state = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis.resolve(this.value);\n\t}\n};\n\nmodule.exports = function (cb/*, initial*/) {\n\tvalue(this);\n\t((cb == null) || callable(cb));\n\n\treturn new Reduce(this, cb, arguments[1], arguments.length > 1);\n};\n","// Promise aware Array's some\n\n'use strict';\n\nmodule.exports = require('../../lib/some-every')(true);\n","// Call asynchronous function\n\n'use strict';\n\nvar toArray          = require('es5-ext/array/to-array')\n  , callable         = require('es5-ext/object/valid-callable')\n  , deferred         = require('../../deferred')\n  , isPromise        = require('../../is-promise')\n  , processArguments = require('../_process-arguments')\n\n  , slice = Array.prototype.slice, apply = Function.prototype.apply\n\n  , applyFn, callAsync;\n\napplyFn = function (fn, args, def) {\n\targs = toArray(args);\n\tapply.call(fn,  this, args.concat(function (error, result) {\n\t\tif (error == null) {\n\t\t\tdef.resolve((arguments.length > 2) ? slice.call(arguments, 1) : result);\n\t\t} else {\n\t\t\tdef.reject(error);\n\t\t}\n\t}));\n};\n\ncallAsync = function (fn, length, context, args) {\n\tvar def;\n\targs = processArguments(args, length);\n\tif (isPromise(args)) {\n\t\tif (args.failed) return args;\n\t\tdef = deferred();\n\t\targs.done(function (args) {\n\t\t\tif (fn.returnsPromise) return apply.call(fn, context, args);\n\t\t\ttry {\n\t\t\t\tapplyFn.call(context, fn, args, def);\n\t\t\t} catch (e) { def.reject(e); }\n\t\t}, def.reject);\n\t\treturn def.promise;\n\t}\n\tif (fn.returnsPromise) return apply.call(fn, context, args);\n\tdef = deferred();\n\ttry {\n\t\tapplyFn.call(context, fn, args, def);\n\t} catch (e) {\n\t\tdef.reject(e);\n\t\tthrow e;\n\t}\n\treturn def.promise;\n};\n\nmodule.exports = exports = function (context/*, args*/) {\n\treturn callAsync(callable(this), null, context, slice.call(arguments, 1));\n};\n\nObject.defineProperty(exports, '_base', { configurable: true,\n\tenumerable: false, writable: true, value: callAsync });\n","// Delay function execution, return promise for delayed function result\n\n'use strict';\n\nvar callable      = require('es5-ext/object/valid-callable')\n  , nextTick      = require('next-tick')\n  , ensureTimeout = require('timers-ext/valid-timeout')\n  , deferred      = require('../../deferred')\n\n  , apply    = Function.prototype.apply\n  , delayed;\n\ndelayed = function (fn, args, resolve, reject) {\n\tvar value;\n\ttry {\n\t\tvalue = apply.call(fn, this, args);\n\t} catch (e) {\n\t\treject(e);\n\t\treturn;\n\t}\n\tresolve(value);\n};\n\nmodule.exports = function (timeout) {\n\tvar fn, result, delay;\n\tfn = callable(this);\n\tif (timeout == null) {\n\t\tdelay = nextTick;\n\t} else {\n\t\ttimeout = ensureTimeout(timeout);\n\t\tdelay = setTimeout;\n\t}\n\tresult = function () {\n\t\tvar def = deferred();\n\t\tdelay(delayed.bind(this, fn, arguments, def.resolve, def.reject), timeout);\n\t\treturn def.promise;\n\t};\n\tresult.returnsPromise = true;\n\treturn result;\n};\n","// Limit number of concurrent function executions (to cLimit number).\n// Limited calls are queued. Optionaly maximum queue length can also be\n// controlled with qLimit value, any calls that would reach over that limit\n// would be discarded (its promise would resolve with \"Too many calls\" error)\n\n'use strict';\n\nvar toPosInt   = require('es5-ext/number/to-pos-integer')\n  , callable   = require('es5-ext/object/valid-callable')\n  , eeUnify    = require('event-emitter/unify')\n  , deferred   = require('../../deferred')\n  , isPromise  = require('../../is-promise')\n  , assimilate = require('../../assimilate')\n\n  , resolve = deferred.resolve, reject = deferred.reject\n  , apply = Function.prototype.apply, max = Math.max\n  , gateReject;\n\nrequire('../promise/finally');\n\ngateReject = function () {\n\tvar e = new Error(\"Too many calls\");\n\te.type = 'deferred-gate-rejected';\n\treturn reject(e);\n};\n\nmodule.exports = function (cLimit, qLimit) {\n\tvar fn, count, decrement, unload, queue, run, result;\n\tfn = callable(this);\n\tcLimit = max(toPosInt(cLimit), 1);\n\tqLimit = ((qLimit == null) || isNaN(qLimit)) ? Infinity : toPosInt(qLimit);\n\tcount = 0;\n\tqueue = [];\n\n\trun = function (thisArg, args, def) {\n\t\tvar r;\n\t\ttry {\n\t\t\tr = apply.call(fn, thisArg, args);\n\t\t} catch (e) {\n\t\t\tif (!def) return reject(e);\n\t\t\tdef.reject(e);\n\t\t\tunload();\n\t\t\treturn;\n\t\t}\n\t\tr = assimilate(r);\n\t\tif (isPromise(r)) {\n\t\t\tif (def) eeUnify(def.promise, r);\n\t\t\tif (!r.resolved) {\n\t\t\t\t++count;\n\t\t\t\tif (def) def.resolve(r);\n\t\t\t\treturn r.finally(decrement);\n\t\t\t}\n\t\t\tr = r.value;\n\t\t}\n\t\tif (!def) return resolve(r);\n\t\tdef.resolve(r);\n\t\tunload();\n\t};\n\n\tdecrement = function () {\n\t\t--count;\n\t\tunload();\n\t};\n\n\tunload = function () {\n\t\tvar data;\n\t\tif ((data = queue.shift())) run.apply(null, data);\n\t};\n\n\tresult = function () {\n\t\tvar def;\n\t\tif (count >= cLimit) {\n\t\t\tif (queue.length < qLimit) {\n\t\t\t\tdef = deferred();\n\t\t\t\tqueue.push([this, arguments, def]);\n\t\t\t\treturn def.promise;\n\t\t\t}\n\t\t\treturn gateReject();\n\t\t}\n\t\treturn run(this, arguments);\n\t};\n\tresult.returnsPromise = true;\n\treturn result;\n};\n","// Promisify synchronous function\n\n'use strict';\n\nvar callable         = require('es5-ext/object/valid-callable')\n  , deferred         = require('../../deferred')\n  , isPromise        = require('../../is-promise')\n  , processArguments = require('../_process-arguments')\n\n  , apply = Function.prototype.apply\n\n  , applyFn;\n\napplyFn = function (fn, args, resolve, reject) {\n\tvar value;\n\ttry {\n\t\tvalue = apply.call(fn, this, args);\n\t} catch (e) {\n\t\treject(e);\n\t\treturn;\n\t}\n\tresolve(value);\n};\n\nmodule.exports = function (length) {\n\tvar fn, result;\n\tfn = callable(this);\n\tif (fn.returnsPromise) return fn;\n\tif (length != null) length = length >>> 0;\n\tresult = function () {\n\t\tvar args, def;\n\t\targs = processArguments(arguments, length);\n\n\t\tif (isPromise(args)) {\n\t\t\tif (args.failed) return args;\n\t\t\tdef = deferred();\n\t\t\targs.done(function (args) {\n\t\t\t\tapplyFn.call(this, fn, args, def.resolve, def.reject);\n\t\t\t}.bind(this), def.reject);\n\t\t} else {\n\t\t\tdef = deferred();\n\t\t\tapplyFn.call(this, fn, args, def.resolve, def.reject);\n\t\t}\n\n\t\treturn def.promise;\n\t};\n\tresult.returnsPromise = true;\n\treturn result;\n};\n","// Promisify asynchronous function\n\n'use strict';\n\nvar callable  = require('es5-ext/object/valid-callable')\n  , callAsync = require('./call-async')._base;\n\nmodule.exports = function (length) {\n\tvar fn, result;\n\tfn = callable(this);\n\tif (fn.returnsPromise) return fn;\n\tif (length != null) length = length >>> 0;\n\tresult = function () { return callAsync(fn, length, this, arguments); };\n\tresult.returnsPromise = true;\n\treturn result;\n};\n","// Used by promise extensions that are based on array extensions.\n\n'use strict';\n\nvar callable = require('es5-ext/object/valid-callable')\n  , deferred = require('../../deferred')\n\n  , reject = deferred.reject;\n\nmodule.exports = function (name, ext) {\n\tdeferred.extend(name, function (cb) {\n\t\tvar def;\n\t\t((cb == null) || callable(cb));\n\t\tif (!this.pending) this.pending = [];\n\t\tdef = deferred();\n\t\tthis.pending.push(name, [arguments, def.resolve, def.reject]);\n\t\treturn def.promise;\n\t}, function (args, resolve, reject) {\n\t\tvar result;\n\t\tif (this.failed) {\n\t\t\treject(this.value);\n\t\t\treturn;\n\t\t}\n\t\ttry {\n\t\t\tresult = ext.apply(this.value, args);\n\t\t} catch (e) {\n\t\t\treject(e);\n\t\t\treturn;\n\t\t}\n\t\tresolve(result);\n\t}, function (cb) {\n\t\t((cb == null) || callable(cb));\n\t\tif (this.failed) return this;\n\t\ttry {\n\t\t\treturn ext.apply(this.value, arguments);\n\t\t} catch (e) {\n\t\t\treturn reject(e);\n\t\t}\n\t});\n};\n","// 'aside' - Promise extension\n//\n// promise.aside(win, fail)\n//\n// Works in analogous way as promise function itself (or `then`)\n// but instead of adding promise to promise chain it returns context promise and\n// lets callback carry on with other processing logic\n\n'use strict';\n\nvar callable = require('es5-ext/object/valid-callable')\n  , deferred = require('../../deferred');\n\ndeferred.extend('aside', function (win, fail) {\n\t((win == null) || callable(win));\n\t((fail == null) || callable(fail));\n\tif (win || fail) {\n\t\tif (!this.pending) {\n\t\t\tthis.pending = [];\n\t\t}\n\t\tthis.pending.push('aside', arguments);\n\t}\n\treturn this;\n}, function (win, fail) {\n\tvar cb = this.failed ? fail : win;\n\tif (cb) {\n\t\tcb(this.value);\n\t}\n}, function (win, fail) {\n\tvar cb;\n\t((win == null) || callable(win));\n\t((fail == null) || callable(fail));\n\tcb = this.failed ? fail : win;\n\tif (cb) {\n\t\tcb(this.value);\n\t}\n\treturn this;\n});\n","// 'catch' - Promise extension\n//\n// promise.catch(cb)\n//\n// Same as `then` but accepts only onFail callback\n\n'use strict';\n\nvar isCallable = require('es5-ext/object/is-callable')\n  , validValue = require('es5-ext/object/valid-value')\n  , deferred   = require('../../deferred')\n  , isPromise  = require('../../is-promise')\n\n  , resolve = deferred.resolve, reject = deferred.reject;\n\ndeferred.extend('catch', function (cb) {\n\tvar def;\n\tvalidValue(cb);\n\tif (!this.pending) this.pending = [];\n\tdef = deferred();\n\tthis.pending.push('catch', [cb, def.resolve, def.reject]);\n\treturn def.promise;\n}, function (cb, resolve, reject) {\n\tvar value;\n\tif (!this.failed) {\n\t\tresolve(this.value);\n\t\treturn;\n\t}\n\tif (isCallable(cb)) {\n\t\tif (isPromise(cb)) {\n\t\t\tif (cb.resolved) {\n\t\t\t\tif (cb.failed) reject(cb.value);\n\t\t\t\telse resolve(cb.value);\n\t\t\t} else {\n\t\t\t\tcb.done(resolve, reject);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\ttry { value = cb(this.value); } catch (e) {\n\t\t\treject(e);\n\t\t\treturn;\n\t\t}\n\t\tresolve(value);\n\t\treturn;\n\t}\n\tresolve(cb);\n}, function (cb) {\n\tvar value;\n\tvalidValue(cb);\n\tif (!this.failed) return this;\n\tif (isCallable(cb)) {\n\t\tif (isPromise(cb)) return cb;\n\t\ttry { value = cb(this.value); } catch (e) {\n\t\t\treturn reject(e);\n\t\t}\n\t\treturn resolve(value);\n\t}\n\treturn resolve(cb);\n});\n","// 'cb' - Promise extension\n//\n// promise.cb(cb)\n//\n// Handles asynchronous function style callback (which is run in next event loop\n// the earliest). Returns self promise. Callback is optional.\n//\n// Useful when we want to configure typical asynchronous function which logic is\n// internally configured with promises.\n//\n// Extension can be used as follows:\n//\n// var foo = function (arg1, arg2, cb) {\n//     var d = deferred();\n//     // ... implementation\n//     return d.promise.cb(cb);\n// };\n//\n// `cb` extension returns promise and handles eventual callback (optional)\n\n'use strict';\n\nvar callable   = require('es5-ext/object/valid-callable')\n  , nextTick   = require('next-tick')\n  , deferred   = require('../../deferred');\n\ndeferred.extend('cb', function (cb) {\n\tif (cb == null) return this;\n\tcallable(cb);\n\tnextTick(function () {\n\t\tif (this.resolved) {\n\t\t\tif (this.failed) cb(this.value);\n\t\t\telse cb(null, this.value);\n\t\t} else {\n\t\t\tif (!this.pending) this.pending = [];\n\t\t\tthis.pending.push('cb', [cb]);\n\t\t}\n\t}.bind(this));\n\treturn this;\n}, function (cb) {\n\tif (this.failed) cb(this.value);\n\telse cb(null, this.value);\n}, function (cb) {\n\tif (cb == null) return this;\n\tcallable(cb);\n\tnextTick(function () {\n\t\tif (this.failed) cb(this.value);\n\t\telse cb(null, this.value);\n\t}.bind(this));\n\treturn this;\n});\n","// 'finally' - Promise extension\n//\n// promise.finally(cb)\n//\n// Called on promise resolution returns same promise, doesn't pass any values to\n// provided callback\n\n'use strict';\n\nvar callable = require('es5-ext/object/valid-callable')\n  , deferred = require('../../deferred');\n\ndeferred.extend('finally', function (cb) {\n\tcallable(cb);\n\tif (!this.pending) this.pending = [];\n\tthis.pending.push('finally', arguments);\n\treturn this;\n}, function (cb) { cb(); }, function (cb) {\n\tcallable(cb)();\n\treturn this;\n});\n","// 'get' - Promise extension\n//\n// promise.get(name)\n//\n// Resolves with property of resolved object\n\n'use strict';\n\nvar value    = require('es5-ext/object/valid-value')\n  , deferred = require('../../deferred')\n\n  , reduce = Array.prototype.reduce\n  , resolve = deferred.resolve, reject = deferred.reject;\n\ndeferred.extend('get', function (/*name*/) {\n\tvar def;\n\tif (!this.pending) this.pending = [];\n\tdef = deferred();\n\tthis.pending.push('get', [arguments, def.resolve, def.reject]);\n\treturn def.promise;\n\n}, function (args, resolve, reject) {\n\tvar result;\n\tif (this.failed) reject(this.value);\n\ttry {\n\t\tresult = reduce.call(args, function (obj, key) {\n\t\t\treturn value(obj)[String(key)];\n\t\t}, this.value);\n\t} catch (e) {\n\t\treject(e);\n\t\treturn;\n\t}\n\tresolve(result);\n}, function (/*name*/) {\n\tvar result;\n\tif (this.failed) return this;\n\ttry {\n\t\tresult = reduce.call(arguments, function (obj, key) {\n\t\t\treturn value(obj)[String(key)];\n\t\t}, this.value);\n\t} catch (e) {\n\t\treturn reject(e);\n\t}\n\treturn resolve(result);\n});\n","// 'invokeAsync' - Promise extension\n//\n// promise.invokeAsync(name[, arg0[, arg1[, ...]]])\n//\n// On resolved object calls asynchronous method that takes callback\n// (Node.js style).\n// Do not pass callback, it's handled by internal implementation.\n// 'name' can be method name or method itself.\n\n'use strict';\n\nvar toArray          = require('es5-ext/array/to-array')\n  , isCallable       = require('es5-ext/object/is-callable')\n  , deferred         = require('../../deferred')\n  , isPromise        = require('../../is-promise')\n  , processArguments = require('../_process-arguments')\n\n  , slice = Array.prototype.slice, apply = Function.prototype.apply\n  , reject = deferred.reject\n\n  , applyFn;\n\napplyFn = function (fn, args, resolve, reject) {\n\tvar result;\n\tif (fn.returnsPromise) {\n\t\ttry {\n\t\t\tresult = apply.call(fn, this, args);\n\t\t} catch (e) {\n\t\t\treject(e);\n\t\t\treturn;\n\t\t}\n\t\treturn resolve(result);\n\t}\n\targs = toArray(args).concat(function (error, result) {\n\t\tif (error == null) {\n\t\t\tresolve((arguments.length > 2) ? slice.call(arguments, 1) : result);\n\t\t} else {\n\t\t\treject(error);\n\t\t}\n\t});\n\ttry {\n\t\tapply.call(fn, this, args);\n\t} catch (e2) {\n\t\treject(e2);\n\t}\n};\n\ndeferred.extend('invokeAsync', function (method/*, args*/) {\n\tvar def;\n\tif (!this.pending) this.pending = [];\n\tdef = deferred();\n\tthis.pending.push('invokeAsync', [arguments, def.resolve, def.reject]);\n\treturn def.promise;\n}, function (args, resolve, reject) {\n\tvar fn;\n\tif (this.failed) {\n\t\treject(this.value);\n\t\treturn;\n\t}\n\n\tif (this.value == null) {\n\t\treject(new TypeError(\"Cannot use null or undefined\"));\n\t\treturn;\n\t}\n\n\tfn = args[0];\n\tif (!isCallable(fn)) {\n\t\tfn = String(fn);\n\t\tif (!isCallable(this.value[fn])) {\n\t\t\treject(new TypeError(fn + \" is not a function\"));\n\t\t\treturn;\n\t\t}\n\t\tfn = this.value[fn];\n\t}\n\n\targs = processArguments(slice.call(args, 1));\n\tif (isPromise(args)) {\n\t\tif (args.failed) {\n\t\t\treject(args.value);\n\t\t\treturn;\n\t\t}\n\t\targs.done(function (args) {\n\t\t\tapplyFn.call(this, fn, args, resolve, reject);\n\t\t}.bind(this.value), reject);\n\t} else {\n\t\tapplyFn.call(this.value, fn, args, resolve, reject);\n\t}\n}, function (method/*, args*/) {\n\tvar args, def;\n\tif (this.failed) return this;\n\n\tif (this.value == null) {\n\t\treturn reject(new TypeError(\"Cannot use null or undefined\"));\n\t}\n\n\tif (!isCallable(method)) {\n\t\tmethod = String(method);\n\t\tif (!isCallable(this.value[method])) {\n\t\t\treturn reject(new TypeError(method + \" is not a function\"));\n\t\t}\n\t\tmethod = this.value[method];\n\t}\n\n\targs = processArguments(slice.call(arguments, 1));\n\tif (isPromise(args)) {\n\t\tif (args.failed) return args;\n\t\tdef = deferred();\n\t\targs.done(function (args) {\n\t\t\tapplyFn.call(this, method, args, def.resolve, def.reject);\n\t\t}.bind(this.value), def.reject);\n\t} else if (!method.returnsPromise) {\n\t\tdef = deferred();\n\t\tapplyFn.call(this.value, method, args, def.resolve, def.reject);\n\t} else {\n\t\treturn applyFn.call(this.value, method, args, deferred, reject);\n\t}\n\treturn def.promise;\n});\n","// 'invoke' - Promise extension\n//\n// promise.invoke(name[, arg0[, arg1[, ...]]])\n//\n// On resolved object calls method that returns immediately.\n// 'name' can be method name or method itself.\n\n'use strict';\n\nvar isCallable       = require('es5-ext/object/is-callable')\n  , deferred         = require('../../deferred')\n  , isPromise        = require('../../is-promise')\n  , processArguments = require('../_process-arguments')\n\n  , slice = Array.prototype.slice, apply = Function.prototype.apply\n  , reject = deferred.reject\n  , applyFn;\n\napplyFn = function (fn, args, resolve, reject) {\n\tvar value;\n\ttry {\n\t\tvalue = apply.call(fn, this, args);\n\t} catch (e) {\n\t\treturn reject(e);\n\t}\n\treturn resolve(value);\n};\n\ndeferred.extend('invoke', function (method/*, args*/) {\n\tvar def;\n\tif (!this.pending) this.pending = [];\n\tdef = deferred();\n\tthis.pending.push('invoke', [arguments, def.resolve, def.reject]);\n\treturn def.promise;\n}, function (args, resolve, reject) {\n\tvar fn;\n\tif (this.failed) {\n\t\treject(this.value);\n\t\treturn;\n\t}\n\n\tif (this.value == null) {\n\t\treject(new TypeError(\"Cannot use null or undefined\"));\n\t\treturn;\n\t}\n\n\tfn = args[0];\n\tif (!isCallable(fn)) {\n\t\tfn = String(fn);\n\t\tif (!isCallable(this.value[fn])) {\n\t\t\treject(new TypeError(fn + \" is not a function\"));\n\t\t\treturn;\n\t\t}\n\t\tfn = this.value[fn];\n\t}\n\n\targs = processArguments(slice.call(args, 1));\n\tif (isPromise(args)) {\n\t\tif (args.failed) {\n\t\t\treject(args.value);\n\t\t\treturn;\n\t\t}\n\t\targs.done(function (args) {\n\t\t\tapplyFn.call(this, fn, args, resolve, reject);\n\t\t}.bind(this.value), reject);\n\t} else {\n\t\tapplyFn.call(this.value, fn, args, resolve, reject);\n\t}\n}, function (method/*, args*/) {\n\tvar args, def;\n\tif (this.failed) return this;\n\n\tif (this.value == null) {\n\t\treturn reject(new TypeError(\"Cannot use null or undefined\"));\n\t}\n\n\tif (!isCallable(method)) {\n\t\tmethod = String(method);\n\t\tif (!isCallable(this.value[method])) {\n\t\t\treturn reject(new TypeError(method + \" is not a function\"));\n\t\t}\n\t\tmethod = this.value[method];\n\t}\n\n\targs = processArguments(slice.call(arguments, 1));\n\tif (isPromise(args)) {\n\t\tif (args.failed) return args;\n\t\tdef = deferred();\n\t\targs.done(function (args) {\n\t\t\tapplyFn.call(this, method, args, def.resolve, def.reject);\n\t\t}.bind(this.value), def.reject);\n\t\treturn def.promise;\n\t}\n\treturn applyFn.call(this.value, method, args, deferred, reject);\n});\n","// 'map' - Promise extension\n//\n// promise.map(fn[, thisArg[, concurrentLimit]])\n//\n// Promise aware map for array-like results\n\n'use strict';\n\nrequire('./_array')('map', require('../array/map'));\n","// 'reduce' - Promise extension\n//\n// promise.reduce(fn[, initial])\n//\n// Promise aware reduce for array-like results\n\n'use strict';\n\nrequire('./_array')('reduce', require('../array/reduce'));\n","// 'some' - Promise extension\n//\n// promise.some(fn[, thisArg])\n//\n// Promise aware some for array-like results\n\n'use strict';\n\nrequire('./_array')('some', require('../array/some'));\n","// 'spread' - Promise extensions\n//\n// promise.spread(onsuccess, onerror)\n//\n// Matches eventual list result onto function arguments,\n// otherwise works same as 'then' (promise function itself)\n\n'use strict';\n\nvar spread     = require('es5-ext/function/#/spread')\n  , callable   = require('es5-ext/object/valid-callable')\n  , isCallable = require('es5-ext/object/is-callable')\n  , isPromise  = require('../../is-promise')\n  , deferred   = require('../../deferred')\n\n  , resolve = deferred.resolve, reject = deferred.reject;\n\ndeferred.extend('spread', function (win, fail) {\n\tvar def;\n\t((win == null) || callable(win));\n\tif (!win && (fail == null)) return this;\n\tif (!this.pending) this.pending = [];\n\tdef = deferred();\n\tthis.pending.push('spread', [win, fail, def.resolve, def.reject]);\n\treturn def.promise;\n}, function (win, fail, resolve, reject) {\n\tvar cb, value;\n\tcb = this.failed ? fail : win;\n\tif (cb == null) {\n\t\tif (this.failed) reject(this.value);\n\t\telse resolve(this.value);\n\t}\n\tif (isCallable(cb)) {\n\t\tif (isPromise(cb)) {\n\t\t\tif (cb.resolved) {\n\t\t\t\tif (cb.failed) reject(cb.value);\n\t\t\t\telse resolve(cb.value);\n\t\t\t} else {\n\t\t\t\tcb.done(resolve, reject);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif (!this.failed) cb = spread.call(cb);\n\t\ttry {\n\t\t\tvalue = cb(this.value);\n\t\t} catch (e) {\n\t\t\treject(e);\n\t\t\treturn;\n\t\t}\n\t\tresolve(value);\n\t} else {\n\t\tresolve(cb);\n\t}\n}, function (win, fail) {\n\tvar cb, value;\n\tcb = this.failed ? fail : win;\n\tif (cb == null) return this;\n\tif (isCallable(cb)) {\n\t\tif (isPromise(cb)) return cb;\n\t\tif (!this.failed) cb = spread.call(cb);\n\t\ttry {\n\t\t\tvalue = cb(this.value);\n\t\t} catch (e) {\n\t\t\treturn reject(e);\n\t\t}\n\t\treturn resolve(value);\n\t}\n\treturn resolve(cb);\n});\n","// This construct deferred with all needed goodies that are being exported\n// when we import 'deferred' by main name.\n// All available promise extensions are also initialized.\n\n'use strict';\n\nvar call   = Function.prototype.call\n  , assign = require('es5-ext/object/assign');\n\nmodule.exports = assign(require('./deferred'), {\n\tinvokeAsync:   require('./invoke-async'),\n\tisPromise:     require('./is-promise'),\n\tdynamicQueue:  require('./dynamic-queue'),\n\tvalidPromise:  require('./valid-promise'),\n\tcallAsync:     call.bind(require('./ext/function/call-async')),\n\tdelay:         call.bind(require('./ext/function/delay')),\n\tgate:          call.bind(require('./ext/function/gate')),\n\tmonitor:       require('./monitor'),\n\tpromisify:     call.bind(require('./ext/function/promisify')),\n\tpromisifySync: call.bind(require('./ext/function/promisify-sync')),\n\tevery:         call.bind(require('./ext/array/every')),\n\tfind:          call.bind(require('./ext/array/find')),\n\tmap:           call.bind(require('./ext/array/map')),\n\treduce:        call.bind(require('./ext/array/reduce')),\n\tsome:          call.bind(require('./ext/array/some'))\n}, require('./profiler'));\n\nrequire('./ext/promise/aside');\nrequire('./ext/promise/catch');\nrequire('./ext/promise/cb');\nrequire('./ext/promise/finally');\nrequire('./ext/promise/get');\nrequire('./ext/promise/invoke');\nrequire('./ext/promise/invoke-async');\nrequire('./ext/promise/map');\nrequire('./ext/promise/spread');\nrequire('./ext/promise/some');\nrequire('./ext/promise/reduce');\n","// Invoke asynchronous function\n\n'use strict';\n\nvar isCallable = require('es5-ext/object/is-callable')\n  , callable   = require('es5-ext/object/valid-callable')\n  , value      = require('es5-ext/object/valid-value')\n  , callAsync  = require('./ext/function/call-async')._base\n\n  , slice = Array.prototype.slice;\n\nmodule.exports = function (obj, fn/*, args*/) {\n\tvalue(obj);\n\tif (!isCallable(fn)) fn = callable(obj[fn]);\n\treturn callAsync(fn, null, obj, slice.call(arguments, 2));\n};\n","// Whether given object is a promise\n\n'use strict';\n\nmodule.exports = function (o) {\n\treturn (typeof o === 'function') && (typeof o.then === 'function') && (o.end !== o.done);\n};\n","// Promise aware Array's some\n\n'use strict';\n\nvar assign     = require('es5-ext/object/assign')\n  , value      = require('es5-ext/object/valid-value')\n  , callable   = require('es5-ext/object/valid-callable')\n  , deferred   = require('../deferred')\n  , isPromise  = require('../is-promise')\n  , assimilate = require('../assimilate')\n\n  , call = Function.prototype.call\n  , resolve = deferred.resolve;\n\nmodule.exports = function (resolvent) {\n\tvar Iterator = function (list, cb, context) {\n\t\tthis.list = list;\n\t\tthis.cb = cb;\n\t\tthis.context = context;\n\t\tthis.length = list.length >>> 0;\n\n\t\twhile (this.current < this.length) {\n\t\t\tif (this.current in list) {\n\t\t\t\tassign(this, deferred());\n\t\t\t\tthis.processCb = this.processCb.bind(this);\n\t\t\t\tthis.processValue = this.processValue.bind(this);\n\t\t\t\tthis.continue();\n\t\t\t\treturn this.promise;\n\t\t\t}\n\t\t\t++this.current;\n\t\t}\n\t\treturn resolve(!resolvent);\n\t};\n\n\tIterator.prototype = {\n\t\tcurrent: 0,\n\t\tstate: false,\n\t\tcontinue: function () {\n\t\t\tvar result;\n\t\t\twhile (!this.state) {\n\t\t\t\tresult = this.process();\n\t\t\t\tif (this.state !== 'cb') break;\n\t\t\t\tresult = this.processCb(result);\n\t\t\t\tif (this.state !== 'value') break;\n\t\t\t\tthis.processValue(result);\n\t\t\t}\n\t\t},\n\t\tprocess: function () {\n\t\t\tvar value = assimilate(this.list[this.current]);\n\t\t\tif (isPromise(value)) {\n\t\t\t\tif (!value.resolved) {\n\t\t\t\t\tvalue.done(function (result) {\n\t\t\t\t\t\tresult = this.processCb(result);\n\t\t\t\t\t\tif (this.state !== 'value') return;\n\t\t\t\t\t\tthis.processValue(result);\n\t\t\t\t\t\tif (!this.state) this.continue();\n\t\t\t\t\t}.bind(this), this.reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (value.failed) {\n\t\t\t\t\tthis.reject(value.value);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvalue = value.value;\n\t\t\t}\n\t\t\tthis.state = 'cb';\n\t\t\treturn value;\n\t\t},\n\t\tprocessCb: function (value) {\n\t\t\tif (this.cb) {\n\t\t\t\ttry {\n\t\t\t\t\tvalue = call.call(this.cb, this.context, value, this.current, this.list);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis.reject(e);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvalue = assimilate(value);\n\t\t\t\tif (isPromise(value)) {\n\t\t\t\t\tif (!value.resolved) {\n\t\t\t\t\t\tvalue.done(function (result) {\n\t\t\t\t\t\t\tthis.state = 'value';\n\t\t\t\t\t\t\tthis.processValue(result);\n\t\t\t\t\t\t\tif (!this.state) this.continue();\n\t\t\t\t\t\t}.bind(this), this.reject);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (value.failed) {\n\t\t\t\t\t\tthis.reject(value.value);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvalue = value.value;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.state = 'value';\n\t\t\treturn value;\n\t\t},\n\t\tprocessValue: function (value) {\n\t\t\tif (Boolean(value) === resolvent) {\n\t\t\t\tthis.resolve(resolvent);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\twhile (++this.current < this.length) {\n\t\t\t\tif (this.current in this.list) {\n\t\t\t\t\tthis.state = false;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.resolve(!resolvent);\n\t\t}\n\t};\n\n\treturn function (cb/*, thisArg*/) {\n\t\tvalue(this);\n\t\t((cb == null) || callable(cb));\n\n\t\treturn new Iterator(this, cb, arguments[1]);\n\t};\n};\n","// Run if you want to monitor unresolved promises (in properly working\n// application there should be no promises that are never resolved)\n\n'use strict';\n\nvar max        = Math.max\n  , callable   = require('es5-ext/object/valid-callable')\n  , isCallable = require('es5-ext/object/is-callable')\n  , toPosInt   = require('es5-ext/number/to-pos-integer')\n  , deferred   = require('./deferred');\n\nexports = module.exports = function (timeout, cb) {\n\tif (timeout === false) {\n\t\t// Cancel monitor\n\t\tdelete deferred._monitor;\n\t\tdelete exports.timeout;\n\t\tdelete exports.callback;\n\t\treturn;\n\t}\n\texports.timeout = timeout = max(toPosInt(timeout) || 5000, 50);\n\tif (cb == null) {\n\t\tif ((typeof console !== 'undefined') && console &&\n\t\t\t\tisCallable(console.error)) {\n\t\t\tcb = function (e) {\n\t\t\t\tconsole.error(((e.stack && e.stack.toString()) ||\n\t\t\t\t\t\"Unresolved promise: no stack available\"));\n\t\t\t};\n\t\t}\n\t} else {\n\t\tcallable(cb);\n\t}\n\texports.callback = cb;\n\n\tdeferred._monitor = function () {\n\t\tvar e = new Error(\"Unresolved promise\");\n\t\treturn setTimeout(function () {\n\t\t\tif (cb) cb(e);\n\t\t}, timeout);\n\t};\n};\n","'use strict';\n\nvar partial  = require('es5-ext/function/#/partial')\n  , forEach  = require('es5-ext/object/for-each')\n  , pad      = require('es5-ext/string/#/pad')\n  , deferred = require('./deferred')\n\n  , resolved, rStats, unresolved, uStats, profile;\n\nexports.profile = function () {\n\tresolved = 0;\n\trStats = {};\n\tunresolved = 0;\n\tuStats = {};\n\tdeferred._profile = profile;\n};\n\nprofile = function (isResolved) {\n\tvar stack, data;\n\n\tif (isResolved) {\n\t\t++resolved;\n\t\tdata = rStats;\n\t} else {\n\t\t++unresolved;\n\t\tdata = uStats;\n\t}\n\n\tstack = (new Error()).stack;\n\tif (!stack.split('\\n').slice(3).some(function (line) {\n\t\t\tif ((line.search(/[\\/\\\\]deferred[\\/\\\\]/) === -1) &&\n\t\t\t\t\t(line.search(/[\\/\\\\]es5-ext[\\/\\\\]/) === -1) &&\n\t\t\t\t\t(line.indexOf(' (native)') === -1)) {\n\t\t\t\tline = line.replace(/\\n/g, \"\\\\n\").trim();\n\t\t\t\tif (!data[line]) {\n\t\t\t\t\tdata[line] = { count: 0 };\n\t\t\t\t}\n\t\t\t\t++data[line].count;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t})) {\n\t\tif (!data.unknown) {\n\t\t\tdata.unknown = { count: 0, stack: stack };\n\t\t}\n\t\t++data.unknown.count;\n\t}\n};\n\nexports.profileEnd = function () {\n\tvar total, lpad, log = '';\n\n\tif (!deferred._profile) {\n\t\tthrow new Error(\"Deferred profiler was not initialized\");\n\t}\n\tdelete deferred._profile;\n\n\tlog += \"------------------------------------------------------------\\n\";\n\tlog += \"Deferred usage statistics:\\n\\n\";\n\n\ttotal = String(resolved + unresolved);\n\tlpad = partial.call(pad, \" \", total.length);\n\tlog += total + \" Total promises initialized\\n\";\n\tlog += lpad.call(unresolved) + \" Initialized as Unresolved\\n\";\n\tlog += lpad.call(resolved) + \" Initialized as Resolved\\n\";\n\n\tif (unresolved) {\n\t\tlog += \"\\nUnresolved promises were initialized at:\\n\";\n\t\tforEach(uStats, function (data, name) {\n\t\t\tlog += lpad.call(data.count) + \" \" + name + \"\\n\";\n\t\t}, null, function (a, b) {\n\t\t\treturn this[b].count - this[a].count;\n\t\t});\n\t}\n\n\tif (resolved) {\n\t\tlog += \"\\nResolved promises were initialized at:\\n\";\n\t\tforEach(rStats, function (data, name) {\n\t\t\tlog += lpad.call(data.count) + \" \" + name + \"\\n\";\n\t\t}, null, function (a, b) {\n\t\t\treturn this[b].count - this[a].count;\n\t\t});\n\t}\n\tlog += \"------------------------------------------------------------\\n\";\n\n\treturn {\n\t\tlog: log,\n\t\tresolved: { count: resolved, stats: rStats },\n\t\tunresolved: { count: unresolved, stats: uStats }\n\t};\n};\n","'use strict';\n\nvar isPromise = require('./is-promise');\n\nmodule.exports = function (x) {\n\tif (!isPromise(x)) {\n\t\tthrow new TypeError(x + \" is not a promise object\");\n\t}\n\treturn x;\n};\n","'use strict';\n\nmodule.exports = require('./is-implemented')()\n\t? Array.from\n\t: require('./shim');\n","'use strict';\n\nmodule.exports = function () {\n\tvar from = Array.from, arr, result;\n\tif (typeof from !== 'function') return false;\n\tarr = ['raz', 'dwa'];\n\tresult = from(arr);\n\treturn Boolean(result && (result !== arr) && (result[1] === 'dwa'));\n};\n","'use strict';\n\nvar iteratorSymbol = require('es6-symbol').iterator\n  , isArguments    = require('../../function/is-arguments')\n  , isFunction     = require('../../function/is-function')\n  , toPosInt       = require('../../number/to-pos-integer')\n  , callable       = require('../../object/valid-callable')\n  , validValue     = require('../../object/valid-value')\n  , isString       = require('../../string/is-string')\n\n  , isArray = Array.isArray, call = Function.prototype.call\n  , desc = { configurable: true, enumerable: true, writable: true, value: null }\n  , defineProperty = Object.defineProperty;\n\nmodule.exports = function (arrayLike/*, mapFn, thisArg*/) {\n\tvar mapFn = arguments[1], thisArg = arguments[2], Constructor, i, j, arr, l, code, iterator\n\t  , result, getIterator, value;\n\n\tarrayLike = Object(validValue(arrayLike));\n\n\tif (mapFn != null) callable(mapFn);\n\tif (!this || (this === Array) || !isFunction(this)) {\n\t\t// Result: Plain array\n\t\tif (!mapFn) {\n\t\t\tif (isArguments(arrayLike)) {\n\t\t\t\t// Source: Arguments\n\t\t\t\tl = arrayLike.length;\n\t\t\t\tif (l !== 1) return Array.apply(null, arrayLike);\n\t\t\t\tarr = new Array(1);\n\t\t\t\tarr[0] = arrayLike[0];\n\t\t\t\treturn arr;\n\t\t\t}\n\t\t\tif (isArray(arrayLike)) {\n\t\t\t\t// Source: Array\n\t\t\t\tarr = new Array(l = arrayLike.length);\n\t\t\t\tfor (i = 0; i < l; ++i) arr[i] = arrayLike[i];\n\t\t\t\treturn arr;\n\t\t\t}\n\t\t}\n\t\tarr = [];\n\t} else {\n\t\t// Result: Non plain array\n\t\tConstructor = this;\n\t}\n\n\tif (!isArray(arrayLike)) {\n\t\tif ((getIterator = arrayLike[iteratorSymbol]) !== undefined) {\n\t\t\t// Source: Iterator\n\t\t\titerator = callable(getIterator).call(arrayLike);\n\t\t\tif (Constructor) arr = new Constructor();\n\t\t\tresult = iterator.next();\n\t\t\ti = 0;\n\t\t\twhile (!result.done) {\n\t\t\t\tvalue = mapFn ? call.call(mapFn, thisArg, result.value, i) : result.value;\n\t\t\t\tif (!Constructor) {\n\t\t\t\t\tarr[i] = value;\n\t\t\t\t} else {\n\t\t\t\t\tdesc.value = value;\n\t\t\t\t\tdefineProperty(arr, i, desc);\n\t\t\t\t}\n\t\t\t\tresult = iterator.next();\n\t\t\t\t++i;\n\t\t\t}\n\t\t\tl = i;\n\t\t} else if (isString(arrayLike)) {\n\t\t\t// Source: String\n\t\t\tl = arrayLike.length;\n\t\t\tif (Constructor) arr = new Constructor();\n\t\t\tfor (i = 0, j = 0; i < l; ++i) {\n\t\t\t\tvalue = arrayLike[i];\n\t\t\t\tif ((i + 1) < l) {\n\t\t\t\t\tcode = value.charCodeAt(0);\n\t\t\t\t\tif ((code >= 0xD800) && (code <= 0xDBFF)) value += arrayLike[++i];\n\t\t\t\t}\n\t\t\t\tvalue = mapFn ? call.call(mapFn, thisArg, value, j) : value;\n\t\t\t\tif (!Constructor) {\n\t\t\t\t\tarr[j] = value;\n\t\t\t\t} else {\n\t\t\t\t\tdesc.value = value;\n\t\t\t\t\tdefineProperty(arr, j, desc);\n\t\t\t\t}\n\t\t\t\t++j;\n\t\t\t}\n\t\t\tl = j;\n\t\t}\n\t}\n\tif (l === undefined) {\n\t\t// Source: array or array-like\n\t\tl = toPosInt(arrayLike.length);\n\t\tif (Constructor) arr = new Constructor(l);\n\t\tfor (i = 0; i < l; ++i) {\n\t\t\tvalue = mapFn ? call.call(mapFn, thisArg, arrayLike[i], i) : arrayLike[i];\n\t\t\tif (!Constructor) {\n\t\t\t\tarr[i] = value;\n\t\t\t} else {\n\t\t\t\tdesc.value = value;\n\t\t\t\tdefineProperty(arr, i, desc);\n\t\t\t}\n\t\t}\n\t}\n\tif (Constructor) {\n\t\tdesc.value = null;\n\t\tarr.length = l;\n\t}\n\treturn arr;\n};\n","'use strict';\n\nmodule.exports = require('./is-implemented')()\n\t? Array.of\n\t: require('./shim');\n","'use strict';\n\nmodule.exports = function () {\n\tvar of = Array.of, result;\n\tif (typeof of !== 'function') return false;\n\tresult = of('foo', 'bar');\n\treturn Boolean(result && (result[1] === 'bar'));\n};\n","'use strict';\n\nvar isFunction = require('../../function/is-function')\n\n  , slice = Array.prototype.slice, defineProperty = Object.defineProperty\n  , desc = { configurable: true, enumerable: true, writable: true, value: null };\n\nmodule.exports = function (/*items*/) {\n\tvar result, i, l;\n\tif (!this || (this === Array) || !isFunction(this)) return slice.call(arguments);\n\tresult = new this(l = arguments.length);\n\tfor (i = 0; i < l; ++i) {\n\t\tdesc.value = arguments[i];\n\t\tdefineProperty(result, i, desc);\n\t}\n\tdesc.value = null;\n\tresult.length = l;\n\treturn result;\n};\n","'use strict';\n\nvar from = require('./from')\n\n  , isArray = Array.isArray;\n\nmodule.exports = function (arrayLike) {\n\treturn isArray(arrayLike) ? arrayLike : from(arrayLike);\n};\n","'use strict';\n\nvar toString = Object.prototype.toString\n\n  , id = toString.call(new Error());\n\nmodule.exports = function (x) {\n\treturn (x && ((x instanceof Error) || (toString.call(x)) === id)) || false;\n};\n","'use strict';\n\nvar callable     = require('../../object/valid-callable')\n  , aFrom        = require('../../array/from')\n  , defineLength = require('../_define-length')\n\n  , apply = Function.prototype.apply;\n\nmodule.exports = function (/*args*/) {\n\tvar fn = callable(this)\n\t  , args = aFrom(arguments);\n\n\treturn defineLength(function () {\n\t\treturn apply.call(fn, this, args.concat(aFrom(arguments)));\n\t}, fn.length - args.length);\n};\n","'use strict';\n\nvar callable = require('../../object/valid-callable')\n\n  , apply = Function.prototype.apply;\n\nmodule.exports = function () {\n\tvar fn = callable(this);\n\treturn function (args) { return apply.call(fn, this, args); };\n};\n","'use strict';\n\nvar toPosInt = require('../number/to-pos-integer')\n\n  , test = function (a, b) {}, desc, defineProperty\n  , generate, mixin;\n\ntry {\n\tObject.defineProperty(test, 'length', { configurable: true, writable: false,\n\t\tenumerable: false, value: 1 });\n} catch (ignore) {}\n\nif (test.length === 1) {\n\t// ES6\n\tdesc = { configurable: true, writable: false, enumerable: false };\n\tdefineProperty = Object.defineProperty;\n\tmodule.exports = function (fn, length) {\n\t\tlength = toPosInt(length);\n\t\tif (fn.length === length) return fn;\n\t\tdesc.value = length;\n\t\treturn defineProperty(fn, 'length', desc);\n\t};\n} else {\n\tmixin = require('../object/mixin');\n\tgenerate = (function () {\n\t\tvar cache = [];\n\t\treturn function (l) {\n\t\t\tvar args, i = 0;\n\t\t\tif (cache[l]) return cache[l];\n\t\t\targs = [];\n\t\t\twhile (l--) args.push('a' + (++i).toString(36));\n\t\t\treturn new Function('fn', 'return function (' + args.join(', ') +\n\t\t\t\t') { return fn.apply(this, arguments); };');\n\t\t};\n\t}());\n\tmodule.exports = function (src, length) {\n\t\tvar target;\n\t\tlength = toPosInt(length);\n\t\tif (src.length === length) return src;\n\t\ttarget = generate(length)(src);\n\t\ttry { mixin(target, src); } catch (ignore) {}\n\t\treturn target;\n\t};\n}\n","'use strict';\n\nvar toString = Object.prototype.toString\n\n  , id = toString.call((function () { return arguments; }()));\n\nmodule.exports = function (x) { return (toString.call(x) === id); };\n","'use strict';\n\nvar toString = Object.prototype.toString\n\n  , id = toString.call(require('./noop'));\n\nmodule.exports = function (f) {\n\treturn (typeof f === \"function\") && (toString.call(f) === id);\n};\n","'use strict';\n\nmodule.exports = function () {};\n","'use strict';\n\nvar iteratorSymbol = require('es6-symbol').iterator\n  , isArrayLike    = require('../object/is-array-like');\n\nmodule.exports = function (x) {\n\tif (x == null) return false;\n\tif (typeof x[iteratorSymbol] === 'function') return true;\n\treturn isArrayLike(x);\n};\n","'use strict';\n\nvar isObject = require('../object/is-object')\n  , is       = require('./is');\n\nmodule.exports = function (x) {\n\tif (is(x) && isObject(x)) return x;\n\tthrow new TypeError(x + \" is not an iterable or array-like object\");\n};\n","'use strict';\n\nmodule.exports = require('./is-implemented')()\n\t? Math.sign\n\t: require('./shim');\n","'use strict';\n\nmodule.exports = function () {\n\tvar sign = Math.sign;\n\tif (typeof sign !== 'function') return false;\n\treturn ((sign(10) === 1) && (sign(-20) === -1));\n};\n","'use strict';\n\nmodule.exports = function (value) {\n\tvalue = Number(value);\n\tif (isNaN(value) || (value === 0)) return value;\n\treturn (value > 0) ? 1 : -1;\n};\n","'use strict';\n\nvar sign = require('../math/sign')\n\n  , abs = Math.abs, floor = Math.floor;\n\nmodule.exports = function (value) {\n\tif (isNaN(value)) return 0;\n\tvalue = Number(value);\n\tif ((value === 0) || !isFinite(value)) return value;\n\treturn sign(value) * floor(abs(value));\n};\n","'use strict';\n\nvar toInteger = require('./to-integer')\n\n  , max = Math.max;\n\nmodule.exports = function (value) { return max(0, toInteger(value)); };\n","// Internal method, used by iteration functions.\n// Calls a function for each key-value pair found in object\n// Optionally takes compareFn to iterate object in specific order\n\n'use strict';\n\nvar callable = require('./valid-callable')\n  , value    = require('./valid-value')\n\n  , bind = Function.prototype.bind, call = Function.prototype.call, keys = Object.keys\n  , propertyIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nmodule.exports = function (method, defVal) {\n\treturn function (obj, cb/*, thisArg, compareFn*/) {\n\t\tvar list, thisArg = arguments[2], compareFn = arguments[3];\n\t\tobj = Object(value(obj));\n\t\tcallable(cb);\n\n\t\tlist = keys(obj);\n\t\tif (compareFn) {\n\t\t\tlist.sort((typeof compareFn === 'function') ? bind.call(compareFn, obj) : undefined);\n\t\t}\n\t\tif (typeof method !== 'function') method = list[method];\n\t\treturn call.call(method, list, function (key, index) {\n\t\t\tif (!propertyIsEnumerable.call(obj, key)) return defVal;\n\t\t\treturn call.call(cb, thisArg, obj[key], key, obj, index);\n\t\t});\n\t};\n};\n","'use strict';\n\nmodule.exports = require('./is-implemented')()\n\t? Object.assign\n\t: require('./shim');\n","'use strict';\n\nmodule.exports = function () {\n\tvar assign = Object.assign, obj;\n\tif (typeof assign !== 'function') return false;\n\tobj = { foo: 'raz' };\n\tassign(obj, { bar: 'dwa' }, { trzy: 'trzy' });\n\treturn (obj.foo + obj.bar + obj.trzy) === 'razdwatrzy';\n};\n","'use strict';\n\nvar keys  = require('../keys')\n  , value = require('../valid-value')\n\n  , max = Math.max;\n\nmodule.exports = function (dest, src/*, srcn*/) {\n\tvar error, i, l = max(arguments.length, 2), assign;\n\tdest = Object(value(dest));\n\tassign = function (key) {\n\t\ttry { dest[key] = src[key]; } catch (e) {\n\t\t\tif (!error) error = e;\n\t\t}\n\t};\n\tfor (i = 1; i < l; ++i) {\n\t\tsrc = arguments[i];\n\t\tkeys(src).forEach(assign);\n\t}\n\tif (error !== undefined) throw error;\n\treturn dest;\n};\n","'use strict';\n\nmodule.exports = require('./_iterate')('forEach');\n","'use strict';\n\nvar isFunction = require('../function/is-function')\n  , isObject   = require('./is-object');\n\nmodule.exports = function (x) {\n\treturn ((x != null) && (typeof x.length === 'number') &&\n\n\t\t// Just checking ((typeof x === 'object') && (typeof x !== 'function'))\n\t\t// won't work right for some cases, e.g.:\n\t\t// type of instance of NodeList in Safari is a 'function'\n\n\t\t((isObject(x) && !isFunction(x)) || (typeof x === \"string\"))) || false;\n};\n","// Deprecated\n\n'use strict';\n\nmodule.exports = function (obj) { return typeof obj === 'function'; };\n","'use strict';\n\nvar map = { function: true, object: true };\n\nmodule.exports = function (x) {\n\treturn ((x != null) && map[typeof x]) || false;\n};\n","'use strict';\n\nmodule.exports = require('./is-implemented')()\n\t? Object.keys\n\t: require('./shim');\n","'use strict';\n\nmodule.exports = function () {\n\ttry {\n\t\tObject.keys('primitive');\n\t\treturn true;\n\t} catch (e) { return false; }\n};\n","'use strict';\n\nvar keys = Object.keys;\n\nmodule.exports = function (object) {\n\treturn keys(object == null ? object : Object(object));\n};\n","'use strict';\n\nvar value = require('./valid-value')\n\n  , defineProperty = Object.defineProperty\n  , getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor\n  , getOwnPropertyNames = Object.getOwnPropertyNames;\n\nmodule.exports = function (target, source) {\n\tvar error;\n\ttarget = Object(value(target));\n\tgetOwnPropertyNames(Object(value(source))).forEach(function (name) {\n\t\ttry {\n\t\t\tdefineProperty(target, name, getOwnPropertyDescriptor(source, name));\n\t\t} catch (e) { error = e; }\n\t});\n\tif (error !== undefined) throw error;\n\treturn target;\n};\n","'use strict';\n\nvar forEach = Array.prototype.forEach, create = Object.create;\n\nvar process = function (src, obj) {\n\tvar key;\n\tfor (key in src) obj[key] = src[key];\n};\n\nmodule.exports = function (options/*, options*/) {\n\tvar result = create(null);\n\tforEach.call(arguments, function (options) {\n\t\tif (options == null) return;\n\t\tprocess(Object(options), result);\n\t});\n\treturn result;\n};\n","'use strict';\n\nmodule.exports = function (fn) {\n\tif (typeof fn !== 'function') throw new TypeError(fn + \" is not a function\");\n\treturn fn;\n};\n","'use strict';\n\nvar isObject = require('./is-object');\n\nmodule.exports = function (value) {\n\tif (!isObject(value)) throw new TypeError(value + \" is not an Object\");\n\treturn value;\n};\n","'use strict';\n\nmodule.exports = function (value) {\n\tif (value == null) throw new TypeError(\"Cannot use null or undefined\");\n\treturn value;\n};\n","'use strict';\n\nmodule.exports = require('./is-implemented')()\n\t? String.prototype.contains\n\t: require('./shim');\n","'use strict';\n\nvar str = 'razdwatrzy';\n\nmodule.exports = function () {\n\tif (typeof str.contains !== 'function') return false;\n\treturn ((str.contains('dwa') === true) && (str.contains('foo') === false));\n};\n","'use strict';\n\nvar indexOf = String.prototype.indexOf;\n\nmodule.exports = function (searchString/*, position*/) {\n\treturn indexOf.call(this, searchString, arguments[1]) > -1;\n};\n","'use strict';\n\nvar toInteger = require('../../number/to-integer')\n  , value     = require('../../object/valid-value')\n  , repeat    = require('./repeat')\n\n  , abs = Math.abs, max = Math.max;\n\nmodule.exports = function (fill/*, length*/) {\n\tvar self = String(value(this))\n\t  , sLength = self.length\n\t  , length = arguments[1];\n\n\tlength = isNaN(length) ? 1 : toInteger(length);\n\tfill = repeat.call(String(fill), abs(length));\n\tif (length >= 0) return fill.slice(0, max(0, length - sLength)) + self;\n\treturn self + (((sLength + length) >= 0) ? '' : fill.slice(length + sLength));\n};\n","'use strict';\n\nmodule.exports = require('./is-implemented')()\n\t? String.prototype.repeat\n\t: require('./shim');\n","'use strict';\n\nvar str = 'foo';\n\nmodule.exports = function () {\n\tif (typeof str.repeat !== 'function') return false;\n\treturn (str.repeat(2) === 'foofoo');\n};\n","// Thanks: http://www.2ality.com/2014/01/efficient-string-repeat.html\n\n'use strict';\n\nvar value     = require('../../../object/valid-value')\n  , toInteger = require('../../../number/to-integer');\n\nmodule.exports = function (count) {\n\tvar str = String(value(this)), result;\n\tcount = toInteger(count);\n\tif (count < 0) throw new RangeError(\"Count must be >= 0\");\n\tif (!isFinite(count)) throw new RangeError(\"Count must be < \");\n\tresult = '';\n\tif (!count) return result;\n\twhile (true) {\n\t\tif (count & 1) result += str;\n\t\tcount >>>= 1;\n\t\tif (count <= 0) break;\n\t\tstr += str;\n\t}\n\treturn result;\n};\n","'use strict';\n\nvar toString = Object.prototype.toString\n\n  , id = toString.call('');\n\nmodule.exports = function (x) {\n\treturn (typeof x === 'string') || (x && (typeof x === 'object') &&\n\t\t((x instanceof String) || (toString.call(x) === id))) || false;\n};\n","/*!\n * @overview es6-promise - a tiny implementation of Promises/A+.\n * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)\n * @license   Licensed under MIT license\n *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE\n * @version   3.2.1\n */\n\n(function() {\n    \"use strict\";\n    function lib$es6$promise$utils$$objectOrFunction(x) {\n      return typeof x === 'function' || (typeof x === 'object' && x !== null);\n    }\n\n    function lib$es6$promise$utils$$isFunction(x) {\n      return typeof x === 'function';\n    }\n\n    function lib$es6$promise$utils$$isMaybeThenable(x) {\n      return typeof x === 'object' && x !== null;\n    }\n\n    var lib$es6$promise$utils$$_isArray;\n    if (!Array.isArray) {\n      lib$es6$promise$utils$$_isArray = function (x) {\n        return Object.prototype.toString.call(x) === '[object Array]';\n      };\n    } else {\n      lib$es6$promise$utils$$_isArray = Array.isArray;\n    }\n\n    var lib$es6$promise$utils$$isArray = lib$es6$promise$utils$$_isArray;\n    var lib$es6$promise$asap$$len = 0;\n    var lib$es6$promise$asap$$vertxNext;\n    var lib$es6$promise$asap$$customSchedulerFn;\n\n    var lib$es6$promise$asap$$asap = function asap(callback, arg) {\n      lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len] = callback;\n      lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len + 1] = arg;\n      lib$es6$promise$asap$$len += 2;\n      if (lib$es6$promise$asap$$len === 2) {\n        // If len is 2, that means that we need to schedule an async flush.\n        // If additional callbacks are queued before the queue is flushed, they\n        // will be processed by this flush that we are scheduling.\n        if (lib$es6$promise$asap$$customSchedulerFn) {\n          lib$es6$promise$asap$$customSchedulerFn(lib$es6$promise$asap$$flush);\n        } else {\n          lib$es6$promise$asap$$scheduleFlush();\n        }\n      }\n    }\n\n    function lib$es6$promise$asap$$setScheduler(scheduleFn) {\n      lib$es6$promise$asap$$customSchedulerFn = scheduleFn;\n    }\n\n    function lib$es6$promise$asap$$setAsap(asapFn) {\n      lib$es6$promise$asap$$asap = asapFn;\n    }\n\n    var lib$es6$promise$asap$$browserWindow = (typeof window !== 'undefined') ? window : undefined;\n    var lib$es6$promise$asap$$browserGlobal = lib$es6$promise$asap$$browserWindow || {};\n    var lib$es6$promise$asap$$BrowserMutationObserver = lib$es6$promise$asap$$browserGlobal.MutationObserver || lib$es6$promise$asap$$browserGlobal.WebKitMutationObserver;\n    var lib$es6$promise$asap$$isNode = typeof self === 'undefined' && typeof process !== 'undefined' && {}.toString.call(process) === '[object process]';\n\n    // test for web worker but not in IE10\n    var lib$es6$promise$asap$$isWorker = typeof Uint8ClampedArray !== 'undefined' &&\n      typeof importScripts !== 'undefined' &&\n      typeof MessageChannel !== 'undefined';\n\n    // node\n    function lib$es6$promise$asap$$useNextTick() {\n      // node version 0.10.x displays a deprecation warning when nextTick is used recursively\n      // see https://github.com/cujojs/when/issues/410 for details\n      return function() {\n        process.nextTick(lib$es6$promise$asap$$flush);\n      };\n    }\n\n    // vertx\n    function lib$es6$promise$asap$$useVertxTimer() {\n      return function() {\n        lib$es6$promise$asap$$vertxNext(lib$es6$promise$asap$$flush);\n      };\n    }\n\n    function lib$es6$promise$asap$$useMutationObserver() {\n      var iterations = 0;\n      var observer = new lib$es6$promise$asap$$BrowserMutationObserver(lib$es6$promise$asap$$flush);\n      var node = document.createTextNode('');\n      observer.observe(node, { characterData: true });\n\n      return function() {\n        node.data = (iterations = ++iterations % 2);\n      };\n    }\n\n    // web worker\n    function lib$es6$promise$asap$$useMessageChannel() {\n      var channel = new MessageChannel();\n      channel.port1.onmessage = lib$es6$promise$asap$$flush;\n      return function () {\n        channel.port2.postMessage(0);\n      };\n    }\n\n    function lib$es6$promise$asap$$useSetTimeout() {\n      return function() {\n        setTimeout(lib$es6$promise$asap$$flush, 1);\n      };\n    }\n\n    var lib$es6$promise$asap$$queue = new Array(1000);\n    function lib$es6$promise$asap$$flush() {\n      for (var i = 0; i < lib$es6$promise$asap$$len; i+=2) {\n        var callback = lib$es6$promise$asap$$queue[i];\n        var arg = lib$es6$promise$asap$$queue[i+1];\n\n        callback(arg);\n\n        lib$es6$promise$asap$$queue[i] = undefined;\n        lib$es6$promise$asap$$queue[i+1] = undefined;\n      }\n\n      lib$es6$promise$asap$$len = 0;\n    }\n\n    function lib$es6$promise$asap$$attemptVertx() {\n      try {\n        var r = require;\n        var vertx = r('vertx');\n        lib$es6$promise$asap$$vertxNext = vertx.runOnLoop || vertx.runOnContext;\n        return lib$es6$promise$asap$$useVertxTimer();\n      } catch(e) {\n        return lib$es6$promise$asap$$useSetTimeout();\n      }\n    }\n\n    var lib$es6$promise$asap$$scheduleFlush;\n    // Decide what async method to use to triggering processing of queued callbacks:\n    if (lib$es6$promise$asap$$isNode) {\n      lib$es6$promise$asap$$scheduleFlush = lib$es6$promise$asap$$useNextTick();\n    } else if (lib$es6$promise$asap$$BrowserMutationObserver) {\n      lib$es6$promise$asap$$scheduleFlush = lib$es6$promise$asap$$useMutationObserver();\n    } else if (lib$es6$promise$asap$$isWorker) {\n      lib$es6$promise$asap$$scheduleFlush = lib$es6$promise$asap$$useMessageChannel();\n    } else if (lib$es6$promise$asap$$browserWindow === undefined && typeof require === 'function') {\n      lib$es6$promise$asap$$scheduleFlush = lib$es6$promise$asap$$attemptVertx();\n    } else {\n      lib$es6$promise$asap$$scheduleFlush = lib$es6$promise$asap$$useSetTimeout();\n    }\n    function lib$es6$promise$then$$then(onFulfillment, onRejection) {\n      var parent = this;\n\n      var child = new this.constructor(lib$es6$promise$$internal$$noop);\n\n      if (child[lib$es6$promise$$internal$$PROMISE_ID] === undefined) {\n        lib$es6$promise$$internal$$makePromise(child);\n      }\n\n      var state = parent._state;\n\n      if (state) {\n        var callback = arguments[state - 1];\n        lib$es6$promise$asap$$asap(function(){\n          lib$es6$promise$$internal$$invokeCallback(state, child, callback, parent._result);\n        });\n      } else {\n        lib$es6$promise$$internal$$subscribe(parent, child, onFulfillment, onRejection);\n      }\n\n      return child;\n    }\n    var lib$es6$promise$then$$default = lib$es6$promise$then$$then;\n    function lib$es6$promise$promise$resolve$$resolve(object) {\n      /*jshint validthis:true */\n      var Constructor = this;\n\n      if (object && typeof object === 'object' && object.constructor === Constructor) {\n        return object;\n      }\n\n      var promise = new Constructor(lib$es6$promise$$internal$$noop);\n      lib$es6$promise$$internal$$resolve(promise, object);\n      return promise;\n    }\n    var lib$es6$promise$promise$resolve$$default = lib$es6$promise$promise$resolve$$resolve;\n    var lib$es6$promise$$internal$$PROMISE_ID = Math.random().toString(36).substring(16);\n\n    function lib$es6$promise$$internal$$noop() {}\n\n    var lib$es6$promise$$internal$$PENDING   = void 0;\n    var lib$es6$promise$$internal$$FULFILLED = 1;\n    var lib$es6$promise$$internal$$REJECTED  = 2;\n\n    var lib$es6$promise$$internal$$GET_THEN_ERROR = new lib$es6$promise$$internal$$ErrorObject();\n\n    function lib$es6$promise$$internal$$selfFulfillment() {\n      return new TypeError(\"You cannot resolve a promise with itself\");\n    }\n\n    function lib$es6$promise$$internal$$cannotReturnOwn() {\n      return new TypeError('A promises callback cannot return that same promise.');\n    }\n\n    function lib$es6$promise$$internal$$getThen(promise) {\n      try {\n        return promise.then;\n      } catch(error) {\n        lib$es6$promise$$internal$$GET_THEN_ERROR.error = error;\n        return lib$es6$promise$$internal$$GET_THEN_ERROR;\n      }\n    }\n\n    function lib$es6$promise$$internal$$tryThen(then, value, fulfillmentHandler, rejectionHandler) {\n      try {\n        then.call(value, fulfillmentHandler, rejectionHandler);\n      } catch(e) {\n        return e;\n      }\n    }\n\n    function lib$es6$promise$$internal$$handleForeignThenable(promise, thenable, then) {\n       lib$es6$promise$asap$$asap(function(promise) {\n        var sealed = false;\n        var error = lib$es6$promise$$internal$$tryThen(then, thenable, function(value) {\n          if (sealed) { return; }\n          sealed = true;\n          if (thenable !== value) {\n            lib$es6$promise$$internal$$resolve(promise, value);\n          } else {\n            lib$es6$promise$$internal$$fulfill(promise, value);\n          }\n        }, function(reason) {\n          if (sealed) { return; }\n          sealed = true;\n\n          lib$es6$promise$$internal$$reject(promise, reason);\n        }, 'Settle: ' + (promise._label || ' unknown promise'));\n\n        if (!sealed && error) {\n          sealed = true;\n          lib$es6$promise$$internal$$reject(promise, error);\n        }\n      }, promise);\n    }\n\n    function lib$es6$promise$$internal$$handleOwnThenable(promise, thenable) {\n      if (thenable._state === lib$es6$promise$$internal$$FULFILLED) {\n        lib$es6$promise$$internal$$fulfill(promise, thenable._result);\n      } else if (thenable._state === lib$es6$promise$$internal$$REJECTED) {\n        lib$es6$promise$$internal$$reject(promise, thenable._result);\n      } else {\n        lib$es6$promise$$internal$$subscribe(thenable, undefined, function(value) {\n          lib$es6$promise$$internal$$resolve(promise, value);\n        }, function(reason) {\n          lib$es6$promise$$internal$$reject(promise, reason);\n        });\n      }\n    }\n\n    function lib$es6$promise$$internal$$handleMaybeThenable(promise, maybeThenable, then) {\n      if (maybeThenable.constructor === promise.constructor &&\n          then === lib$es6$promise$then$$default &&\n          constructor.resolve === lib$es6$promise$promise$resolve$$default) {\n        lib$es6$promise$$internal$$handleOwnThenable(promise, maybeThenable);\n      } else {\n        if (then === lib$es6$promise$$internal$$GET_THEN_ERROR) {\n          lib$es6$promise$$internal$$reject(promise, lib$es6$promise$$internal$$GET_THEN_ERROR.error);\n        } else if (then === undefined) {\n          lib$es6$promise$$internal$$fulfill(promise, maybeThenable);\n        } else if (lib$es6$promise$utils$$isFunction(then)) {\n          lib$es6$promise$$internal$$handleForeignThenable(promise, maybeThenable, then);\n        } else {\n          lib$es6$promise$$internal$$fulfill(promise, maybeThenable);\n        }\n      }\n    }\n\n    function lib$es6$promise$$internal$$resolve(promise, value) {\n      if (promise === value) {\n        lib$es6$promise$$internal$$reject(promise, lib$es6$promise$$internal$$selfFulfillment());\n      } else if (lib$es6$promise$utils$$objectOrFunction(value)) {\n        lib$es6$promise$$internal$$handleMaybeThenable(promise, value, lib$es6$promise$$internal$$getThen(value));\n      } else {\n        lib$es6$promise$$internal$$fulfill(promise, value);\n      }\n    }\n\n    function lib$es6$promise$$internal$$publishRejection(promise) {\n      if (promise._onerror) {\n        promise._onerror(promise._result);\n      }\n\n      lib$es6$promise$$internal$$publish(promise);\n    }\n\n    function lib$es6$promise$$internal$$fulfill(promise, value) {\n      if (promise._state !== lib$es6$promise$$internal$$PENDING) { return; }\n\n      promise._result = value;\n      promise._state = lib$es6$promise$$internal$$FULFILLED;\n\n      if (promise._subscribers.length !== 0) {\n        lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish, promise);\n      }\n    }\n\n    function lib$es6$promise$$internal$$reject(promise, reason) {\n      if (promise._state !== lib$es6$promise$$internal$$PENDING) { return; }\n      promise._state = lib$es6$promise$$internal$$REJECTED;\n      promise._result = reason;\n\n      lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publishRejection, promise);\n    }\n\n    function lib$es6$promise$$internal$$subscribe(parent, child, onFulfillment, onRejection) {\n      var subscribers = parent._subscribers;\n      var length = subscribers.length;\n\n      parent._onerror = null;\n\n      subscribers[length] = child;\n      subscribers[length + lib$es6$promise$$internal$$FULFILLED] = onFulfillment;\n      subscribers[length + lib$es6$promise$$internal$$REJECTED]  = onRejection;\n\n      if (length === 0 && parent._state) {\n        lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish, parent);\n      }\n    }\n\n    function lib$es6$promise$$internal$$publish(promise) {\n      var subscribers = promise._subscribers;\n      var settled = promise._state;\n\n      if (subscribers.length === 0) { return; }\n\n      var child, callback, detail = promise._result;\n\n      for (var i = 0; i < subscribers.length; i += 3) {\n        child = subscribers[i];\n        callback = subscribers[i + settled];\n\n        if (child) {\n          lib$es6$promise$$internal$$invokeCallback(settled, child, callback, detail);\n        } else {\n          callback(detail);\n        }\n      }\n\n      promise._subscribers.length = 0;\n    }\n\n    function lib$es6$promise$$internal$$ErrorObject() {\n      this.error = null;\n    }\n\n    var lib$es6$promise$$internal$$TRY_CATCH_ERROR = new lib$es6$promise$$internal$$ErrorObject();\n\n    function lib$es6$promise$$internal$$tryCatch(callback, detail) {\n      try {\n        return callback(detail);\n      } catch(e) {\n        lib$es6$promise$$internal$$TRY_CATCH_ERROR.error = e;\n        return lib$es6$promise$$internal$$TRY_CATCH_ERROR;\n      }\n    }\n\n    function lib$es6$promise$$internal$$invokeCallback(settled, promise, callback, detail) {\n      var hasCallback = lib$es6$promise$utils$$isFunction(callback),\n          value, error, succeeded, failed;\n\n      if (hasCallback) {\n        value = lib$es6$promise$$internal$$tryCatch(callback, detail);\n\n        if (value === lib$es6$promise$$internal$$TRY_CATCH_ERROR) {\n          failed = true;\n          error = value.error;\n          value = null;\n        } else {\n          succeeded = true;\n        }\n\n        if (promise === value) {\n          lib$es6$promise$$internal$$reject(promise, lib$es6$promise$$internal$$cannotReturnOwn());\n          return;\n        }\n\n      } else {\n        value = detail;\n        succeeded = true;\n      }\n\n      if (promise._state !== lib$es6$promise$$internal$$PENDING) {\n        // noop\n      } else if (hasCallback && succeeded) {\n        lib$es6$promise$$internal$$resolve(promise, value);\n      } else if (failed) {\n        lib$es6$promise$$internal$$reject(promise, error);\n      } else if (settled === lib$es6$promise$$internal$$FULFILLED) {\n        lib$es6$promise$$internal$$fulfill(promise, value);\n      } else if (settled === lib$es6$promise$$internal$$REJECTED) {\n        lib$es6$promise$$internal$$reject(promise, value);\n      }\n    }\n\n    function lib$es6$promise$$internal$$initializePromise(promise, resolver) {\n      try {\n        resolver(function resolvePromise(value){\n          lib$es6$promise$$internal$$resolve(promise, value);\n        }, function rejectPromise(reason) {\n          lib$es6$promise$$internal$$reject(promise, reason);\n        });\n      } catch(e) {\n        lib$es6$promise$$internal$$reject(promise, e);\n      }\n    }\n\n    var lib$es6$promise$$internal$$id = 0;\n    function lib$es6$promise$$internal$$nextId() {\n      return lib$es6$promise$$internal$$id++;\n    }\n\n    function lib$es6$promise$$internal$$makePromise(promise) {\n      promise[lib$es6$promise$$internal$$PROMISE_ID] = lib$es6$promise$$internal$$id++;\n      promise._state = undefined;\n      promise._result = undefined;\n      promise._subscribers = [];\n    }\n\n    function lib$es6$promise$promise$all$$all(entries) {\n      return new lib$es6$promise$enumerator$$default(this, entries).promise;\n    }\n    var lib$es6$promise$promise$all$$default = lib$es6$promise$promise$all$$all;\n    function lib$es6$promise$promise$race$$race(entries) {\n      /*jshint validthis:true */\n      var Constructor = this;\n\n      if (!lib$es6$promise$utils$$isArray(entries)) {\n        return new Constructor(function(resolve, reject) {\n          reject(new TypeError('You must pass an array to race.'));\n        });\n      } else {\n        return new Constructor(function(resolve, reject) {\n          var length = entries.length;\n          for (var i = 0; i < length; i++) {\n            Constructor.resolve(entries[i]).then(resolve, reject);\n          }\n        });\n      }\n    }\n    var lib$es6$promise$promise$race$$default = lib$es6$promise$promise$race$$race;\n    function lib$es6$promise$promise$reject$$reject(reason) {\n      /*jshint validthis:true */\n      var Constructor = this;\n      var promise = new Constructor(lib$es6$promise$$internal$$noop);\n      lib$es6$promise$$internal$$reject(promise, reason);\n      return promise;\n    }\n    var lib$es6$promise$promise$reject$$default = lib$es6$promise$promise$reject$$reject;\n\n\n    function lib$es6$promise$promise$$needsResolver() {\n      throw new TypeError('You must pass a resolver function as the first argument to the promise constructor');\n    }\n\n    function lib$es6$promise$promise$$needsNew() {\n      throw new TypeError(\"Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.\");\n    }\n\n    var lib$es6$promise$promise$$default = lib$es6$promise$promise$$Promise;\n    /**\n      Promise objects represent the eventual result of an asynchronous operation. The\n      primary way of interacting with a promise is through its `then` method, which\n      registers callbacks to receive either a promise's eventual value or the reason\n      why the promise cannot be fulfilled.\n\n      Terminology\n      -----------\n\n      - `promise` is an object or function with a `then` method whose behavior conforms to this specification.\n      - `thenable` is an object or function that defines a `then` method.\n      - `value` is any legal JavaScript value (including undefined, a thenable, or a promise).\n      - `exception` is a value that is thrown using the throw statement.\n      - `reason` is a value that indicates why a promise was rejected.\n      - `settled` the final resting state of a promise, fulfilled or rejected.\n\n      A promise can be in one of three states: pending, fulfilled, or rejected.\n\n      Promises that are fulfilled have a fulfillment value and are in the fulfilled\n      state.  Promises that are rejected have a rejection reason and are in the\n      rejected state.  A fulfillment value is never a thenable.\n\n      Promises can also be said to *resolve* a value.  If this value is also a\n      promise, then the original promise's settled state will match the value's\n      settled state.  So a promise that *resolves* a promise that rejects will\n      itself reject, and a promise that *resolves* a promise that fulfills will\n      itself fulfill.\n\n\n      Basic Usage:\n      ------------\n\n      ```js\n      var promise = new Promise(function(resolve, reject) {\n        // on success\n        resolve(value);\n\n        // on failure\n        reject(reason);\n      });\n\n      promise.then(function(value) {\n        // on fulfillment\n      }, function(reason) {\n        // on rejection\n      });\n      ```\n\n      Advanced Usage:\n      ---------------\n\n      Promises shine when abstracting away asynchronous interactions such as\n      `XMLHttpRequest`s.\n\n      ```js\n      function getJSON(url) {\n        return new Promise(function(resolve, reject){\n          var xhr = new XMLHttpRequest();\n\n          xhr.open('GET', url);\n          xhr.onreadystatechange = handler;\n          xhr.responseType = 'json';\n          xhr.setRequestHeader('Accept', 'application/json');\n          xhr.send();\n\n          function handler() {\n            if (this.readyState === this.DONE) {\n              if (this.status === 200) {\n                resolve(this.response);\n              } else {\n                reject(new Error('getJSON: `' + url + '` failed with status: [' + this.status + ']'));\n              }\n            }\n          };\n        });\n      }\n\n      getJSON('/posts.json').then(function(json) {\n        // on fulfillment\n      }, function(reason) {\n        // on rejection\n      });\n      ```\n\n      Unlike callbacks, promises are great composable primitives.\n\n      ```js\n      Promise.all([\n        getJSON('/posts'),\n        getJSON('/comments')\n      ]).then(function(values){\n        values[0] // => postsJSON\n        values[1] // => commentsJSON\n\n        return values;\n      });\n      ```\n\n      @class Promise\n      @param {function} resolver\n      Useful for tooling.\n      @constructor\n    */\n    function lib$es6$promise$promise$$Promise(resolver) {\n      this[lib$es6$promise$$internal$$PROMISE_ID] = lib$es6$promise$$internal$$nextId();\n      this._result = this._state = undefined;\n      this._subscribers = [];\n\n      if (lib$es6$promise$$internal$$noop !== resolver) {\n        typeof resolver !== 'function' && lib$es6$promise$promise$$needsResolver();\n        this instanceof lib$es6$promise$promise$$Promise ? lib$es6$promise$$internal$$initializePromise(this, resolver) : lib$es6$promise$promise$$needsNew();\n      }\n    }\n\n    lib$es6$promise$promise$$Promise.all = lib$es6$promise$promise$all$$default;\n    lib$es6$promise$promise$$Promise.race = lib$es6$promise$promise$race$$default;\n    lib$es6$promise$promise$$Promise.resolve = lib$es6$promise$promise$resolve$$default;\n    lib$es6$promise$promise$$Promise.reject = lib$es6$promise$promise$reject$$default;\n    lib$es6$promise$promise$$Promise._setScheduler = lib$es6$promise$asap$$setScheduler;\n    lib$es6$promise$promise$$Promise._setAsap = lib$es6$promise$asap$$setAsap;\n    lib$es6$promise$promise$$Promise._asap = lib$es6$promise$asap$$asap;\n\n    lib$es6$promise$promise$$Promise.prototype = {\n      constructor: lib$es6$promise$promise$$Promise,\n\n    /**\n      The primary way of interacting with a promise is through its `then` method,\n      which registers callbacks to receive either a promise's eventual value or the\n      reason why the promise cannot be fulfilled.\n\n      ```js\n      findUser().then(function(user){\n        // user is available\n      }, function(reason){\n        // user is unavailable, and you are given the reason why\n      });\n      ```\n\n      Chaining\n      --------\n\n      The return value of `then` is itself a promise.  This second, 'downstream'\n      promise is resolved with the return value of the first promise's fulfillment\n      or rejection handler, or rejected if the handler throws an exception.\n\n      ```js\n      findUser().then(function (user) {\n        return user.name;\n      }, function (reason) {\n        return 'default name';\n      }).then(function (userName) {\n        // If `findUser` fulfilled, `userName` will be the user's name, otherwise it\n        // will be `'default name'`\n      });\n\n      findUser().then(function (user) {\n        throw new Error('Found user, but still unhappy');\n      }, function (reason) {\n        throw new Error('`findUser` rejected and we're unhappy');\n      }).then(function (value) {\n        // never reached\n      }, function (reason) {\n        // if `findUser` fulfilled, `reason` will be 'Found user, but still unhappy'.\n        // If `findUser` rejected, `reason` will be '`findUser` rejected and we're unhappy'.\n      });\n      ```\n      If the downstream promise does not specify a rejection handler, rejection reasons will be propagated further downstream.\n\n      ```js\n      findUser().then(function (user) {\n        throw new PedagogicalException('Upstream error');\n      }).then(function (value) {\n        // never reached\n      }).then(function (value) {\n        // never reached\n      }, function (reason) {\n        // The `PedgagocialException` is propagated all the way down to here\n      });\n      ```\n\n      Assimilation\n      ------------\n\n      Sometimes the value you want to propagate to a downstream promise can only be\n      retrieved asynchronously. This can be achieved by returning a promise in the\n      fulfillment or rejection handler. The downstream promise will then be pending\n      until the returned promise is settled. This is called *assimilation*.\n\n      ```js\n      findUser().then(function (user) {\n        return findCommentsByAuthor(user);\n      }).then(function (comments) {\n        // The user's comments are now available\n      });\n      ```\n\n      If the assimliated promise rejects, then the downstream promise will also reject.\n\n      ```js\n      findUser().then(function (user) {\n        return findCommentsByAuthor(user);\n      }).then(function (comments) {\n        // If `findCommentsByAuthor` fulfills, we'll have the value here\n      }, function (reason) {\n        // If `findCommentsByAuthor` rejects, we'll have the reason here\n      });\n      ```\n\n      Simple Example\n      --------------\n\n      Synchronous Example\n\n      ```javascript\n      var result;\n\n      try {\n        result = findResult();\n        // success\n      } catch(reason) {\n        // failure\n      }\n      ```\n\n      Errback Example\n\n      ```js\n      findResult(function(result, err){\n        if (err) {\n          // failure\n        } else {\n          // success\n        }\n      });\n      ```\n\n      Promise Example;\n\n      ```javascript\n      findResult().then(function(result){\n        // success\n      }, function(reason){\n        // failure\n      });\n      ```\n\n      Advanced Example\n      --------------\n\n      Synchronous Example\n\n      ```javascript\n      var author, books;\n\n      try {\n        author = findAuthor();\n        books  = findBooksByAuthor(author);\n        // success\n      } catch(reason) {\n        // failure\n      }\n      ```\n\n      Errback Example\n\n      ```js\n\n      function foundBooks(books) {\n\n      }\n\n      function failure(reason) {\n\n      }\n\n      findAuthor(function(author, err){\n        if (err) {\n          failure(err);\n          // failure\n        } else {\n          try {\n            findBoooksByAuthor(author, function(books, err) {\n              if (err) {\n                failure(err);\n              } else {\n                try {\n                  foundBooks(books);\n                } catch(reason) {\n                  failure(reason);\n                }\n              }\n            });\n          } catch(error) {\n            failure(err);\n          }\n          // success\n        }\n      });\n      ```\n\n      Promise Example;\n\n      ```javascript\n      findAuthor().\n        then(findBooksByAuthor).\n        then(function(books){\n          // found books\n      }).catch(function(reason){\n        // something went wrong\n      });\n      ```\n\n      @method then\n      @param {Function} onFulfilled\n      @param {Function} onRejected\n      Useful for tooling.\n      @return {Promise}\n    */\n      then: lib$es6$promise$then$$default,\n\n    /**\n      `catch` is simply sugar for `then(undefined, onRejection)` which makes it the same\n      as the catch block of a try/catch statement.\n\n      ```js\n      function findAuthor(){\n        throw new Error('couldn't find that author');\n      }\n\n      // synchronous\n      try {\n        findAuthor();\n      } catch(reason) {\n        // something went wrong\n      }\n\n      // async with promises\n      findAuthor().catch(function(reason){\n        // something went wrong\n      });\n      ```\n\n      @method catch\n      @param {Function} onRejection\n      Useful for tooling.\n      @return {Promise}\n    */\n      'catch': function(onRejection) {\n        return this.then(null, onRejection);\n      }\n    };\n    var lib$es6$promise$enumerator$$default = lib$es6$promise$enumerator$$Enumerator;\n    function lib$es6$promise$enumerator$$Enumerator(Constructor, input) {\n      this._instanceConstructor = Constructor;\n      this.promise = new Constructor(lib$es6$promise$$internal$$noop);\n\n      if (!this.promise[lib$es6$promise$$internal$$PROMISE_ID]) {\n        lib$es6$promise$$internal$$makePromise(this.promise);\n      }\n\n      if (lib$es6$promise$utils$$isArray(input)) {\n        this._input     = input;\n        this.length     = input.length;\n        this._remaining = input.length;\n\n        this._result = new Array(this.length);\n\n        if (this.length === 0) {\n          lib$es6$promise$$internal$$fulfill(this.promise, this._result);\n        } else {\n          this.length = this.length || 0;\n          this._enumerate();\n          if (this._remaining === 0) {\n            lib$es6$promise$$internal$$fulfill(this.promise, this._result);\n          }\n        }\n      } else {\n        lib$es6$promise$$internal$$reject(this.promise, lib$es6$promise$enumerator$$validationError());\n      }\n    }\n\n    function lib$es6$promise$enumerator$$validationError() {\n      return new Error('Array Methods must be provided an Array');\n    }\n\n    lib$es6$promise$enumerator$$Enumerator.prototype._enumerate = function() {\n      var length  = this.length;\n      var input   = this._input;\n\n      for (var i = 0; this._state === lib$es6$promise$$internal$$PENDING && i < length; i++) {\n        this._eachEntry(input[i], i);\n      }\n    };\n\n    lib$es6$promise$enumerator$$Enumerator.prototype._eachEntry = function(entry, i) {\n      var c = this._instanceConstructor;\n      var resolve = c.resolve;\n\n      if (resolve === lib$es6$promise$promise$resolve$$default) {\n        var then = lib$es6$promise$$internal$$getThen(entry);\n\n        if (then === lib$es6$promise$then$$default &&\n            entry._state !== lib$es6$promise$$internal$$PENDING) {\n          this._settledAt(entry._state, i, entry._result);\n        } else if (typeof then !== 'function') {\n          this._remaining--;\n          this._result[i] = entry;\n        } else if (c === lib$es6$promise$promise$$default) {\n          var promise = new c(lib$es6$promise$$internal$$noop);\n          lib$es6$promise$$internal$$handleMaybeThenable(promise, entry, then);\n          this._willSettleAt(promise, i);\n        } else {\n          this._willSettleAt(new c(function(resolve) { resolve(entry); }), i);\n        }\n      } else {\n        this._willSettleAt(resolve(entry), i);\n      }\n    };\n\n    lib$es6$promise$enumerator$$Enumerator.prototype._settledAt = function(state, i, value) {\n      var promise = this.promise;\n\n      if (promise._state === lib$es6$promise$$internal$$PENDING) {\n        this._remaining--;\n\n        if (state === lib$es6$promise$$internal$$REJECTED) {\n          lib$es6$promise$$internal$$reject(promise, value);\n        } else {\n          this._result[i] = value;\n        }\n      }\n\n      if (this._remaining === 0) {\n        lib$es6$promise$$internal$$fulfill(promise, this._result);\n      }\n    };\n\n    lib$es6$promise$enumerator$$Enumerator.prototype._willSettleAt = function(promise, i) {\n      var enumerator = this;\n\n      lib$es6$promise$$internal$$subscribe(promise, undefined, function(value) {\n        enumerator._settledAt(lib$es6$promise$$internal$$FULFILLED, i, value);\n      }, function(reason) {\n        enumerator._settledAt(lib$es6$promise$$internal$$REJECTED, i, reason);\n      });\n    };\n    function lib$es6$promise$polyfill$$polyfill() {\n      var local;\n\n      if (typeof global !== 'undefined') {\n          local = global;\n      } else if (typeof self !== 'undefined') {\n          local = self;\n      } else {\n          try {\n              local = Function('return this')();\n          } catch (e) {\n              throw new Error('polyfill failed because global object is unavailable in this environment');\n          }\n      }\n\n      var P = local.Promise;\n\n      if (P && Object.prototype.toString.call(P.resolve()) === '[object Promise]' && !P.cast) {\n        return;\n      }\n\n      local.Promise = lib$es6$promise$promise$$default;\n    }\n    var lib$es6$promise$polyfill$$default = lib$es6$promise$polyfill$$polyfill;\n\n    var lib$es6$promise$umd$$ES6Promise = {\n      'Promise': lib$es6$promise$promise$$default,\n      'polyfill': lib$es6$promise$polyfill$$default\n    };\n\n    /* global define:true module:true window: true */\n    if (typeof define === 'function' && define['amd']) {\n      define(function() { return lib$es6$promise$umd$$ES6Promise; });\n    } else if (typeof module !== 'undefined' && module['exports']) {\n      module['exports'] = lib$es6$promise$umd$$ES6Promise;\n    } else if (typeof this !== 'undefined') {\n      this['ES6Promise'] = lib$es6$promise$umd$$ES6Promise;\n    }\n\n    lib$es6$promise$polyfill$$default();\n}).call(this);\n\n","'use strict';\n\nmodule.exports = require('./is-implemented')() ? Symbol : require('./polyfill');\n","'use strict';\n\nmodule.exports = function () {\n\tvar symbol;\n\tif (typeof Symbol !== 'function') return false;\n\tsymbol = Symbol('test symbol');\n\ttry { String(symbol); } catch (e) { return false; }\n\tif (typeof Symbol.iterator === 'symbol') return true;\n\n\t// Return 'true' for polyfills\n\tif (typeof Symbol.isConcatSpreadable !== 'object') return false;\n\tif (typeof Symbol.iterator !== 'object') return false;\n\tif (typeof Symbol.toPrimitive !== 'object') return false;\n\tif (typeof Symbol.toStringTag !== 'object') return false;\n\tif (typeof Symbol.unscopables !== 'object') return false;\n\n\treturn true;\n};\n","'use strict';\n\nmodule.exports = function (x) {\n\treturn (x && ((typeof x === 'symbol') || (x['@@toStringTag'] === 'Symbol'))) || false;\n};\n","// ES2015 Symbol polyfill for environments that do not support it (or partially support it_\n\n'use strict';\n\nvar d              = require('d')\n  , validateSymbol = require('./validate-symbol')\n\n  , create = Object.create, defineProperties = Object.defineProperties\n  , defineProperty = Object.defineProperty, objPrototype = Object.prototype\n  , NativeSymbol, SymbolPolyfill, HiddenSymbol, globalSymbols = create(null);\n\nif (typeof Symbol === 'function') NativeSymbol = Symbol;\n\nvar generateName = (function () {\n\tvar created = create(null);\n\treturn function (desc) {\n\t\tvar postfix = 0, name, ie11BugWorkaround;\n\t\twhile (created[desc + (postfix || '')]) ++postfix;\n\t\tdesc += (postfix || '');\n\t\tcreated[desc] = true;\n\t\tname = '@@' + desc;\n\t\tdefineProperty(objPrototype, name, d.gs(null, function (value) {\n\t\t\t// For IE11 issue see:\n\t\t\t// https://connect.microsoft.com/IE/feedbackdetail/view/1928508/\n\t\t\t//    ie11-broken-getters-on-dom-objects\n\t\t\t// https://github.com/medikoo/es6-symbol/issues/12\n\t\t\tif (ie11BugWorkaround) return;\n\t\t\tie11BugWorkaround = true;\n\t\t\tdefineProperty(this, name, d(value));\n\t\t\tie11BugWorkaround = false;\n\t\t}));\n\t\treturn name;\n\t};\n}());\n\n// Internal constructor (not one exposed) for creating Symbol instances.\n// This one is used to ensure that `someSymbol instanceof Symbol` always return false\nHiddenSymbol = function Symbol(description) {\n\tif (this instanceof HiddenSymbol) throw new TypeError('TypeError: Symbol is not a constructor');\n\treturn SymbolPolyfill(description);\n};\n\n// Exposed `Symbol` constructor\n// (returns instances of HiddenSymbol)\nmodule.exports = SymbolPolyfill = function Symbol(description) {\n\tvar symbol;\n\tif (this instanceof Symbol) throw new TypeError('TypeError: Symbol is not a constructor');\n\tsymbol = create(HiddenSymbol.prototype);\n\tdescription = (description === undefined ? '' : String(description));\n\treturn defineProperties(symbol, {\n\t\t__description__: d('', description),\n\t\t__name__: d('', generateName(description))\n\t});\n};\ndefineProperties(SymbolPolyfill, {\n\tfor: d(function (key) {\n\t\tif (globalSymbols[key]) return globalSymbols[key];\n\t\treturn (globalSymbols[key] = SymbolPolyfill(String(key)));\n\t}),\n\tkeyFor: d(function (s) {\n\t\tvar key;\n\t\tvalidateSymbol(s);\n\t\tfor (key in globalSymbols) if (globalSymbols[key] === s) return key;\n\t}),\n\n\t// If there's native implementation of given symbol, let's fallback to it\n\t// to ensure proper interoperability with other native functions e.g. Array.from\n\thasInstance: d('', (NativeSymbol && NativeSymbol.hasInstance) || SymbolPolyfill('hasInstance')),\n\tisConcatSpreadable: d('', (NativeSymbol && NativeSymbol.isConcatSpreadable) ||\n\t\tSymbolPolyfill('isConcatSpreadable')),\n\titerator: d('', (NativeSymbol && NativeSymbol.iterator) || SymbolPolyfill('iterator')),\n\tmatch: d('', (NativeSymbol && NativeSymbol.match) || SymbolPolyfill('match')),\n\treplace: d('', (NativeSymbol && NativeSymbol.replace) || SymbolPolyfill('replace')),\n\tsearch: d('', (NativeSymbol && NativeSymbol.search) || SymbolPolyfill('search')),\n\tspecies: d('', (NativeSymbol && NativeSymbol.species) || SymbolPolyfill('species')),\n\tsplit: d('', (NativeSymbol && NativeSymbol.split) || SymbolPolyfill('split')),\n\ttoPrimitive: d('', (NativeSymbol && NativeSymbol.toPrimitive) || SymbolPolyfill('toPrimitive')),\n\ttoStringTag: d('', (NativeSymbol && NativeSymbol.toStringTag) || SymbolPolyfill('toStringTag')),\n\tunscopables: d('', (NativeSymbol && NativeSymbol.unscopables) || SymbolPolyfill('unscopables'))\n});\n\n// Internal tweaks for real symbol producer\ndefineProperties(HiddenSymbol.prototype, {\n\tconstructor: d(SymbolPolyfill),\n\ttoString: d('', function () { return this.__name__; })\n});\n\n// Proper implementation of methods exposed on Symbol.prototype\n// They won't be accessible on produced symbol instances as they derive from HiddenSymbol.prototype\ndefineProperties(SymbolPolyfill.prototype, {\n\ttoString: d(function () { return 'Symbol (' + validateSymbol(this).__description__ + ')'; }),\n\tvalueOf: d(function () { return validateSymbol(this); })\n});\ndefineProperty(SymbolPolyfill.prototype, SymbolPolyfill.toPrimitive, d('',\n\tfunction () { return validateSymbol(this); }));\ndefineProperty(SymbolPolyfill.prototype, SymbolPolyfill.toStringTag, d('c', 'Symbol'));\n\n// Proper implementaton of toPrimitive and toStringTag for returned symbol instances\ndefineProperty(HiddenSymbol.prototype, SymbolPolyfill.toStringTag,\n\td('c', SymbolPolyfill.prototype[SymbolPolyfill.toStringTag]));\n\n// Note: It's important to define `toPrimitive` as last one, as some implementations\n// implement `toPrimitive` natively without implementing `toStringTag` (or other specified symbols)\n// And that may invoke error in definition flow:\n// See: https://github.com/medikoo/es6-symbol/issues/13#issuecomment-164146149\ndefineProperty(HiddenSymbol.prototype, SymbolPolyfill.toPrimitive,\n\td('c', SymbolPolyfill.prototype[SymbolPolyfill.toPrimitive]));\n","'use strict';\n\nvar isSymbol = require('./is-symbol');\n\nmodule.exports = function (value) {\n\tif (!isSymbol(value)) throw new TypeError(value + \" is not a symbol\");\n\treturn value;\n};\n","'use strict';\n\nvar d        = require('d')\n  , callable = require('es5-ext/object/valid-callable')\n\n  , apply = Function.prototype.apply, call = Function.prototype.call\n  , create = Object.create, defineProperty = Object.defineProperty\n  , defineProperties = Object.defineProperties\n  , hasOwnProperty = Object.prototype.hasOwnProperty\n  , descriptor = { configurable: true, enumerable: false, writable: true }\n\n  , on, once, off, emit, methods, descriptors, base;\n\non = function (type, listener) {\n\tvar data;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) {\n\t\tdata = descriptor.value = create(null);\n\t\tdefineProperty(this, '__ee__', descriptor);\n\t\tdescriptor.value = null;\n\t} else {\n\t\tdata = this.__ee__;\n\t}\n\tif (!data[type]) data[type] = listener;\n\telse if (typeof data[type] === 'object') data[type].push(listener);\n\telse data[type] = [data[type], listener];\n\n\treturn this;\n};\n\nonce = function (type, listener) {\n\tvar once, self;\n\n\tcallable(listener);\n\tself = this;\n\ton.call(this, type, once = function () {\n\t\toff.call(self, type, once);\n\t\tapply.call(listener, this, arguments);\n\t});\n\n\tonce.__eeOnceListener__ = listener;\n\treturn this;\n};\n\noff = function (type, listener) {\n\tvar data, listeners, candidate, i;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return this;\n\tdata = this.__ee__;\n\tif (!data[type]) return this;\n\tlisteners = data[type];\n\n\tif (typeof listeners === 'object') {\n\t\tfor (i = 0; (candidate = listeners[i]); ++i) {\n\t\t\tif ((candidate === listener) ||\n\t\t\t\t\t(candidate.__eeOnceListener__ === listener)) {\n\t\t\t\tif (listeners.length === 2) data[type] = listeners[i ? 0 : 1];\n\t\t\t\telse listeners.splice(i, 1);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif ((listeners === listener) ||\n\t\t\t\t(listeners.__eeOnceListener__ === listener)) {\n\t\t\tdelete data[type];\n\t\t}\n\t}\n\n\treturn this;\n};\n\nemit = function (type) {\n\tvar i, l, listener, listeners, args;\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return;\n\tlisteners = this.__ee__[type];\n\tif (!listeners) return;\n\n\tif (typeof listeners === 'object') {\n\t\tl = arguments.length;\n\t\targs = new Array(l - 1);\n\t\tfor (i = 1; i < l; ++i) args[i - 1] = arguments[i];\n\n\t\tlisteners = listeners.slice();\n\t\tfor (i = 0; (listener = listeners[i]); ++i) {\n\t\t\tapply.call(listener, this, args);\n\t\t}\n\t} else {\n\t\tswitch (arguments.length) {\n\t\tcase 1:\n\t\t\tcall.call(listeners, this);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tcall.call(listeners, this, arguments[1]);\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tcall.call(listeners, this, arguments[1], arguments[2]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tl = arguments.length;\n\t\t\targs = new Array(l - 1);\n\t\t\tfor (i = 1; i < l; ++i) {\n\t\t\t\targs[i - 1] = arguments[i];\n\t\t\t}\n\t\t\tapply.call(listeners, this, args);\n\t\t}\n\t}\n};\n\nmethods = {\n\ton: on,\n\tonce: once,\n\toff: off,\n\temit: emit\n};\n\ndescriptors = {\n\ton: d(on),\n\tonce: d(once),\n\toff: d(off),\n\temit: d(emit)\n};\n\nbase = defineProperties({}, descriptors);\n\nmodule.exports = exports = function (o) {\n\treturn (o == null) ? create(base) : defineProperties(Object(o), descriptors);\n};\nexports.methods = methods;\n","'use strict';\n\nvar forEach    = require('es5-ext/object/for-each')\n  , validValue = require('es5-ext/object/valid-object')\n\n  , push = Array.prototype.apply, defineProperty = Object.defineProperty\n  , create = Object.create, hasOwnProperty = Object.prototype.hasOwnProperty\n  , d = { configurable: true, enumerable: false, writable: true };\n\nmodule.exports = function (e1, e2) {\n\tvar data;\n\t(validValue(e1) && validValue(e2));\n\tif (!hasOwnProperty.call(e1, '__ee__')) {\n\t\tif (!hasOwnProperty.call(e2, '__ee__')) {\n\t\t\td.value = create(null);\n\t\t\tdefineProperty(e1, '__ee__', d);\n\t\t\tdefineProperty(e2, '__ee__', d);\n\t\t\td.value = null;\n\t\t\treturn;\n\t\t}\n\t\td.value = e2.__ee__;\n\t\tdefineProperty(e1, '__ee__', d);\n\t\td.value = null;\n\t\treturn;\n\t}\n\tdata = d.value = e1.__ee__;\n\tif (!hasOwnProperty.call(e2, '__ee__')) {\n\t\tdefineProperty(e2, '__ee__', d);\n\t\td.value = null;\n\t\treturn;\n\t}\n\tif (data === e2.__ee__) return;\n\tforEach(e2.__ee__, function (listener, name) {\n\t\tif (!data[name]) {\n\t\t\tdata[name] = listener;\n\t\t\treturn;\n\t\t}\n\t\tif (typeof data[name] === 'object') {\n\t\t\tif (typeof listener === 'object') push.apply(data[name], listener);\n\t\t\telse data[name].push(listener);\n\t\t} else if (typeof listener === 'object') {\n\t\t\tlistener.unshift(data[name]);\n\t\t\tdata[name] = listener;\n\t\t} else {\n\t\t\tdata[name] = [data[name], listener];\n\t\t}\n\t});\n\tdefineProperty(e2, '__ee__', d);\n\td.value = null;\n};\n","'use strict';\n\nvar callable, byObserver;\n\ncallable = function (fn) {\n\tif (typeof fn !== 'function') throw new TypeError(fn + \" is not a function\");\n\treturn fn;\n};\n\nbyObserver = function (Observer) {\n\tvar node = document.createTextNode(''), queue, i = 0;\n\tnew Observer(function () {\n\t\tvar data;\n\t\tif (!queue) return;\n\t\tdata = queue;\n\t\tqueue = null;\n\t\tif (typeof data === 'function') {\n\t\t\tdata();\n\t\t\treturn;\n\t\t}\n\t\tdata.forEach(function (fn) { fn(); });\n\t}).observe(node, { characterData: true });\n\treturn function (fn) {\n\t\tcallable(fn);\n\t\tif (queue) {\n\t\t\tif (typeof queue === 'function') queue = [queue, fn];\n\t\t\telse queue.push(fn);\n\t\t\treturn;\n\t\t}\n\t\tqueue = fn;\n\t\tnode.data = (i = ++i % 2);\n\t};\n};\n\nmodule.exports = (function () {\n\t// Node.js\n\tif ((typeof process !== 'undefined') && process &&\n\t\t\t(typeof process.nextTick === 'function')) {\n\t\treturn process.nextTick;\n\t}\n\n\t// MutationObserver=\n\tif ((typeof document === 'object') && document) {\n\t\tif (typeof MutationObserver === 'function') {\n\t\t\treturn byObserver(MutationObserver);\n\t\t}\n\t\tif (typeof WebKitMutationObserver === 'function') {\n\t\t\treturn byObserver(WebKitMutationObserver);\n\t\t}\n\t}\n\n\t// W3C Draft\n\t// http://dvcs.w3.org/hg/webperf/raw-file/tip/specs/setImmediate/Overview.html\n\tif (typeof setImmediate === 'function') {\n\t\treturn function (cb) { setImmediate(callable(cb)); };\n\t}\n\n\t// Wide available standard\n\tif (typeof setTimeout === 'function') {\n\t\treturn function (cb) { setTimeout(callable(cb), 0); };\n\t}\n\n\treturn null;\n}());\n","// shim for using process in browser\n\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\n(function () {\n  try {\n    cachedSetTimeout = setTimeout;\n  } catch (e) {\n    cachedSetTimeout = function () {\n      throw new Error('setTimeout is not defined');\n    }\n  }\n  try {\n    cachedClearTimeout = clearTimeout;\n  } catch (e) {\n    cachedClearTimeout = function () {\n      throw new Error('clearTimeout is not defined');\n    }\n  }\n} ())\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = cachedSetTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    cachedClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        cachedSetTimeout(drainQueue, 0);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","(function (factory) {\n    if (typeof exports === 'object') {\n        // Node/CommonJS\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD\n        define(factory);\n    } else {\n        // Browser globals (with support for web workers)\n        var glob;\n\n        try {\n            glob = window;\n        } catch (e) {\n            glob = self;\n        }\n\n        glob.SparkMD5 = factory();\n    }\n}(function (undefined) {\n\n    'use strict';\n\n    /*\n     * Fastest md5 implementation around (JKM md5).\n     * Credits: Joseph Myers\n     *\n     * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n     * @see http://jsperf.com/md5-shootout/7\n     */\n\n    /* this function is much faster,\n      so if possible we use it. Some IEs\n      are the only ones I know of that\n      need the idiotic second function,\n      generated by an if clause.  */\n    var add32 = function (a, b) {\n        return (a + b) & 0xFFFFFFFF;\n    },\n        hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];\n\n\n    function cmn(q, a, b, x, s, t) {\n        a = add32(add32(a, q), add32(x, t));\n        return add32((a << s) | (a >>> (32 - s)), b);\n    }\n\n    function ff(a, b, c, d, x, s, t) {\n        return cmn((b & c) | ((~b) & d), a, b, x, s, t);\n    }\n\n    function gg(a, b, c, d, x, s, t) {\n        return cmn((b & d) | (c & (~d)), a, b, x, s, t);\n    }\n\n    function hh(a, b, c, d, x, s, t) {\n        return cmn(b ^ c ^ d, a, b, x, s, t);\n    }\n\n    function ii(a, b, c, d, x, s, t) {\n        return cmn(c ^ (b | (~d)), a, b, x, s, t);\n    }\n\n    function md5cycle(x, k) {\n        var a = x[0],\n            b = x[1],\n            c = x[2],\n            d = x[3];\n\n        a = ff(a, b, c, d, k[0], 7, -680876936);\n        d = ff(d, a, b, c, k[1], 12, -389564586);\n        c = ff(c, d, a, b, k[2], 17, 606105819);\n        b = ff(b, c, d, a, k[3], 22, -1044525330);\n        a = ff(a, b, c, d, k[4], 7, -176418897);\n        d = ff(d, a, b, c, k[5], 12, 1200080426);\n        c = ff(c, d, a, b, k[6], 17, -1473231341);\n        b = ff(b, c, d, a, k[7], 22, -45705983);\n        a = ff(a, b, c, d, k[8], 7, 1770035416);\n        d = ff(d, a, b, c, k[9], 12, -1958414417);\n        c = ff(c, d, a, b, k[10], 17, -42063);\n        b = ff(b, c, d, a, k[11], 22, -1990404162);\n        a = ff(a, b, c, d, k[12], 7, 1804603682);\n        d = ff(d, a, b, c, k[13], 12, -40341101);\n        c = ff(c, d, a, b, k[14], 17, -1502002290);\n        b = ff(b, c, d, a, k[15], 22, 1236535329);\n\n        a = gg(a, b, c, d, k[1], 5, -165796510);\n        d = gg(d, a, b, c, k[6], 9, -1069501632);\n        c = gg(c, d, a, b, k[11], 14, 643717713);\n        b = gg(b, c, d, a, k[0], 20, -373897302);\n        a = gg(a, b, c, d, k[5], 5, -701558691);\n        d = gg(d, a, b, c, k[10], 9, 38016083);\n        c = gg(c, d, a, b, k[15], 14, -660478335);\n        b = gg(b, c, d, a, k[4], 20, -405537848);\n        a = gg(a, b, c, d, k[9], 5, 568446438);\n        d = gg(d, a, b, c, k[14], 9, -1019803690);\n        c = gg(c, d, a, b, k[3], 14, -187363961);\n        b = gg(b, c, d, a, k[8], 20, 1163531501);\n        a = gg(a, b, c, d, k[13], 5, -1444681467);\n        d = gg(d, a, b, c, k[2], 9, -51403784);\n        c = gg(c, d, a, b, k[7], 14, 1735328473);\n        b = gg(b, c, d, a, k[12], 20, -1926607734);\n\n        a = hh(a, b, c, d, k[5], 4, -378558);\n        d = hh(d, a, b, c, k[8], 11, -2022574463);\n        c = hh(c, d, a, b, k[11], 16, 1839030562);\n        b = hh(b, c, d, a, k[14], 23, -35309556);\n        a = hh(a, b, c, d, k[1], 4, -1530992060);\n        d = hh(d, a, b, c, k[4], 11, 1272893353);\n        c = hh(c, d, a, b, k[7], 16, -155497632);\n        b = hh(b, c, d, a, k[10], 23, -1094730640);\n        a = hh(a, b, c, d, k[13], 4, 681279174);\n        d = hh(d, a, b, c, k[0], 11, -358537222);\n        c = hh(c, d, a, b, k[3], 16, -722521979);\n        b = hh(b, c, d, a, k[6], 23, 76029189);\n        a = hh(a, b, c, d, k[9], 4, -640364487);\n        d = hh(d, a, b, c, k[12], 11, -421815835);\n        c = hh(c, d, a, b, k[15], 16, 530742520);\n        b = hh(b, c, d, a, k[2], 23, -995338651);\n\n        a = ii(a, b, c, d, k[0], 6, -198630844);\n        d = ii(d, a, b, c, k[7], 10, 1126891415);\n        c = ii(c, d, a, b, k[14], 15, -1416354905);\n        b = ii(b, c, d, a, k[5], 21, -57434055);\n        a = ii(a, b, c, d, k[12], 6, 1700485571);\n        d = ii(d, a, b, c, k[3], 10, -1894986606);\n        c = ii(c, d, a, b, k[10], 15, -1051523);\n        b = ii(b, c, d, a, k[1], 21, -2054922799);\n        a = ii(a, b, c, d, k[8], 6, 1873313359);\n        d = ii(d, a, b, c, k[15], 10, -30611744);\n        c = ii(c, d, a, b, k[6], 15, -1560198380);\n        b = ii(b, c, d, a, k[13], 21, 1309151649);\n        a = ii(a, b, c, d, k[4], 6, -145523070);\n        d = ii(d, a, b, c, k[11], 10, -1120210379);\n        c = ii(c, d, a, b, k[2], 15, 718787259);\n        b = ii(b, c, d, a, k[9], 21, -343485551);\n\n        x[0] = add32(a, x[0]);\n        x[1] = add32(b, x[1]);\n        x[2] = add32(c, x[2]);\n        x[3] = add32(d, x[3]);\n    }\n\n    function md5blk(s) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n        }\n        return md5blks;\n    }\n\n    function md5blk_array(a) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n        }\n        return md5blks;\n    }\n\n    function md51(s) {\n        var n = s.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk(s.substring(i - 64, i)));\n        }\n        s = s.substring(i - 64);\n        length = s.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n        }\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n        return state;\n    }\n\n    function md51_array(a) {\n        var n = a.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n        }\n\n        // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n        // containing the last element of the parent array if the sub array specified starts\n        // beyond the length of the parent array - weird.\n        // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n        a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n\n        length = a.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= a[i] << ((i % 4) << 3);\n        }\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n\n        return state;\n    }\n\n    function rhex(n) {\n        var s = '',\n            j;\n        for (j = 0; j < 4; j += 1) {\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n        }\n        return s;\n    }\n\n    function hex(x) {\n        var i;\n        for (i = 0; i < x.length; i += 1) {\n            x[i] = rhex(x[i]);\n        }\n        return x.join('');\n    }\n\n    // In some cases the fast add32 function cannot be used..\n    if (hex(md51('hello')) !== '5d41402abc4b2a76b9719d911017c592') {\n        add32 = function (x, y) {\n            var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n                msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n            return (msw << 16) | (lsw & 0xFFFF);\n        };\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * ArrayBuffer slice polyfill.\n     *\n     * @see https://github.com/ttaubert/node-arraybuffer-slice\n     */\n\n    if (typeof ArrayBuffer !== 'undefined' && !ArrayBuffer.prototype.slice) {\n        (function () {\n            function clamp(val, length) {\n                val = (val | 0) || 0;\n\n                if (val < 0) {\n                    return Math.max(val + length, 0);\n                }\n\n                return Math.min(val, length);\n            }\n\n            ArrayBuffer.prototype.slice = function (from, to) {\n                var length = this.byteLength,\n                    begin = clamp(from, length),\n                    end = length,\n                    num,\n                    target,\n                    targetArray,\n                    sourceArray;\n\n                if (to !== undefined) {\n                    end = clamp(to, length);\n                }\n\n                if (begin > end) {\n                    return new ArrayBuffer(0);\n                }\n\n                num = end - begin;\n                target = new ArrayBuffer(num);\n                targetArray = new Uint8Array(target);\n\n                sourceArray = new Uint8Array(this, begin, num);\n                targetArray.set(sourceArray);\n\n                return target;\n            };\n        })();\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * Helpers.\n     */\n\n    function toUtf8(str) {\n        if (/[\\u0080-\\uFFFF]/.test(str)) {\n            str = unescape(encodeURIComponent(str));\n        }\n\n        return str;\n    }\n\n    function utf8Str2ArrayBuffer(str, returnUInt8Array) {\n        var length = str.length,\n           buff = new ArrayBuffer(length),\n           arr = new Uint8Array(buff),\n           i;\n\n        for (i = 0; i < length; i += 1) {\n            arr[i] = str.charCodeAt(i);\n        }\n\n        return returnUInt8Array ? arr : buff;\n    }\n\n    function arrayBuffer2Utf8Str(buff) {\n        return String.fromCharCode.apply(null, new Uint8Array(buff));\n    }\n\n    function concatenateArrayBuffers(first, second, returnUInt8Array) {\n        var result = new Uint8Array(first.byteLength + second.byteLength);\n\n        result.set(new Uint8Array(first));\n        result.set(new Uint8Array(second), first.byteLength);\n\n        return returnUInt8Array ? result : result.buffer;\n    }\n\n    function hexToBinaryString(hex) {\n        var bytes = [],\n            length = hex.length,\n            x;\n\n        for (x = 0; x < length - 1; x += 2) {\n            bytes.push(parseInt(hex.substr(x, 2), 16));\n        }\n\n        return String.fromCharCode.apply(String, bytes);\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation.\n     *\n     * Use this class to perform an incremental md5, otherwise use the\n     * static methods instead.\n     */\n\n    function SparkMD5() {\n        // call reset to init the instance\n        this.reset();\n    }\n\n    /**\n     * Appends a string.\n     * A conversion will be applied if an utf8 string is detected.\n     *\n     * @param {String} str The string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.append = function (str) {\n        // Converts the string to utf8 bytes if necessary\n        // Then append as binary\n        this.appendBinary(toUtf8(str));\n\n        return this;\n    };\n\n    /**\n     * Appends a binary string.\n     *\n     * @param {String} contents The binary string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.appendBinary = function (contents) {\n        this._buff += contents;\n        this._length += contents.length;\n\n        var length = this._buff.length,\n            i;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk(this._buff.substring(i - 64, i)));\n        }\n\n        this._buff = this._buff.substring(i - 64);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            i,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.reset = function () {\n        this._buff = '';\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.prototype.getState = function () {\n        return {\n            buff: this._buff,\n            length: this._length,\n            hash: this._hash\n        };\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.setState = function (state) {\n        this._buff = state.buff;\n        this._length = state.length;\n        this._hash = state.hash;\n\n        return this;\n    };\n\n    /**\n     * Releases memory used by the incremental buffer and other additional\n     * resources. If you plan to use the instance again, use reset instead.\n     */\n    SparkMD5.prototype.destroy = function () {\n        delete this._hash;\n        delete this._buff;\n        delete this._length;\n    };\n\n    /**\n     * Finish the final calculation based on the tail.\n     *\n     * @param {Array}  tail   The tail (will be modified)\n     * @param {Number} length The length of the remaining buffer\n     */\n    SparkMD5.prototype._finish = function (tail, length) {\n        var i = length,\n            tmp,\n            lo,\n            hi;\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(this._hash, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Do the final computation based on the tail and length\n        // Beware that the final length may not fit in 32 bits so we take care of that\n        tmp = this._length * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n        md5cycle(this._hash, tail);\n    };\n\n    /**\n     * Performs the md5 hash on a string.\n     * A conversion will be applied if utf8 string is detected.\n     *\n     * @param {String}  str The string\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hash = function (str, raw) {\n        // Converts the string to utf8 bytes if necessary\n        // Then compute it using the binary function\n        return SparkMD5.hashBinary(toUtf8(str), raw);\n    };\n\n    /**\n     * Performs the md5 hash on a binary string.\n     *\n     * @param {String}  content The binary string\n     * @param {Boolean} raw     True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hashBinary = function (content, raw) {\n        var hash = md51(content),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation for array buffers.\n     *\n     * Use this class to perform an incremental md5 ONLY for array buffers.\n     */\n    SparkMD5.ArrayBuffer = function () {\n        // call reset to init the instance\n        this.reset();\n    };\n\n    /**\n     * Appends an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array to be appended\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n        var buff = concatenateArrayBuffers(this._buff.buffer, arr, true),\n            length = buff.length,\n            i;\n\n        this._length += arr.byteLength;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk_array(buff.subarray(i - 64, i)));\n        }\n\n        this._buff = (i - 64) < length ? new Uint8Array(buff.buffer.slice(i - 64)) : new Uint8Array(0);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            i,\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.reset = function () {\n        this._buff = new Uint8Array(0);\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.ArrayBuffer.prototype.getState = function () {\n        var state = SparkMD5.prototype.getState.call(this);\n\n        // Convert buffer to a string\n        state.buff = arrayBuffer2Utf8Str(state.buff);\n\n        return state;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.setState = function (state) {\n        // Convert string to buffer\n        state.buff = utf8Str2ArrayBuffer(state.buff, true);\n\n        return SparkMD5.prototype.setState.call(this, state);\n    };\n\n    SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n\n    SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n\n    /**\n     * Performs the md5 hash on an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array buffer\n     * @param {Boolean}     raw True to get the raw string, false to get the hex one\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n        var hash = md51_array(new Uint8Array(arr)),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    return SparkMD5;\n}));\n","'use strict';\n\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define([], factory);\n    } else if (typeof module === 'object' && module.exports) {\n        // Node. Does not work with strict CommonJS, but\n        // only CommonJS-like environments that support module.exports,\n        // like Node.\n        module.exports = factory();\n    } else {\n        // Browser globals (root is window)\n        root.striptags = factory();\n  }\n}(this, function () {\n    var STATE_OUTPUT       = 0,\n        STATE_HTML         = 1,\n        STATE_PRE_COMMENT  = 2,\n        STATE_COMMENT      = 3,\n        WHITESPACE         = /\\s/,\n        ALLOWED_TAGS_REGEX = /<(\\w*)>/g;\n\n    function striptags(html, allowableTags) {\n        var html = html || '',\n            state = STATE_OUTPUT,\n            depth = 0,\n            output = '',\n            tagBuffer = '',\n            inQuote = false,\n            i, length, c;\n\n        if (typeof allowableTags === 'string') {\n            // Parse the string into an array of tags\n            allowableTags = parseAllowableTags(allowableTags);\n        } else if (!Array.isArray(allowableTags)) {\n            // If it is not an array, explicitly set to null\n            allowableTags = null;\n        }\n\n        for (i = 0, length = html.length; i < length; i++) {\n            c = html[i];\n\n            switch (c) {\n                case '<': {\n                    // ignore '<' if inside a quote\n                    if (inQuote) {\n                        break;\n                    }\n\n                    // '<' followed by a space is not a valid tag, continue\n                    if (html[i + 1] == ' ') {\n                        consumeCharacter(c);\n                        break;\n                    }\n\n                    // change to STATE_HTML\n                    if (state == STATE_OUTPUT) {\n                        state = STATE_HTML;\n\n                        consumeCharacter(c);\n                        break;\n                    }\n\n                    // ignore additional '<' characters when inside a tag\n                    if (state == STATE_HTML) {\n                        depth++;\n                        break;\n                    }\n\n                    consumeCharacter(c);\n                    break;\n                }\n\n                case '>': {\n                    // something like this is happening: '<<>>'\n                    if (depth) {\n                        depth--;\n                        break;\n                    }\n\n                    // ignore '>' if inside a quote\n                    if (inQuote) {\n                        break;\n                    }\n\n                    // an HTML tag was closed\n                    if (state == STATE_HTML) {\n                        inQuote = state = 0;\n\n                        if (allowableTags) {\n                            tagBuffer += '>';\n                            flushTagBuffer();\n                        }\n\n                        break;\n                    }\n\n                    // '<!' met its ending '>'\n                    if (state == STATE_PRE_COMMENT) {\n                        inQuote = state = 0;\n                        tagBuffer = '';\n                        break;\n                    }\n\n                    // if last two characters were '--', then end comment\n                    if (state == STATE_COMMENT &&\n                        html[i - 1] == '-' &&\n                        html[i - 2] == '-') {\n\n                        inQuote = state = 0;\n                        tagBuffer = '';\n                        break;\n                    }\n\n                    consumeCharacter(c);\n                    break;\n                }\n\n                // catch both single and double quotes\n                case '\"':\n                case '\\'': {\n                    if (state == STATE_HTML) {\n                        if (inQuote == c) {\n                            // end quote found\n                            inQuote = false;\n                        } else if (!inQuote) {\n                            // start quote only if not already in one\n                            inQuote = c;\n                        }\n                    }\n\n                    consumeCharacter(c);\n                    break;\n                }\n\n                case '!': {\n                    if (state == STATE_HTML &&\n                        html[i - 1] == '<') {\n\n                        // looks like we might be starting a comment\n                        state = STATE_PRE_COMMENT;\n                        break;\n                    }\n\n                    consumeCharacter(c);\n                    break;\n                }\n\n                case '-': {\n                    // if the previous two characters were '!-', this is a comment\n                    if (state == STATE_PRE_COMMENT &&\n                        html[i - 1] == '-' &&\n                        html[i - 2] == '!') {\n\n                        state = STATE_COMMENT;\n                        break;\n                    }\n\n                    consumeCharacter(c);\n                    break;\n                }\n\n                case 'E':\n                case 'e': {\n                    // check for DOCTYPE, because it looks like a comment and isn't\n                    if (state == STATE_PRE_COMMENT &&\n                        html.substr(i - 6, 7).toLowerCase() == 'doctype') {\n\n                        state = STATE_HTML;\n                        break;\n                    }\n\n                    consumeCharacter(c);\n                    break;\n                }\n\n                default: {\n                    consumeCharacter(c);\n                }\n            }\n        }\n\n        function consumeCharacter(c) {\n            if (state == STATE_OUTPUT) {\n                output += c;\n            } else if (allowableTags && state == STATE_HTML) {\n                tagBuffer += c;\n            }\n        }\n\n        function flushTagBuffer() {\n            var normalized = '',\n                nonWhitespaceSeen = false,\n                i, length, c;\n\n            normalizeTagBuffer:\n            for (i = 0, length = tagBuffer.length; i < length; i++) {\n                c = tagBuffer[i].toLowerCase();\n\n                switch (c) {\n                    case '<': {\n                        break;\n                    }\n\n                    case '>': {\n                        break normalizeTagBuffer;\n                    }\n\n                    case '/': {\n                        nonWhitespaceSeen = true;\n                        break;\n                    }\n\n                    default: {\n                        if (!c.match(WHITESPACE)) {\n                            nonWhitespaceSeen = true;\n                            normalized += c;\n                        } else if (nonWhitespaceSeen) {\n                            break normalizeTagBuffer;\n                        }\n                    }\n                }\n            }\n\n            if (allowableTags.indexOf(normalized) !== -1) {\n                output += tagBuffer;\n            }\n\n            tagBuffer = '';\n        }\n\n        return output;\n    }\n\n    /**\n     * Return an array containing tags that are allowed to pass through the\n     * algorithm.\n     *\n     * @param string allowableTags A string of tags to allow (e.g. \"<b><strong>\").\n     * @return array|null An array of allowed tags or null if none.\n     */\n    function parseAllowableTags(allowableTags) {\n        var tagsArray = [],\n            match;\n\n        while ((match = ALLOWED_TAGS_REGEX.exec(allowableTags)) !== null) {\n            tagsArray.push(match[1]);\n        }\n\n        return tagsArray.length !== 0 ? tagsArray : null;\n    }\n\n    return striptags;\n}));\n","'use strict';\n\nmodule.exports = 2147483647;\n","'use strict';\n\nvar toPosInt   = require('es5-ext/number/to-pos-integer')\n  , maxTimeout = require('./max-timeout');\n\nmodule.exports = function (value) {\n\tvalue = toPosInt(value);\n\tif (value > maxTimeout) throw new TypeError(value + \" exceeds maximum possible timeout\");\n\treturn value;\n};\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Ajax');\nvar Ajax = {};\n\nAjax.errorCallback = function(response){\n\t//log.error(response);\n\tlog.debug('ajax error callback', 2);\n\tlog.debug('textStatus: ' + response.textStatus, 2);\n\tlog.debug('errorThrown: ', 2);\n\tlog.debug(response.errorThrown, 2);\n\tlog.debug(response.jqxhr, 2);\n};\n\nAjax.error = Ajax.errorCallback;\nAjax.activeRequests = [];\n\n/*\n * Requires {target:items|collections|tags, libraryType:user|group, libraryID:<>}\n */\nAjax.apiRequestUrl = function(params){\n\tlog.debug('Zotero.Ajax.apiRequestUrl', 3);\n\tlog.debug(params, 4);\n\tObject.keys(params).forEach(function(key){\n\t\tvar val = params[key];\n\t\t//should probably figure out exactly why I'm doing this, is it just to make sure no hashes snuck in?\n\t\t//if so the new validation below takes care of that instead\n\t\tif(typeof val == 'string'){\n\t\t\tval = val.split('#', 1);\n\t\t\tparams[key] = val[0];\n\t\t}\n\t\t\n\t\t//validate params based on patterns in Zotero.validate\n\t\tif(Zotero.validator.validate(val, key) === false){\n\t\t\t//warn on invalid parameter and drop from params that will be used\n\t\t\tlog.warn('API argument failed validation: ' + key + ' cannot be ' + val);\n\t\t\tlog.warn(params);\n\t\t\tdelete params[key];\n\t\t}\n\t});\n\t\n\tif(!params.target) throw new Error('No target defined for api request');\n\tif(!(params.libraryType == 'user' ||\n\t\tparams.libraryType == 'group' ||\n\t\tparams.libraryType === '')) {\n\t\tthrow new Error('Unexpected libraryType for api request ' + JSON.stringify(params));\n\t}\n\tif((params.libraryType) && !(params.libraryID)) {\n\t\tthrow new Error('No libraryID defined for api request');\n\t}\n\tif((params.target == 'publications') && (params.libraryType != 'user')){\n\t\tthrow new Error('publications is only valid for user libraries');\n\t}\n\t\n\tvar base = Zotero.config.baseApiUrl;\n\tvar url;\n\t\n\tif(params.libraryType !== ''){\n\t\turl = base + '/' + params.libraryType + 's/' + params.libraryID;\n\t\tif(params.collectionKey){\n\t\t\tif(params.collectionKey == 'trash'){\n\t\t\t\turl += '/items/trash';\n\t\t\t\treturn url;\n\t\t\t}\n\t\t\telse if(params.collectionKey.indexOf(',') !== -1){\n\t\t\t\t\n\t\t\t}\n\t\t\telse if(params.target != 'collections'){\n\t\t\t\turl += '/collections/' + params.collectionKey;\n\t\t\t}\n\t\t}\n\t}\n\telse{\n\t\turl = base;\n\t}\n\t\n\tswitch(params.target){\n\t\tcase 'items':\n\t\t\turl += '/items';\n\t\t\tbreak;\n\t\tcase 'item':\n\t\t\tif(params.itemKey){\n\t\t\t\turl += '/items/' + params.itemKey;\n\t\t\t}\n\t\t\telse{\n\t\t\t\turl += '/items';\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'collections':\n\t\t\turl += '/collections';\n\t\t\tbreak;\n\t\tcase 'childCollections':\n\t\t\turl += '/collections';\n\t\t\tbreak;\n\t\tcase 'collection':\n\t\t\tbreak;\n\t\tcase 'tags':\n\t\t\turl += '/tags';\n\t\t\tbreak;\n\t\tcase 'children':\n\t\t\turl += '/items/' + params.itemKey + '/children';\n\t\t\tbreak;\n\t\tcase 'key':\n\t\t\turl = base + '/keys/' + params.apiKey;\n\t\t\tbreak;\n\t\tcase 'deleted':\n\t\t\turl += '/deleted';\n\t\t\tbreak;\n\t\tcase 'userGroups':\n\t\t\turl = base + '/users/' + params.libraryID + '/groups';\n\t\t\tbreak;\n\t\tcase 'settings':\n\t\t\turl += '/settings/' + (params.settingsKey || '');\n\t\t\tbreak;\n\t\tcase 'publications':\n\t\t\turl += '/publications/items';\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn false;\n\t}\n\tswitch(params.targetModifier){\n\t\tcase 'top':\n\t\t\turl += '/top';\n\t\t\tbreak;\n\t\tcase 'file':\n\t\t\turl += '/file';\n\t\t\tbreak;\n\t\tcase 'viewsnapshot':\n\t\t\turl += '/file/view';\n\t\t\tbreak;\n\t}\n\treturn url;\n};\n\nAjax.apiQueryString = function(passedParams){\n\tlog.debug('Zotero.Ajax.apiQueryString', 4);\n\tlog.debug(passedParams, 4);\n\t\n\tObject.keys(passedParams).forEach(function(key){\n\t\tvar val = passedParams[key];\n\t\tif(typeof val == 'string'){\n\t\t\tval = val.split('#', 1);\n\t\t\tpassedParams[key] = val[0];\n\t\t}\n\t});\n\tif(passedParams.hasOwnProperty('order') && passedParams['order'] == 'creatorSummary'){\n\t\tpassedParams['order'] = 'creator';\n\t}\n\tif(passedParams.hasOwnProperty('order') && passedParams['order'] == 'year'){\n\t\tpassedParams['order'] = 'date';\n\t}\n\tif(Zotero.config.sessionAuth) {\n\t\tvar sessionKey = Zotero.utils.readCookie(Zotero.config.sessionCookieName);\n\t\tpassedParams['session'] = sessionKey;\n\t}\n\t\n\tif(passedParams.hasOwnProperty('sort') && passedParams['sort'] == 'undefined' ){\n\t\tpassedParams['sort'] = 'asc';\n\t}\n\t\n\tlog.debug(passedParams, 4);\n\t\n\tvar queryString = '?';\n\tvar queryParamsArray = [];\n\tvar queryParamOptions = ['start',\n\t\t\t\t\t\t\t'limit',\n\t\t\t\t\t\t\t'order',\n\t\t\t\t\t\t\t'sort',\n\t\t\t\t\t\t\t'content',\n\t\t\t\t\t\t\t'include',\n\t\t\t\t\t\t\t'format',\n\t\t\t\t\t\t\t'q',\n\t\t\t\t\t\t\t'fq',\n\t\t\t\t\t\t\t'itemType',\n\t\t\t\t\t\t\t'itemKey',\n\t\t\t\t\t\t\t'collectionKey',\n\t\t\t\t\t\t\t'searchKey',\n\t\t\t\t\t\t\t'locale',\n\t\t\t\t\t\t\t'tag',\n\t\t\t\t\t\t\t'tagType',\n\t\t\t\t\t\t\t'key',\n\t\t\t\t\t\t\t'style',\n\t\t\t\t\t\t\t'linkMode',\n\t\t\t\t\t\t\t'linkwrap',\n\t\t\t\t\t\t\t'session',\n\t\t\t\t\t\t\t'newer',\n\t\t\t\t\t\t\t'since'\n\t];\n\tqueryParamOptions.sort();\n\t//build simple api query parameters object\n\tvar queryParams = {};\n\tqueryParamOptions.forEach(function(val){\n\t\tif(passedParams.hasOwnProperty(val) && (passedParams[val] !== '')){\n\t\t\tqueryParams[val] = passedParams[val];\n\t\t}\n\t});\n\t\n\t//take out itemKey if it is not a list\n\tif(passedParams.hasOwnProperty('target') && passedParams['target'] !== 'items'){\n\t\tif(queryParams.hasOwnProperty('itemKey') && queryParams['itemKey'].indexOf(',') == -1){\n\t\t\tdelete queryParams['itemKey'];\n\t\t}\n\t}\n\t\n\t//take out collectionKey if it is not a list\n\tif(passedParams.hasOwnProperty('target') && passedParams['target'] !== 'collections'){\n\t\tif(queryParams.hasOwnProperty('collectionKey') && queryParams['collectionKey'].indexOf(',') === -1){\n\t\t\tdelete queryParams['collectionKey'];\n\t\t}\n\t}\n\t\n\t//add each of the found queryParams onto array\n\tObject.keys(queryParams).forEach(function(key){\n\t\tvar value = queryParams[key];\n\t\tif(Array.isArray(value)){\n\t\t\tvalue.forEach(function(v){\n\t\t\t\tif(key == 'tag' && v[0] == '-'){\n\t\t\t\t\tv = '\\\\' + v;\n\t\t\t\t}\n\t\t\t\tqueryParamsArray.push(encodeURIComponent(key) + '=' + encodeURIComponent(v));\n\t\t\t});\n\t\t}\n\t\telse{\n\t\t\tif(key == 'tag' && value[0] == '-'){\n\t\t\t\tvalue = '\\\\' + value;\n\t\t\t}\n\t\t\tqueryParamsArray.push(encodeURIComponent(key) + '=' + encodeURIComponent(value));\n\t\t}\n\t});\n\t\n\t//build query string by concatenating array\n\tqueryString += queryParamsArray.join('&');\n\treturn queryString;\n};\n\nAjax.apiRequestString = function(config){\n\treturn Ajax.apiRequestUrl(config) + Ajax.apiQueryString(config);\n};\n\nAjax.proxyWrapper = function(requestUrl, method){\n\tif(Zotero.config.proxy){\n\t\tif(!method){\n\t\t\tmethod = 'GET';\n\t\t}\n\t\treturn Zotero.config.proxyPath + '?requestMethod=' + method + '&requestUrl=' + encodeURIComponent(requestUrl);\n\t}\n\telse{\n\t\treturn requestUrl;\n\t}\n};\n\nAjax.downloadBlob = function(url){\n\treturn new Promise(function(resolve, reject){\n\t\tvar xhr = new XMLHttpRequest();\n\t\tvar blob;\n\t\t\n\t\txhr.open('GET', url, true);\n\t\txhr.responseType = 'blob';\n\t\t\n\t\txhr.addEventListener('load', function () {\n\t\t\tif (xhr.status === 200) {\n\t\t\t\tlog.debug('downloadBlob Image retrieved. resolving', 3);\n\t\t\t\tresolve(xhr.response);\n\t\t\t}\n\t\t\telse {\n\t\t\t\treject(xhr.response);\n\t\t\t}\n\t\t} );\n\t\t// Send XHR\n\t\txhr.send();\n\t});\n};\n\nmodule.exports = Ajax;\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:ApiObject');\n\nmodule.exports = function(){\n\tthis.instance = 'Zotero.ApiObject';\n\tthis.version = 0;\n};\n\n//associate Entry with a library so we can update it on the server\nmodule.exports.prototype.associateWithLibrary = function(library){\n\tvar apiObject = this;\n\tapiObject.owningLibrary = library;\n\tif(typeof this.apiObj.library == 'object'){\n\t\tthis.apiObj.library.type = library.type;\n\t\tthis.apiObj.library.id = library.libraryID;\n\t}\n\treturn apiObject;\n};\n\nmodule.exports.prototype.fieldComparer = function(attr){\n\tif(Intl){\n\t\tvar collator = new Intl.Collator();\n\t\treturn function(a, b){\n\t\t\treturn collator.compare(a.apiObj.data[attr], b.apiObj.data[attr]);\n\t\t};\n\t} else {\n\t\treturn function(a, b){\n\t\t\tif(a.apiObj.data[attr].toLowerCase() == b.apiObj.data[attr].toLowerCase()){\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tif(a.apiObj.data[attr].toLowerCase() < b.apiObj.data[attr].toLowerCase()){\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\treturn 1;\n\t\t};\n\t}\n};\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:ApiResponse');\n\nmodule.exports = function(response) {\n\tlog.debug('Zotero.ApiResponse', 3);\n\tthis.totalResults = 0;\n\tthis.apiVersion = null;\n\tthis.lastModifiedVersion = 0;\n\tthis.linkHeader = '';\n\tthis.links = {};\n\t\n\tif(response){\n\t\tif(!response.isError){\n\t\t\tthis.isError = false;\n\t\t} else {\n\t\t\tthis.isError = true;\n\t\t}\n\t\tthis.data = response.data;\n\t\t//this.jqxhr = response.jqxhr;\n\t\tthis.parseResponse(response);\n\t}\n};\n\nmodule.exports.prototype.parseResponse = function(response){\n\tlog.debug('parseResponse', 3);\n\tvar apiResponse = this;\n\tapiResponse.jqxhr = response.jqxhr;\n\tapiResponse.status = response.jqxhr.status;\n\t//keep track of relevant headers\n\tapiResponse.lastModifiedVersion = response.jqxhr.getResponseHeader('Last-Modified-Version');\n\tapiResponse.apiVersion = response.jqxhr.getResponseHeader('Zotero-API-Version');\n\tapiResponse.backoff = response.jqxhr.getResponseHeader('Backoff');\n\tapiResponse.retryAfter = response.jqxhr.getResponseHeader('Retry-After');\n\tapiResponse.contentType = response.jqxhr.getResponseHeader('Content-Type');\n\tapiResponse.linkHeader = response.jqxhr.getResponseHeader('Link');\n\tapiResponse.totalResults = response.jqxhr.getResponseHeader('Total-Results');\n\tif(apiResponse.backoff){\n\t\tapiResponse.backoff = parseInt(apiResponse.backoff, 10);\n\t}\n\tif(apiResponse.retryAfter){\n\t\tapiResponse.retryAfter = parseInt(apiResponse.retryAfter, 10);\n\t}\n\t//TODO: parse link header into individual links\n\tlog.debug('parse link header', 4);\n\tlog.debug(apiResponse.linkHeader, 4);\n\tif(apiResponse.linkHeader){\n\t\tvar links = apiResponse.linkHeader.split(',');\n\t\tvar parsedLinks = {};\n\t\tvar linkRegex = /^<([^>]+)>; rel=\"([^\\\"]*)\"$/;\n\t\tfor(var i = 0; i < links.length; i++){\n\t\t\tvar matches = linkRegex.exec(links[i].trim());\n\t\t\tif(matches[2]){\n\t\t\t\tparsedLinks[matches[2]] = matches[1];\n\t\t\t}\n\t\t}\n\t\tapiResponse.parsedLinks = parsedLinks;\n\t}\n};","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Base');\n\nvar Zotero = {\n\tcallbacks: {},\n\toffline: {},\n\ttemp: {},\n\t\n\tconfig: {librarySettings: {},\n\t\t\tbaseApiUrl: 'https://api.zotero.org',\n\t\t\tbaseWebsiteUrl: 'https://zotero.org',\n\t\t\tbaseFeedUrl: 'https://api.zotero.org',\n\t\t\tbaseZoteroWebsiteUrl: 'https://www.zotero.org',\n\t\t\tbaseDownloadUrl: 'https://www.zotero.org',\n\t\t\tnonparsedBaseUrl: '',\n\t\t\tdebugLogEndpoint: '',\n\t\t\tstoreDebug: true,\n\t\t\tdirectDownloads: true,\n\t\t\tproxyPath: '/proxyrequest',\n\t\t\tignoreLoggedInStatus: false,\n\t\t\tstorePrefsRemote: true,\n\t\t\tpreferUrlItem: true,\n\t\t\tsessionAuth: false,\n\t\t\tproxy: false,\n\t\t\tapiKey: '',\n\t\t\tapiVersion: 3,\n\t\t\tlocale: 'en-US',\n\t\t\tcacheStoreType: 'localStorage',\n\t\t\tpreloadCachedLibrary: true,\n\t\t\tsortOrdering: {\n\t\t\t\t'dateAdded': 'desc',\n\t\t\t\t'dateModified': 'desc',\n\t\t\t\t'date': 'desc',\n\t\t\t\t'year': 'desc',\n\t\t\t\t'accessDate': 'desc',\n\t\t\t\t'title': 'asc',\n\t\t\t\t'creator': 'asc'\n\t\t\t},\n\t\t\tdefaultSortColumn: 'title',\n\t\t\tdefaultSortOrder: 'asc',\n\t\t\tlargeFields: {\n\t\t\t\t'title': 1,\n\t\t\t\t'abstractNote': 1,\n\t\t\t\t'extra' : 1\n\t\t\t},\n\t\t\trichTextFields: {\n\t\t\t\t'note': 1\n\t\t\t},\n\t\t\tmaxFieldSummaryLength: {title:60},\n\t\t\texportFormats: [\n\t\t\t\t'bibtex',\n\t\t\t\t'bookmarks',\n\t\t\t\t'mods',\n\t\t\t\t'refer',\n\t\t\t\t'rdf_bibliontology',\n\t\t\t\t'rdf_dc',\n\t\t\t\t'rdf_zotero',\n\t\t\t\t'ris',\n\t\t\t\t'wikipedia'\n\t\t\t\t],\n\t\t\texportFormatsMap: {\n\t\t\t\t'bibtex': 'BibTeX',\n\t\t\t\t'bookmarks': 'Bookmarks',\n\t\t\t\t'mods': 'MODS',\n\t\t\t\t'refer': 'Refer/BibIX',\n\t\t\t\t'rdf_bibliontology': 'Bibliontology RDF',\n\t\t\t\t'rdf_dc': 'Unqualified Dublin Core RDF',\n\t\t\t\t'rdf_zotero': 'Zotero RDF',\n\t\t\t\t'ris': 'RIS',\n\t\t\t\t'wikipedia': 'Wikipedia Citation Templates'\n\t\t\t},\n\t\t\tdefaultApiArgs: {\n\t\t\t\t'order': 'title',\n\t\t\t\t'sort': 'asc',\n\t\t\t\t'limit': 50,\n\t\t\t\t'start': 0\n\t\t\t}\n\t},\n\t/*\n\tdebug: function(debugstring, level){\n\t\tvar prefLevel = 3;\n\t\tif(Zotero.config.storeDebug){\n\t\t\tif(level <= prefLevel){\n\t\t\t\tZotero.debugstring += 'DEBUG:' + debugstring + '\\n';\n\t\t\t}\n\t\t}\n\t\tif(typeof console == 'undefined'){\n\t\t\treturn;\n\t\t}\n\t\tif(typeof(level) !== 'number'){\n\t\t\tlevel = 1;\n\t\t}\n\t\tif(Zotero.preferences !== undefined){\n\t\t\tprefLevel = Zotero.preferences.getPref('debug_level');\n\t\t}\n\t\tif(level <= prefLevel) {\n\t\t\tconsole.log(debugstring);\n\t\t}\n\t},\n\t\n\twarn: function(warnstring){\n\t\tif(Zotero.config.storeDebug){\n\t\t\tZotero.debugstring += 'WARN:' + warnstring + '\\n';\n\t\t}\n\t\tif(typeof console == 'undefined' || typeof console.warn == 'undefined'){\n\t\t\tthis.debug(warnstring);\n\t\t}\n\t\telse{\n\t\t\tconsole.warn(warnstring);\n\t\t}\n\t},\n\t\n\terror: function(errorstring){\n\t\tif(Zotero.config.storeDebug){\n\t\t\tZotero.debugstring += 'ERROR:' + errorstring + '\\n';\n\t\t}\n\t\tif(typeof console == 'undefined' || typeof console.error == 'undefined'){\n\t\t\tthis.debug(errorstring);\n\t\t}\n\t\telse{\n\t\t\tconsole.error(errorstring);\n\t\t}\n\t},\n\t*/\n\tsubmitDebugLog: function(){\n\t\tZotero.net.ajax({\n\t\t\turl: Zotero.config.debugLogEndpoint,\n\t\t\tdata: {'debug_string': Zotero.debugstring}\n\t\t}).then(function(xhr){\n\t\t\tvar data = JSON.parse(xhr.responseText);\n\t\t\tif(data.logID) {\n\t\t\t\talert('ZoteroWWW debug logID:' + data.logID);\n\t\t\t} else if (data.error) {\n\t\t\t\talert('Error submitting ZoteroWWW debug log:' + data.error);\n\t\t\t}\n\t\t});\n\t},\n\t\n\tcatchPromiseError: function(err){\n\t\tlog.error(err);\n\t},\n\t\n\tlibraries: {},\n\t\n\tvalidator: {\n\t\tpatterns: {\n\t\t\t//'itemKey': /^([A-Z0-9]{8,},?)+$/,\n\t\t\t'itemKey': /^.+$/,\n\t\t\t'collectionKey': /^([A-Z0-9]{8,})|trash$/,\n\t\t\t//'tag': /^[^#]*$/,\n\t\t\t'libraryID': /^[0-9]+$/,\n\t\t\t'libraryType': /^(user|group|)$/,\n\t\t\t'target': /^(items?|collections?|tags|children|deleted|userGroups|key|settings|publications)$/,\n\t\t\t'targetModifier': /^(top|file|file\\/view)$/,\n\t\t\t\n\t\t\t//get params\n\t\t\t'sort': /^(asc|desc)$/,\n\t\t\t'start': /^[0-9]*$/,\n\t\t\t'limit': /^[0-9]*$/,\n\t\t\t'order': /^\\S*$/,\n\t\t\t'content': /^((html|json|data|bib|none|bibtex|bookmarks|coins|csljson|mods|refer|rdf_bibliontology|rdf_dc|ris|tei|wikipedia),?)+$/,\n\t\t\t'include': /^((html|json|data|bib|none|bibtex|bookmarks|coins|csljson|mods|refer|rdf_bibliontology|rdf_dc|ris|tei|wikipedia),?)+$/,\n\t\t\t'format': /^((atom|bib|json|keys|versions|bibtex|bookmarks|coins|csljson|mods|refer|rdf_bibliontology|rdf_dc|ris|tei|wikipedia),?)+$/,\n\t\t\t'q': /^.*$/,\n\t\t\t'fq': /^\\S*$/,\n\t\t\t'itemType': /^\\S*$/,\n\t\t\t'locale': /^\\S*$/,\n\t\t\t'tag': /^.*$/,\n\t\t\t'tagType': /^(0|1)$/,\n\t\t\t'key': /^\\S*/,\n\t\t\t'style': /^\\S*$/,\n\t\t\t'linkwrap': /^(0|1)*$/\n\t\t},\n\t\t\n\t\tvalidate: function(arg, type){\n\t\t\tlog.debug('Zotero.validate', 4);\n\t\t\tif(arg === ''){\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\telse if(arg === null){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tlog.debug(arg + ' ' + type, 4);\n\t\t\tvar patterns = this.patterns;\n\t\t\t\n\t\t\tif(patterns.hasOwnProperty(type)){\n\t\t\t\treturn patterns[type].test(arg);\n\t\t\t}\n\t\t\telse{\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t},\n\t\n\t_logEnabled: 0,\n\tenableLogging: function(){\n\t\tZotero._logEnabled++;\n\t\tif(Zotero._logEnabled > 0){\n\t\t\t//TODO: enable debug_log?\n\t\t}\n\t},\n\t\n\tdisableLogging: function(){\n\t\tZotero._logEnabled--;\n\t\tif(Zotero._logEnabled <= 0){\n\t\t\tZotero._logEnabled = 0;\n\t\t\t//TODO: disable debug_log?\n\t\t}\n\t},\n\t\n\tinit: function(){\n\t\tvar store;\n\t\tif(Zotero.config.cacheStoreType == 'localStorage' && typeof localStorage != 'undefined'){\n\t\t\tstore = localStorage;\n\t\t}\n\t\telse if(Zotero.config.cacheStoreType == 'sessionStorage' && typeof sessionStorage != 'undefined'){\n\t\t\tstore = sessionStorage;\n\t\t}\n\t\telse{\n\t\t\tstore = {};\n\t\t}\n\t\tZotero.store = store;\n\t\t\n\t\tZotero.cache = new Zotero.Cache(store);\n\t\t\n\t\t//initialize global preferences object\n\t\tZotero.preferences = new Zotero.Preferences(Zotero.store, 'global');\n\t\t\n\t\t//get localized item constants if not stored in localstorage\n\t\tvar locale = 'en-US';\n\t\tif(Zotero.config.locale){\n\t\t\tlocale = Zotero.config.locale;\n\t\t}\n\t\tlocale = 'en-US';\n\t}\n};\n\n\nZotero.ajaxRequest = function(url, type, options){\n\tlog.debug('Zotero.ajaxRequest ==== ' + url, 3);\n\tif(!type){\n\t\ttype = 'GET';\n\t}\n\tif(!options){\n\t\toptions = {};\n\t}\n\tvar requestObject = {\n\t\turl: url,\n\t\ttype: type\n\t};\n\trequestObject = Z.extend({}, requestObject, options);\n\tlog.debug(requestObject, 3);\n\treturn Zotero.net.queueRequest(requestObject);\n};\n\n//non-DOM (jquery) event management\nZotero.eventmanager = {\n\tcallbacks: {}\n};\n\nZotero.trigger = function(eventType, data={}, filter=false){\n\tif(filter){\n\t\tlog.debug('filter is not false', 3);\n\t\teventType += '_' + filter;\n\t}\n\tlog.debug('Triggering eventful ' + eventType, 3);\n\t\n\tdata.zeventful = true;\n\t// if(data.triggeringElement === null || data.triggeringElement === undefined){\n\t// \tdata.triggeringElement = J('#eventful');\n\t// }\n\t\n\ttry{\n\t\tif(Zotero.eventmanager.callbacks.hasOwnProperty(eventType)){\n\t\t\tvar callbacks = Zotero.eventmanager.callbacks[eventType];\n\t\t\tcallbacks.forEach(function(callback){\n\t\t\t\tvar cdata = Z.extend({}, data, callback.data);\n\t\t\t\tvar e = {\n\t\t\t\t\tdata: cdata\n\t\t\t\t};\n\t\t\t\tcallback.f(e);\n\t\t\t});\n\t\t}\n\t}\n\tcatch(e){\n\t\tlog.error(`failed triggering:${eventType}`);\n\t\tlog.error(e);\n\t}\n};\n\nZotero.listen = function(events, handler, data, filter){\n\tlog.debug('Zotero.listen: ' + events, 3);\n\t//append filter to event strings if it's specified\n\tvar eventsArray = events.split(' ');\n\tif(eventsArray.length > 0 && filter){\n\t\tfor(var i = 0; i < eventsArray.length; i++){\n\t\t\teventsArray[i] += '_' + filter;\n\t\t}\n\t}\n\teventsArray.forEach(function(ev){\n\t\tif(Zotero.eventmanager.callbacks.hasOwnProperty(ev)){\n\t\t\tZotero.eventmanager.callbacks[ev].push({\n\t\t\t\tdata: data,\n\t\t\t\tf: handler\n\t\t\t});\n\t\t} else {\n\t\t\tZotero.eventmanager.callbacks[ev] = [{\n\t\t\t\tdata: data,\n\t\t\t\tf: handler\n\t\t\t}];\n\t\t}\n\t});\n};\n\nZotero.extend = function() {\n\tvar res = {};\n\tfor(var i = 0; i < arguments.length; i++){\n\t\tvar a = arguments[i];\n\t\tif(typeof a != 'object'){\n\t\t\tcontinue;\n\t\t}\n\t\tObject.keys(a).forEach(function(key){\n\t\t\tres[key] = a[key];\n\t\t});\n\t}\n\treturn res;\n};\n\nZotero.deepExtend = function(out) {\n  out = out || {};\n\n  for (var i = 1; i < arguments.length; i++) {\n    var obj = arguments[i];\n\n    if (!obj)\n      continue;\n\n    for (var key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        if (typeof obj[key] === 'object')\n          out[key] = Zotero.deepExtend(out[key], obj[key]);\n        else\n          out[key] = obj[key];\n      }\n    }\n  }\n\n  return out;\n};\n\nmodule.exports = Zotero;","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Cache');\n\n//build a consistent string from an object to use as a cache key\n//put object key/value pairs into array, sort array, and concatenate\n//array with '/'\nmodule.exports = function(store) {\n\tthis.store = store;\n\tvar registry = this.store._registry;\n\tif(registry === null || typeof registry == 'undefined'){\n\t\tregistry = {};\n\t\tthis.store._registry = JSON.stringify(registry);\n\t}\n};\n\nmodule.exports.prototype.objectCacheString = function(params){\n\tvar paramVarsArray = [];\n\tObject.keys(params).forEach(function(index){\n\t\tvar value = params[index];\n\t\tif(!value) { return; }\n\t\telse if(Array.isArray(value)){\n\t\t\tvalue.forEach(function(v){\n\t\t\t\tparamVarsArray.push(index + '/' + encodeURIComponent(v) );\n\t\t\t});\n\t\t}\n\t\telse{\n\t\t\tparamVarsArray.push(index + '/' + encodeURIComponent(value) );\n\t\t}\n\t});\n\tparamVarsArray.sort();\n\tlog.debug(paramVarsArray, 4);\n\tvar objectCacheString = paramVarsArray.join('/');\n\treturn objectCacheString;\n};\n\n//should use setItem and getItem if I extend that to the case where no Storage object is available in the browser\nmodule.exports.prototype.save = function(params, object, cachetags){\n\t//cachetags for expiring entries\n\tif(!Array.isArray(cachetags)){\n\t\tcachetags = [];\n\t}\n\t//get registry object from storage\n\tvar registry = JSON.parse(this.store._registry);\n\tif(!registry){\n\t\tregistry = {};\n\t}\n\tvar objectCacheString = this.objectCacheString(params);\n\t//save object in storage\n\tthis.store[objectCacheString] = JSON.stringify(object);\n\t//make registry entry for object\n\tvar registryEntry = {'id':objectCacheString, saved:Date.now(), cachetags:cachetags};\n\tregistry[objectCacheString] = registryEntry;\n\t//save registry back to storage\n\tthis.store._registry = JSON.stringify(registry);\n};\n\nmodule.exports.prototype.load = function(params){\n\tlog.debug('Zotero.Cache.load', 3);\n\tvar objectCacheString = this.objectCacheString(params);\n\tlog.debug(objectCacheString, 4);\n\ttry{\n\t\tvar s = this.store[objectCacheString];\n\t\tif(!s){\n\t\t\tlog.warn('No value found in cache store - ' + objectCacheString, 3);\n\t\t\treturn null;\n\t\t}\n\t\telse{\n\t\t\treturn JSON.parse(s);\n\t\t}\n\t}\n\tcatch(e){\n\t\tlog.error(`Error parsing retrieved cache data: ${objectCacheString} : ${s}`);\n\t\treturn null;\n\t}\n};\n\nmodule.exports.prototype.expireCacheTag = function(tag){\n\tlog.debug('Zotero.Cache.expireCacheTag', 3);\n\tvar registry = JSON.parse(this.store._registry);\n\tvar store = this.store;\n\tObject.keys(registry).forEach(function(index){\n\t\tvar value = registry[index];\n\t\tif(value.cachetags.indexOf(tag) != (-1)){\n\t\t\tlog.debug('tag ' + tag + ' found for item ' + value['id'] + ' : expiring', 4);\n\t\t\tdelete store[value['id']];\n\t\t\tdelete registry[value['id']];\n\t\t}\n\t});\n};\n\nmodule.exports.prototype.clear = function(){\n\tif(typeof(this.store.clear) == 'function'){\n\t\tthis.store.clear();\n\t}\n\telse{\n\t\tthis.store = {};\n\t}\n};","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Client');\n\nvar Client = function(apiKey=''){\n\tthis._apiKey = apiKey;\n\tthis.net = require('./Net.js');\n};\n\nClient.prototype.getUserGroups = function(userID) {\n\tvar aparams = {\n\t\t'target':'userGroups',\n\t\t'libraryType':'user',\n\t\t'libraryID': userID,\n\t\t'order':'title'\n\t};\n\t\n\tif(this._apiKey){\n\t\taparams['key'] = this._apiKey;\n\t}\n\t\n\treturn Zotero.ajaxRequest(aparams)\n\t.then(function(response){\n\t\tlog.debug('fetchUserGroups proxied callback', 3);\n\t\tlet groupJson = response.data;\n\t\tlet groups = groupJson.map(function(groupObj){\n\t\t\treturn new Zotero.Group(groupObj);\n\t\t});\n\t\t\n\t\tvar fetchedGroups = groups.addGroupsFromJson(response.data);\n\t\tresponse.fetchedGroups = fetchedGroups;\n\t\treturn response;\n\t});\n};\n\nClient.prototype.getUserPublications = function(userID, config={}) {\n\tlog.debug('Zotero.Client.loadPublications', 3);\n\t\n\tvar defaultConfig = {\n\t\ttarget:'publications',\n\t\tstart: 0,\n\t\tlimit: 50,\n\t\torder: Zotero.config.defaultSortColumn,\n\t\tsort: Zotero.config.defaultSortOrder,\n\t\tinclude: 'bib'\n\t};\n\t\n\t//Build config object that should be displayed next and compare to currently displayed\n\tvar newConfig = Z.extend({}, defaultConfig, config);\n\t\n\tvar urlconfig = Z.extend({\n\t\t'target':'publications',\n\t\t'libraryType':'user',\n\t\t'libraryID':userID\n\t}, newConfig);\n\t\n\tlet publicationItems = [];\n\tlet fetcher = new MultiFetch(urlconfig);\n\n\treturn Zotero.ajaxRequest(urlconfig)\n\t.then(function(response){\n\t\tlog.debug('loadPublications proxied callback', 3);\n\t\tvar publicationItems = [];\n\t\tvar parsedItemJson = response.data;\n\t\tparsedItemJson.forEach(function(itemObj){\n\t\t\tvar item = new Zotero.Item(itemObj);\n\t\t\tpublicationItems.push(item);\n\t\t});\n\t\t\n\t\tresponse.publicationItems = publicationItems;\n\t\treturn response;\n\t});\n\n};\n\nClient.prototype.getKeyPermissions = function(key=false) {\n\tif(!key){\n\t\treturn false;\n\t}\n\t\n\tvar urlconfig = {'target':'key', 'apiKey':key, 'libraryType':''};\n\t\n\treturn Zotero.ajaxRequest(urlconfig)\n\t.then(function(response){\n\t\tvar keyObject = JSON.parse(response.data);\n\t\treturn keyObject;\n\t});\n};\n\nClient.prototype.deleteKey = function(key=false) {\n\tif(!key){\n\t\treturn false;\n\t}\n\n\treturn this.net.ajax();\n};\n\nvar MultiFetch = function(config={}){\n\tlet defaultConfig = {\n\t\tstart: 0,\n\t\tlimit: 50\n\t};\n\t\n\tthis.config = Z.extend({}, defaultConfig, config);\n\tthis.hasMore = true;\n};\n\nMultiFetch.prototype.next = function(){\n\tif(this.hasMore == false){\n\t\treturn Promise.resolve(null);\n\t}\n\t\n\tlet nconfig = Z.extend({}, this.config);\n\tlet p = Zotero.ajaxRequest(nconfig);\n\tp.then((response)=>{\n\t\tif(response.parsedLinks.hasOwnProperty('next')){\n\t\t\tthis.hasMore = true;\n\t\t} else {\n\t\t\tthis.hasMore = false;\n\t\t}\n\n\t\treturn response;\n\t});\n\n\tnconfig.start = nconfig.start + nconfig.limit;\n\treturn p;\n};\n\nMultiFetch.prototype.fetchAll = function(){\n\tlet results = [];\n\tlet tryNext = () => {\n\t\tif(this.hasMore){\n\t\t\treturn this.next().then((response)=>{\n\t\t\t\tresults = results.concat(response.data);\n\t\t\t}).then(tryNext);\n\t\t} else {\n\t\t\treturn Promise.resolve(results);\n\t\t}\n\t};\n\n\treturn tryNext();\n};\n\n\n\nmodule.exports = Client;\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Collection');\n\nmodule.exports = function(collectionObj){\n\tthis.instance = 'Zotero.Collection';\n\tthis.libraryUrlIdentifier = '';\n\tthis.itemKeys = false;\n\tthis.key = '';\n\tthis.version = 0;\n\tthis.synced = false;\n\tthis.pristineData = null;\n\tthis.apiObj = {\n\t\t'key': '',\n\t\t'version': 0,\n\t\t'library':{},\n\t\t'links':{},\n\t\t'meta':{},\n\t\t'data':{\n\t\t\t'key': '',\n\t\t\t'version': 0,\n\t\t\t'name': '',\n\t\t\t'parentCollection': false,\n\t\t\t'relations':{}\n\t\t}\n\t};\n\tthis.children = [];\n\tthis.topLevel = true;\n\tif(collectionObj){\n\t\tthis.parseJsonCollection(collectionObj);\n\t}\n};\n\nmodule.exports.prototype = new Zotero.ApiObject();\nmodule.exports.prototype.instance = 'Zotero.Collection';\n\nmodule.exports.prototype.updateObjectKey = function(collectionKey){\n\tthis.updateCollectionKey(collectionKey);\n};\n\nmodule.exports.prototype.updateCollectionKey = function(collectionKey){\n\tvar collection = this;\n\tcollection.key = collectionKey;\n\tcollection.apiObj.key = collectionKey;\n\tcollection.apiObj.data.key = collectionKey;\n\treturn collection;\n};\n\nmodule.exports.prototype.parseJsonCollection = function(apiObj) {\n\tlog.debug('parseJsonCollection', 4);\n\tvar collection = this;\n\tcollection.key = apiObj.key;\n\tcollection.version = apiObj.version;\n\tcollection.apiObj = Z.extend({}, apiObj);\n\tcollection.pristineData = Z.extend({}, apiObj.data);\n\n\tcollection.parentCollection = false;\n\tcollection.topLevel = true;\n\tcollection.synced = true;\n\tcollection.initSecondaryData();\n};\n\nmodule.exports.prototype.initSecondaryData = function() {\n\tvar collection = this;\n\t\n\tif(collection.apiObj.data['parentCollection']){\n\t\tcollection.topLevel = false;\n\t} else {\n\t\tcollection.topLevel = true;\n\t}\n\t\n\tif(Zotero.config.librarySettings.libraryPathString){\n\t\tcollection.websiteCollectionLink = Zotero.config.librarySettings.libraryPathString + \n\t\t'/collectionKey/' + collection.apiObj.key;\n\t}\n\telse {\n\t\tcollection.websiteCollectionLink = '';\n\t}\n\tcollection.hasChildren = (collection.apiObj.meta.numCollections) ? true : false;\n\t\n};\n\nmodule.exports.prototype.nestCollection = function(collectionsObject) {\n\tlog.debug('Zotero.Collection.nestCollection', 4);\n\tvar collection = this;\n\tvar parentCollectionKey = collection.get('parentCollection');\n\tif(parentCollectionKey !== false){\n\t\tif(collectionsObject.hasOwnProperty(parentCollectionKey)) {\n\t\t\tvar parentOb = collectionsObject[parentCollectionKey];\n\t\t\tparentOb.children.push(collection);\n\t\t\tparentOb.hasChildren = true;\n\t\t\tcollection.topLevel = false;\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n};\n\nmodule.exports.prototype.addItems = function(itemKeys){\n\tlog.debug('Zotero.Collection.addItems', 3);\n\tvar collection = this;\n\tvar config = {\n\t\t'target':'items',\n\t\t'libraryType':collection.apiObj.library.type,\n\t\t'libraryID':collection.apiObj.library.id,\n\t\t'collectionKey':collection.key\n\t};\n\tvar requestData = itemKeys.join(' ');\n\t\n\treturn Zotero.ajaxRequest(config, 'POST', {\n\t\tdata: requestData\n\t});\n};\n\nmodule.exports.prototype.getMemberItemKeys = function(){\n\tlog.debug('Zotero.Collection.getMemberItemKeys', 3);\n\tvar collection = this;\n\tvar config = {\n\t\t'target':'items',\n\t\t'libraryType':collection.apiObj.library.type,\n\t\t'libraryID':collection.apiObj.library.id,\n\t\t'collectionKey':collection.key,\n\t\t'format':'keys'\n\t};\n\t\n\treturn Zotero.ajaxRequest(config, 'GET', {processData: false} )\n\t.then(function(response){\n\t\tlog.debug('getMemberItemKeys proxied callback', 3);\n\t\tvar result = response.data;\n\t\tvar keys = result.trim().split(/[\\s]+/);\n\t\tcollection.itemKeys = keys;\n\t\treturn keys;\n\t});\n};\n\nmodule.exports.prototype.removeItem = function(itemKey){\n\tvar collection = this;\n\tvar config = {\n\t\t'target':'item',\n\t\t'libraryType':collection.apiObj.library.type,\n\t\t'libraryID':collection.apiObj.library.id,\n\t\t'collectionKey':collection.key,\n\t\t'itemKey':itemKey\n\t};\n\treturn Zotero.ajaxRequest(config, 'DELETE', {\n\t\tprocessData: false,\n\t\tcache:false\n\t});\n};\n\nmodule.exports.prototype.update = function(name, parentKey){\n\tvar collection = this;\n\tif(!parentKey) parentKey = false;\n\tvar config = {\n\t\t'target':'collection',\n\t\t'libraryType':collection.apiObj.library.type,\n\t\t'libraryID':collection.apiObj.library.id,\n\t\t'collectionKey':collection.key\n\t};\n\t\n\tcollection.set('name', name);\n\tcollection.set('parentCollection', parentKey);\n\t\n\tvar writeObject = collection.writeApiObj();\n\tvar requestData = JSON.stringify(writeObject);\n\t\n\treturn Zotero.ajaxRequest(config, 'PUT', {\n\t\tdata: requestData,\n\t\tprocessData: false,\n\t\theaders:{\n\t\t\t'If-Unmodified-Since-Version': collection.version\n\t\t},\n\t\tcache:false\n\t});\n};\n\nmodule.exports.prototype.writeApiObj = function(){\n\tvar collection = this;\n\tvar writeObj = Z.extend({}, collection.pristineData, collection.apiObj.data);\n\treturn writeObj;\n};\n\nmodule.exports.prototype.remove = function(){\n\tlog.debug('Zotero.Collection.delete', 3);\n\tvar collection = this;\n\tvar owningLibrary = collection.owningLibrary;\n\tvar config = {\n\t\t'target':'collection',\n\t\t'libraryType':collection.apiObj.library.type,\n\t\t'libraryID':collection.apiObj.library.id,\n\t\t'collectionKey':collection.key\n\t};\n\t\n\treturn Zotero.ajaxRequest(config, 'DELETE', {\n\t\tprocessData: false,\n\t\theaders:{\n\t\t\t'If-Unmodified-Since-Version': collection.version\n\t\t},\n\t\tcache:false\n\t}).then(function(){\n\t\tlog.debug('done deleting collection. remove local copy.', 3);\n\t\towningLibrary.collections.removeLocalCollection(collection.key);\n\t\towningLibrary.trigger('libraryCollectionsUpdated');\n\t});\n};\n\nmodule.exports.prototype.get = function(key){\n\tvar collection = this;\n\tswitch(key) {\n\t\tcase 'title':\n\t\tcase 'name':\n\t\t\treturn collection.apiObj.data.name;\n\t\tcase 'collectionKey':\n\t\tcase 'key':\n\t\t\treturn collection.apiObj.key || collection.key;\n\t\tcase 'collectionVersion':\n\t\tcase 'version':\n\t\t\treturn collection.apiObj.version;\n\t\tcase 'parentCollection':\n\t\t\treturn collection.apiObj.data.parentCollection;\n\t}\n\t\n\tif(key in collection.apiObj.data){\n\t\treturn collection.apiObj.data[key];\n\t}\n\telse if(collection.apiObj.meta.hasOwnProperty(key)){\n\t\treturn collection.apiObj.meta[key];\n\t}\n\telse if(collection.hasOwnProperty(key)){\n\t\treturn collection[key];\n\t}\n\t\n\treturn null;\n};\n/*\n module.exports.prototype.get = function(key){\n\tvar collection = this;\n\tswitch(key) {\n\t\tcase 'title':\n\t\tcase 'name':\n\t\t\treturn collection.apiObj.data['name'];\n\t\tcase 'collectionKey':\n\t\tcase 'key':\n\t\t\treturn collection.apiObj.key;\n\t\tcase 'parentCollection':\n\t\t\treturn collection.apiObj.data['parentCollection'];\n\t\tcase 'collectionVersion':\n\t\tcase 'version':\n\t\t\treturn collection.apiObj.version;\n\t}\n\t\n\tif(key in collection.apiObj.data){\n\t\treturn collection.apiObj.data[key];\n\t}\n\telse if(key in collection.apiObj.meta){\n\t\treturn collection.apiObj.meta[key];\n\t}\n\telse if(collection.hasOwnProperty(key)){\n\t\treturn collection[key];\n\t}\n\t\n\treturn null;\n};\n*/\n\nmodule.exports.prototype.set = function(key, val){\n\tvar collection = this;\n\tif(key in collection.apiObj.data){\n\t\tcollection.apiObj.data[key] = val;\n\t}\n\tswitch(key){\n\t\tcase 'title':\n\t\tcase 'name':\n\t\t\tcollection.apiObj.data['name'] = val;\n\t\tbreak;\n\t\tcase 'collectionKey':\n\t\tcase 'key':\n\t\t\tcollection.key = val;\n\t\t\tcollection.apiObj.key = val;\n\t\t\tcollection.apiObj.data.key = val;\n\t\tbreak;\n\t\tcase 'parentCollection':\n\t\t\tcollection.apiObj.data['parentCollection'] = val;\n\t\tbreak;\n\t\tcase 'collectionVersion':\n\t\tcase 'version':\n\t\t\tcollection.version = val;\n\t\t\tcollection.apiObj.version = val;\n\t\t\tcollection.apiObj.data.version = val;\n\t\tbreak;\n\t}\n\t\n\tif(collection.hasOwnProperty(key)) {\n\t\tcollection[key] = val;\n\t}\n};\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Collections');\n\nmodule.exports = function(jsonBody){\n\tvar collections = this;\n\tthis.instance = 'Zotero.Collections';\n\tthis.version = 0;\n\tthis.syncState = {\n\t\tearliestVersion: null,\n\t\tlatestVersion: null\n\t};\n\tthis.collectionObjects = {};\n\tthis.collectionsArray = [];\n\tthis.objectMap = this.collectionObjects;\n\tthis.objectArray = this.collectionsArray;\n\tthis.dirty = false;\n\tthis.loaded = false;\n\t\n\tif(jsonBody){\n\t\tthis.addCollectionsFromJson(jsonBody);\n\t\tthis.initSecondaryData();\n\t}\n};\n\n module.exports.prototype = new Zotero.Container();\n//build up secondary data necessary to rendering and easy operations but that\n//depend on all collections already being present\n module.exports.prototype.initSecondaryData = function(){\n\tlog.debug('Zotero.Collections.initSecondaryData', 3);\n\tvar collections = this;\n\t\n\t//rebuild collectionsArray\n\tcollections.collectionsArray = [];\n\tObject.keys(collections.collectionObjects).forEach(function(key){\n\t\tvar collection = collections.collectionObjects[key];\n\t\tcollections.collectionsArray.push(collection);\n\t});\n\t\n\tcollections.collectionsArray.sort(Zotero.ApiObject.prototype.fieldComparer('name'));\n\tcollections.nestCollections();\n\tcollections.assignDepths(0, collections.collectionsArray);\n};\n\n//take Collection XML and insert a Collection object\n module.exports.prototype.addCollection = function(collection){\n\tthis.addObject(collection);\n\treturn this;\n};\n\n module.exports.prototype.addCollectionsFromJson = function(jsonBody){\n\tlog.debug('addCollectionsFromJson', 3);\n\tvar collections = this;\n\tvar collectionsAdded = [];\n\tjsonBody.forEach(function(collectionObj){\n\t\tvar collection = new Zotero.Collection(collectionObj);\n\t\tcollections.addObject(collection);\n\t\tcollectionsAdded.push(collection);\n\t});\n\treturn collectionsAdded;\n};\n\n module.exports.prototype.assignDepths = function(depth, cArray){\n\tlog.debug('Zotero.Collections.assignDepths', 3);\n\tvar collections = this;\n\tvar insertchildren = function(depth, children){\n\t\tchildren.forEach(function(col){\n\t\t\tcol.nestingDepth = depth;\n\t\t\tif(col.hasChildren){\n\t\t\t\tinsertchildren((depth + 1), col.children);\n\t\t\t}\n\t\t});\n\t};\n\tcollections.collectionsArray.forEach(function(collection){\n\t\tif(collection.topLevel){\n\t\t\tcollection.nestingDepth = 1;\n\t\t\tif(collection.hasChildren){\n\t\t\t\tinsertchildren(2, collection.children);\n\t\t\t}\n\t\t}\n\t});\n};\n\n module.exports.prototype.nestedOrderingArray = function(){\n\tlog.debug('Zotero.Collections.nestedOrderingArray', 3);\n\tvar collections = this;\n\tvar nested = [];\n\tvar insertchildren = function(a, children){\n\t\tchildren.forEach(function(col){\n\t\t\ta.push(col);\n\t\t\tif(col.hasChildren){\n\t\t\t\tinsertchildren(a, col.children);\n\t\t\t}\n\t\t});\n\t};\n\tcollections.collectionsArray.forEach(function(collection){\n\t\tif(collection.topLevel){\n\t\t\tnested.push(collection);\n\t\t\tif(collection.hasChildren){\n\t\t\t\tinsertchildren(nested, collection.children);\n\t\t\t}\n\t\t}\n\t});\n\tlog.debug('Done with nestedOrderingArray', 3);\n\treturn nested;\n};\n\n module.exports.prototype.getCollection = function(key){\n\treturn this.getObject(key);\n};\n\n module.exports.prototype.remoteDeleteCollection = function(collectionKey){\n\tvar collections = this;\n\treturn collections.removeLocalCollection(collectionKey);\n};\n\n module.exports.prototype.removeLocalCollection = function(collectionKey){\n\tvar collections = this;\n\treturn collections.removeLocalCollections([collectionKey]);\n};\n\n module.exports.prototype.removeLocalCollections = function(collectionKeys){\n\tvar collections = this;\n\t//delete Collection from collectionObjects\n\tfor(var i = 0; i < collectionKeys.length; i++){\n\t\tdelete collections.collectionObjects[collectionKeys[i]];\n\t}\n\t\n\t//rebuild collectionsArray\n\tcollections.initSecondaryData();\n};\n\n//reprocess all collections to add references to children inside their parents\n module.exports.prototype.nestCollections = function(){\n\tvar collections = this;\n\t//clear out all child references so we don't duplicate\n\tcollections.collectionsArray.forEach(function(collection){\n\t\tcollection.children = [];\n\t});\n\t\n\tcollections.collectionsArray.sort(Zotero.ApiObject.prototype.fieldComparer('name'));\n\tcollections.collectionsArray.forEach(function(collection){\n\t\tcollection.nestCollection(collections.collectionObjects);\n\t});\n};\n\n module.exports.prototype.writeCollections = function(collectionsArray){\n\tlog.debug('Zotero.Collections.writeCollections', 3);\n\tvar collections = this;\n\tvar library = collections.owningLibrary;\n\tvar i;\n\t\n\tvar config = {\n\t\t'target':'collections',\n\t\t'libraryType':collections.owningLibrary.libraryType,\n\t\t'libraryID':collections.owningLibrary.libraryID\n\t};\n\t\n\t//add collectionKeys to collections if they don't exist yet\n\tfor(i = 0; i < collectionsArray.length; i++){\n\t\tvar collection = collectionsArray[i];\n\t\t//generate a collectionKey if the collection does not already have one\n\t\tvar collectionKey = collection.get('key');\n\t\tif(collectionKey === '' || collectionKey === null) {\n\t\t\tvar newCollectionKey = Zotero.utils.getKey();\n\t\t\tcollection.set('key', newCollectionKey);\n\t\t\tcollection.set('version', 0);\n\t\t}\n\t}\n\n\tvar writeChunks = collections.chunkObjectsArray(collectionsArray);\n\tvar rawChunkObjects = collections.rawChunks(writeChunks);\n\t//update collections with server response if successful\n\tvar writeCollectionsSuccessCallback = function(response){\n\t\tlog.debug('writeCollections successCallback', 3);\n\t\tvar library = this.library;\n\t\tvar writeChunk = this.writeChunk;\n\t\tlibrary.collections.updateObjectsFromWriteResponse(this.writeChunk, response);\n\t\t//save updated collections to collections\n\t\tfor(var i = 0; i < writeChunk.length; i++){\n\t\t\tvar collection = writeChunk[i];\n\t\t\tif(collection.synced && (!collection.writeFailure)) {\n\t\t\t\tlibrary.collections.addCollection(collection);\n\t\t\t\t//save updated collections to IDB\n\t\t\t\tif(Zotero.config.useIndexedDB){\n\t\t\t\t\tlog.debug('updating indexedDB collections');\n\t\t\t\t\tlibrary.idbLibrary.updateCollections(writeChunk);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tresponse.returnCollections = writeChunk;\n\t\treturn response;\n\t};\n\t\n\tlog.debug('collections.version: ' + collections.version, 3);\n\tlog.debug('collections.libraryVersion: ' + collections.libraryVersion, 3);\n\t\n\tvar requestObjects = [];\n\tfor(i = 0; i < writeChunks.length; i++){\n\t\tvar successContext = {\n\t\t\twriteChunk: writeChunks[i],\n\t\t\tlibrary: library\n\t\t};\n\t\t\n\t\tvar requestData = JSON.stringify(rawChunkObjects[i]);\n\t\trequestObjects.push({\n\t\t\turl: config,\n\t\t\ttype: 'POST',\n\t\t\tdata: requestData,\n\t\t\tprocessData: false,\n\t\t\theaders:{\n\t\t\t\t//'If-Unmodified-Since-Version': collections.version,\n\t\t\t\t//'Content-Type': 'application/json'\n\t\t\t},\n\t\t\tsuccess: writeCollectionsSuccessCallback.bind(successContext)\n\t\t});\n\t}\n\n\treturn library.sequentialRequests(requestObjects)\n\t.then(function(responses){\n\t\tlog.debug('Done with writeCollections sequentialRequests promise', 3);\n\t\tcollections.initSecondaryData();\n\t\t\n\t\tresponses.forEach(function(response){\n\t\t\tif(response.isError || (response.data.hasOwnProperty('failed') && Object.keys(response.data.failed).length > 0) ){\n\t\t\t\tthrow new Error('failure when writing collections');\n\t\t\t}\n\t\t});\n\t\treturn responses;\n\t})\n\t.catch(function(err){\n\t\tlog.error(err);\n\t\t//rethrow so widget doesn't report success\n\t\tthrow(err);\n\t});\n};\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Container');\n\nmodule.exports = function(){\n\t\n};\n\nmodule.exports.prototype.initSecondaryData = function(){\n\t\n};\n\nmodule.exports.prototype.addObject = function(object){\n\tlog.debug('Zotero.Container.addObject', 4);\n\tvar container = this;\n\tcontainer.objectArray.push(object);\n\tcontainer.objectMap[object.key] = object;\n\tif(container.owningLibrary){\n\t\tobject.associateWithLibrary(container.owningLibrary);\n\t}\n\t\n\treturn container;\n};\n\nmodule.exports.prototype.fieldComparer = function(field){\n\tif(Intl){\n\t\tvar collator = new Intl.Collator();\n\t\treturn function(a, b){\n\t\t\treturn collator.compare(a.apiObj.data[field], b.apiObj.data[field]);\n\t\t};\n\t} else {\n\t\treturn function(a, b){\n\t\t\tif(a.apiObj.data[field].toLowerCase() == b.apiObj.data[field].toLowerCase()){\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tif(a.apiObj.data[field].toLowerCase() < b.apiObj.data[field].toLowerCase()){\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\treturn 1;\n\t\t};\n\t}\n};\n\nmodule.exports.prototype.getObject = function(key){\n\tvar container = this;\n\tif(container.objectMap.hasOwnProperty(key)){\n\t\treturn container.objectMap[key];\n\t}\n\telse{\n\t\treturn false;\n\t}\n};\n\nmodule.exports.prototype.getObjects = function(keys){\n\tvar container = this;\n\tvar objects = [];\n\tvar object;\n\tfor(var i = 0; i < keys.length; i++){\n\t\tobject = container.getObject(keys[i]);\n\t\tif(object){\n\t\t\tobjects.push(object);\n\t\t}\n\t}\n\treturn objects;\n};\n\nmodule.exports.prototype.removeObject = function(key){\n\tvar container = this;\n\tif(container.objectMap.hasOwnProperty(key)){\n\t\tdelete container.objectmap[key];\n\t\tcontainer.initSecondaryData();\n\t}\n};\n\nmodule.exports.prototype.removeObjects = function(keys){\n\tvar container = this;\n\t//delete Objects from objectMap;\n\tfor(var i = 0; i < keys.length; i++){\n\t\tdelete container.objectMap[keys[i]];\n\t}\n\t\n\t//rebuild array\n\tcontainer.initSecondaryData();\n};\n\nmodule.exports.prototype.writeObjects = function(objects){\n\t//TODO:implement\n};\n\n//generate keys for objects about to be written if they are new\nmodule.exports.prototype.assignKeys = function(objectsArray){\n\tvar object;\n\tfor(var i = 0; i < objectsArray.length; i++){\n\t\tobject = objectsArray[i];\n\t\tvar key = object.get('key');\n\t\tif(!key) {\n\t\t\tvar newObjectKey = Zotero.utils.getKey();\n\t\t\tobject.set('key', newObjectKey);\n\t\t\tobject.set('version', 0);\n\t\t}\n\t}\n\treturn objectsArray;\n};\n\n//split an array of objects into chunks to write over multiple api requests\nmodule.exports.prototype.chunkObjectsArray = function(objectsArray){\n\tvar chunkSize = 50;\n\tvar writeChunks = [];\n\t\n\tfor(var i = 0; i < objectsArray.length; i = i + chunkSize){\n\t\twriteChunks.push(objectsArray.slice(i, i+chunkSize));\n\t}\n\t\n\treturn writeChunks;\n};\n\nmodule.exports.prototype.rawChunks = function(chunks){\n\tvar rawChunkObjects = [];\n\t\n\tfor(var i = 0; i < chunks.length; i++){\n\t\trawChunkObjects[i] = [];\n\t\tfor(var j = 0; j < chunks[i].length; j++){\n\t\t\trawChunkObjects[i].push(chunks[i][j].writeApiObj());\n\t\t}\n\t}\n\treturn rawChunkObjects;\n};\n\n/**\n * Update syncState property on container to keep track of updates that occur during sync process.\n * Set earliestVersion to MIN(earliestVersion, version).\n * Set latestVersion to MAX(latestVersion, version).\n * This should be called with the modifiedVersion header for each response tied to this container\n * during a sync process.\n * @param  {int} version\n * @return {null}\n */\nmodule.exports.prototype.updateSyncState = function(version) {\n\tvar container = this;\n\tlog.debug('updateSyncState: ' + version, 3);\n\tif(!container.hasOwnProperty('syncState')){\n\t\tlog.debug('no syncState property');\n\t\tthrow new Error('Attempt to update sync state of object with no syncState property');\n\t}\n\tif(container.syncState.earliestVersion === null){\n\t\tcontainer.syncState.earliestVersion = version;\n\t}\n\tif(container.syncState.latestVersion === null){\n\t\tcontainer.syncState.latestVersion = version;\n\t}\n\tif(version < container.syncState.earliestVersion){\n\t\tcontainer.syncState.earliestVersion = version;\n\t}\n\tif(version > container.syncState.latestVersion){\n\t\tcontainer.syncState.latestVersion = version;\n\t}\n\tlog.debug('done updating sync state', 3);\n};\n\nmodule.exports.prototype.updateSyncedVersion = function(versionField) {\n\tvar container = this;\n\tif(container.syncState.earliestVersion !== null &&\n\t\t(container.syncState.earliestVersion == container.syncState.latestVersion) ){\n\t\tcontainer.version = container.syncState.latestVersion;\n\t\tcontainer.synced = true;\n\t}\n\telse if(container.syncState.earliestVersion !== null) {\n\t\tcontainer.version = container.syncState.earliestVersion;\n\t}\n};\n\nmodule.exports.prototype.processDeletions = function(deletedKeys) {\n\tvar container = this;\n\tfor(var i = 0; i < deletedKeys.length; i++){\n\t\tvar localObject = container.get(deletedKeys[i]);\n\t\tif(localObject !== false){\n\t\t\t//still have object locally\n\t\t\tif(localObject.synced === true){\n\t\t\t\t//our object is not modified, so delete it as the server thinks we should\n\t\t\t\tcontainer.removeObjects([deletedKeys[i]]);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t//TODO: conflict resolution\n\t\t\t}\n\t\t}\n\t}\n};\n\n//update items appropriately based on response to multi-write request\n//for success:\n//  update objectKey if item doesn't have one yet (newly created item)\n//  update itemVersion to response's Last-Modified-Version header\n//  mark as synced\n//for unchanged:\n//  don't need to do anything? itemVersion should remain the same?\n//  mark as synced if not already?\n//for failed:\n//  add the failure to the object under writeFailure\n//  don't mark as synced\n//  calling code should check for writeFailure after the written objects\n//  are returned\nmodule.exports.prototype.updateObjectsFromWriteResponse = function(objectsArray, response){\n\tlog.debug('Zotero.Container.updateObjectsFromWriteResponse', 3);\n\tlog.debug('statusCode: ' + response.status, 3);\n\tvar data = response.data;\n\tif(response.status == 200){\n\t\tlog.debug('newLastModifiedVersion: ' + response.lastModifiedVersion, 3);\n\t\t//make sure writes were actually successful and\n\t\t//update the itemKey for the parent\n\t\tif(data.hasOwnProperty('success')){\n\t\t\t//update each successfully written item, possibly with new itemKeys\n\t\t\tObject.keys(data.success).forEach(function(ind){\n\t\t\t\tvar i = parseInt(ind, 10);\n\t\t\t\tvar key = data.success[ind];\n\t\t\t\tvar object = objectsArray[i];\n\t\t\t\t//throw error if objectKey mismatch\n\t\t\t\tif(object.key !== '' && object.key !== key){\n\t\t\t\t\tthrow new Error('object key mismatch in multi-write response');\n\t\t\t\t}\n\t\t\t\tif(object.key === ''){\n\t\t\t\t\tobject.updateObjectKey(key);\n\t\t\t\t}\n\t\t\t\tobject.set('version', response.lastModifiedVersion);\n\t\t\t\tobject.synced = true;\n\t\t\t\tobject.writeFailure = false;\n\t\t\t});\n\t\t}\n\t\tif(data.hasOwnProperty('failed')){\n\t\t\tlog.debug('updating objects with failed writes', 3);\n\t\t\tObject.keys(data.failed).forEach(function(ind){\n\t\t\t\tvar failure = data.failed[ind];\n\t\t\t\tlog.error('failed write ' + ind + ' - ' + failure);\n\t\t\t\tvar i = parseInt(ind, 10);\n\t\t\t\tvar object = objectsArray[i];\n\t\t\t\tobject.writeFailure = failure;\n\t\t\t});\n\t\t}\n\t}\n\telse if(response.status == 204){\n\t\t//single item put response, this probably should never go to this function\n\t\tobjectsArray[0].synced = true;\n\t}\n};\n\n//return the key as a string when passed an argument that \n//could be either a string key or an object with a key property\nmodule.exports.prototype.extractKey = function(object){\n\tif(typeof object == 'string'){\n\t\treturn object;\n\t}\n\treturn object.get('key');\n};\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Deleted');\n\nmodule.exports = function(data){\n\tthis.instance = 'Zotero.Deleted';\n\tif(typeof data === 'string'){\n\t\tthis.deletedData = JSON.parse(data);\n\t}\n\telse {\n\t\tthis.deletedData = data;\n\t}\n\tthis.untilVersion = null;\n\tthis.sinceVersion = null;\n\tthis.waitingPromises = [];\n\tthis.pending = false;\n};\n\n//create, save referece, and return a Promise that will be resolved\n//the next time we finish a deleted request\nmodule.exports.prototype.addWaiter = function(){\n\t\n};\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:File');\n\nvar SparkMD5 = require('spark-md5');\n\n\nmodule.exports = {};\n\nmodule.exports.getFileInfo = function(file){\n\t//fileInfo: md5, filename, filesize, mtime, zip, contentType, charset\n\tif(typeof FileReader === 'undefined'){\n\t\treturn Promise.reject(new Error('FileReader not supported'));\n\t}\n\t\n\treturn new Promise(function(resolve, reject){\n\t\tvar fileInfo = {};\n\t\tvar reader = new FileReader();\n\t\treader.onload = function(e){\n\t\t\tlog.debug('Zotero.file.getFileInfo onloadFunc', 3);\n\t\t\tvar result = e.target.result;\n\t\t\tlog.debug(result, 3);\n\t\t\tfileInfo.md5 = SparkMD5.ArrayBuffer.hash(result);\n\t\t\tfileInfo.filename = file.name;\n\t\t\tfileInfo.filesize = file.size;\n\t\t\tfileInfo.mtime = Date.now();\n\t\t\tfileInfo.contentType = file.type;\n\t\t\t//fileInfo.reader = reader;\n\t\t\tfileInfo.filedata = result;\n\t\t\tresolve(fileInfo);\n\t\t};\n\t\t\n\t\treader.readAsArrayBuffer(file);\n\t});\n};\n\nmodule.exports.uploadFile = function(uploadInfo, fileInfo){\n\tlog.debug('Zotero.file.uploadFile', 3);\n\tlog.debug(uploadInfo, 4);\n\t\n\tvar formData = new FormData();\n\tObject.keys(uploadInfo.params).forEach(function(key){\n\t\tvar val = uploadInfo.params[key];\n\t\tformData.append(key, val);\n\t});\n\t\n\tvar blobData = new Blob([fileInfo.filedata], {type : fileInfo.contentType});\n\tformData.append('file', blobData);\n\t\n\tvar xhr = new XMLHttpRequest();\n\t\n\txhr.open('POST', uploadInfo.url, true);\n\t\n\treturn new Promise(function(resolve, reject){\n\t\txhr.onload = function(evt){\n\t\t\tlog.debug('uploadFile onload event', 3);\n\t\t\tif(this.status == 201){\n\t\t\t\tlog.debug('successful upload - 201', 3);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlog.error('uploadFile failed - ' + xhr.status);\n\t\t\t\treject({\n\t\t\t\t\t'message': 'Failure uploading file.',\n\t\t\t\t\t'code': xhr.status,\n\t\t\t\t\t'serverMessage': xhr.responseText\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\t\n\t\txhr.onprogress = function(evt){\n\t\t\tlog.debug('progress event');\n\t\t\tlog.debug(evt);\n\t\t};\n\t\txhr.send(formData);\n\t});\n\t\n\t//If CORS is not enabled on s3 this XHR will not have the normal status\n\t//information, but will still fire readyStateChanges so you can tell\n\t//when the upload has finished (even if you can't tell if it was successful\n\t//from JS)\n};\n\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Group');\n\nmodule.exports = function (groupObj) {\n\tvar group = this;\n\tgroup.instance = 'Zotero.Group';\n\tif(groupObj){\n\t\tthis.parseJsonGroup(groupObj);\n\t}\n};\n\nmodule.exports.prototype = new Zotero.ApiObject();\n\nmodule.exports.prototype.parseJsonGroup = function(groupObj) {\n\tvar group = this;\n\tgroup.apiObj = groupObj;\n};\n\nmodule.exports.prototype.get = function(key) {\n\tvar group = this;\n\tswitch(key) {\n\t\tcase 'title':\n\t\tcase 'name':\n\t\t\treturn group.apiObj.data.name;\n\t\tcase 'members':\n\t\t\tif(!group.apiObj.data.members){\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\treturn group.apiObj.data.members;\n\t\tcase 'admins':\n\t\t\tif(!group.apiObj.data.admins){\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\treturn group.apiObj.data.admins;\n\t}\n\t\n\tif(key in group.apiObj){\n\t\treturn group.apiObj[key];\n\t}\n\tif(key in group.apiObj.data){\n\t\treturn group.apiObj.data[key];\n\t}\n\tif(key in group.apiObj.meta){\n\t\treturn group.apiObj.meta[key];\n\t}\n\tif(group.hasOwnProperty(key)){\n\t\treturn group[key];\n\t}\n\t\n\treturn null;\n};\n\nmodule.exports.prototype.isWritable = function(userID){\n\tvar group = this;\n\tlog.debug(group);\n\tlet admins = group.apiObj.data.admins;\n\tif(!admins){\n\t\tadmins = [];\n\t}\n\n\tswitch(true){\n\t\tcase group.get('owner') == userID:\n\t\t\treturn true;\n\t\tcase (admins.indexOf(userID) != -1):\n\t\t\treturn true;\n\t\tcase ((group.apiObj.data.libraryEditing == 'members') &&\n\t\t\t(group.apiObj.data.members) &&\n\t\t\t(group.apiObj.data.members.indexOf(userID) != -1)):\n\t\t\treturn true;\n\t\tdefault:\n\t\t\treturn false;\n\t}\n};\n\nmodule.exports.prototype.typeMap = {\n\t'Private': 'Private',\n\t'PublicOpen': 'Public, Open Membership',\n\t'PublicClosed': 'Public, Closed Membership'\n};\n\nmodule.exports.prototype.accessMap = {\n\t'all'     : {\n\t\t'members' : 'Anyone can view, only members can edit',\n\t\t'admins'  : 'Anyone can view, only admins can edit'\n\t},\n\t'members' : {\n\t\t'members' : 'Only members can view and edit',\n\t\t'admins'  : 'Only members can view, only admins can edit'\n\t},\n\t'admins'  : {\n\t\t'members' : 'Only admins can view, only members can edit',\n\t\t'admins'  : 'Only admins can view and edit'\n\t}\n};\n\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Groups');\n\nmodule.exports = function(){\n\tthis.instance = 'Zotero.Groups';\n\tthis.groupsArray = [];\n};\n/*\n module.exports.prototype.fetchGroup = function(groupID, apikey){\n\t//TODO: implement\n};\n*/\nmodule.exports.prototype.addGroupsFromJson = function(jsonBody){\n\tvar groups = this;\n\tvar groupsAdded = [];\n\tjsonBody.forEach(function(groupObj){\n\t\tlog.debug(groupObj, 3);\n\t\tvar group = new Zotero.Group(groupObj);\n\t\tgroups.groupsArray.push(group);\n\t\tgroupsAdded.push(group);\n\t});\n\treturn groupsAdded;\n};\n\nmodule.exports.prototype.fetchUserGroups = function(userID, apikey){\n\tvar groups = this;\n\tvar aparams = {\n\t\t'target':'userGroups',\n\t\t'libraryType':'user',\n\t\t'libraryID': userID,\n\t\t'order':'title'\n\t};\n\t\n\tif(apikey){\n\t\taparams['key'] = apikey;\n\t}\n\telse if(groups.owningLibrary) {\n\t\taparams['key'] = groups.owningLibrary._apiKey;\n\t}\n\t\n\treturn Zotero.ajaxRequest(aparams)\n\t.then(function(response){\n\t\tlog.debug('fetchUserGroups proxied callback', 3);\n\t\tvar fetchedGroups = groups.addGroupsFromJson(response.data);\n\t\tresponse.fetchedGroups = fetchedGroups;\n\t\treturn response;\n\t});\n};\n\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Idb');\n\nmodule.exports = {};\n\n//Initialize an indexedDB for the specified library user or group + id\n//returns a promise that is resolved with a Zotero.Idb.Library instance when successful\n//and rejected onerror\nmodule.exports.Library = function(libraryString){\n\tlog.debug('Zotero.Idb.Library', 3);\n\tlog.debug('Initializing Zotero IDB', 3);\n\tthis.libraryString = libraryString;\n\tthis.owningLibrary = null;\n\tthis.initialized = false;\n};\n\nmodule.exports.Library.prototype.init = function(){\n\tvar idbLibrary = this;\n\treturn new Promise(function(resolve, reject){\n\t\t//Don't bother with the prefixed names because they should all be irrelevant by now\n\t\tvar indexedDB = window.indexedDB;\n\t\tidbLibrary.indexedDB = indexedDB;\n\t\t\n\t\t// Now we can open our database\n\t\tlog.debug('requesting indexedDb from browser', 3);\n\t\tvar request = indexedDB.open('Zotero_' + idbLibrary.libraryString, 4);\n\t\trequest.onerror = function(e){\n\t\t\tlog.error('ERROR OPENING INDEXED DB');\n\t\t\treject();\n\t\t};\n\t\t\n\t\tvar upgradeCallback = function(event){\n\t\t\tlog.debug('Zotero.Idb onupgradeneeded or onsuccess', 3);\n\t\t\tvar oldVersion = event.oldVersion;\n\t\t\tlog.debug('oldVersion: ' + event.oldVersion, 3);\n\t\t\tvar db = event.target.result;\n\t\t\tidbLibrary.db = db;\n\t\t\t\n\t\t\tif(oldVersion < 4){\n\t\t\t\t//delete old versions of object stores\n\t\t\t\tlog.debug('Existing object store names:', 3);\n\t\t\t\tlog.debug(JSON.stringify(db.objectStoreNames), 3);\n\t\t\t\tlog.debug('Deleting old object stores', 3);\n\t\t\t\tif(db.objectStoreNames['items']){\n\t\t\t\t\tdb.deleteObjectStore('items');\n\t\t\t\t}\n\t\t\t\tif(db.objectStoreNames['tags']){\n\t\t\t\t\tdb.deleteObjectStore('tags');\n\t\t\t\t}\n\t\t\t\tif(db.objectStoreNames['collections']){\n\t\t\t\t\tdb.deleteObjectStore('collections');\n\t\t\t\t}\n\t\t\t\tif(db.objectStoreNames['files']){\n\t\t\t\t\tdb.deleteObjectStore('files');\n\t\t\t\t}\n\t\t\t\tif(db.objectStoreNames['versions']){\n\t\t\t\t\tdb.deleteObjectStore('versions');\n\t\t\t\t}\n\t\t\t\tlog.debug('Existing object store names:', 3);\n\t\t\t\tlog.debug(JSON.stringify(db.objectStoreNames), 3);\n\t\t\t\t\n\t\t\t\t// Create object stores to hold items, collections, and tags.\n\t\t\t\t// IDB keys are just the zotero object keys\n\t\t\t\tvar itemStore = db.createObjectStore('items', { keyPath: 'key' });\n\t\t\t\tvar collectionStore = db.createObjectStore('collections', { keyPath: 'key' });\n\t\t\t\tvar tagStore = db.createObjectStore('tags', { keyPath: 'tag' });\n\t\t\t\tvar fileStore = db.createObjectStore('files');\n\t\t\t\tvar versionStore = db.createObjectStore('versions');\n\t\t\t\t\n\t\t\t\tlog.debug('itemStore index names:', 3);\n\t\t\t\tlog.debug(JSON.stringify(itemStore.indexNames), 3);\n\t\t\t\tlog.debug('collectionStore index names:', 3);\n\t\t\t\tlog.debug(JSON.stringify(collectionStore.indexNames), 3);\n\t\t\t\tlog.debug('tagStore index names:', 3);\n\t\t\t\tlog.debug(JSON.stringify(tagStore.indexNames), 3);\n\t\t\t\t\n\t\t\t\t// Create index to search/sort items by each attribute\n\t\t\t\tObject.keys(Zotero.Item.prototype.fieldMap).forEach(function(key){\n\t\t\t\t\tlog.debug('Creating index on ' + key, 3);\n\t\t\t\t\titemStore.createIndex(key, 'data.' + key, { unique: false });\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t//itemKey index was created above with all other item fields\n\t\t\t\t//itemStore.createIndex(\"itemKey\", \"itemKey\", { unique: false });\n\t\t\t\t\n\t\t\t\t//create multiEntry indices on item collectionKeys and tags\n\t\t\t\titemStore.createIndex('collectionKeys', 'data.collections', {unique: false, multiEntry:true});\n\t\t\t\t//index on extra tagstrings array since tags are objects and we can't index them directly\n\t\t\t\titemStore.createIndex('itemTagStrings', '_supplement.tagstrings', {unique: false, multiEntry:true});\n\t\t\t\t//example filter for tag: Zotero.Idb.filterItems(\"itemTagStrings\", \"Unread\");\n\t\t\t\t//example filter collection: Zotero.Idb.filterItems(\"collectionKeys\", \"<collectionKey>\");\n\t\t\t\t\n\t\t\t\t//itemStore.createIndex(\"itemType\", \"itemType\", { unique: false });\n\t\t\t\titemStore.createIndex('parentItemKey', 'data.parentItem', { unique: false });\n\t\t\t\titemStore.createIndex('libraryKey', 'libraryKey', { unique: false });\n\t\t\t\titemStore.createIndex('deleted', 'data.deleted', { unique: false });\n\t\t\t\t\n\t\t\t\tcollectionStore.createIndex('name', 'data.name', { unique: false });\n\t\t\t\tcollectionStore.createIndex('key', 'key', { unique: false });\n\t\t\t\tcollectionStore.createIndex('parentCollection', 'data.parentCollection', { unique: false });\n\t\t\t\t//collectionStore.createIndex(\"libraryKey\", \"libraryKey\", { unique: false });\n\t\t\t\t\n\t\t\t\ttagStore.createIndex('tag', 'tag', { unique: false });\n\t\t\t\t//tagStore.createIndex(\"libraryKey\", \"libraryKey\", { unique: false });\n\t\t\t}\n\t\t};\n\t\t\n\t\trequest.onupgradeneeded = upgradeCallback;\n\t\t\n\t\trequest.onsuccess = function(){\n\t\t\tlog.debug('IDB success', 3);\n\t\t\tidbLibrary.db = request.result;\n\t\t\tidbLibrary.initialized = true;\n\t\t\tresolve(idbLibrary);\n\t\t};\n\t});\n};\n\nmodule.exports.Library.prototype.deleteDB = function(){\n\tvar idbLibrary = this;\n\tidbLibrary.db.close();\n\treturn new Promise(function(resolve, reject){\n\t\tvar deleteRequest = idbLibrary.indexedDB.deleteDatabase('Zotero_' + idbLibrary.libraryString);\n\t\tdeleteRequest.onerror = function(){\n\t\t\tlog.error('Error deleting indexedDB');\n\t\t\treject();\n\t\t};\n\t\tdeleteRequest.onsuccess = function(){\n\t\t\tlog.debug('Successfully deleted indexedDB', 2);\n\t\t\tresolve();\n\t\t};\n\t});\n};\n\n/**\n* @param {string} store_name\n* @param {string} mode either \"readonly\" or \"readwrite\"\n*/\nmodule.exports.Library.prototype.getObjectStore = function (store_name, mode) {\n\tvar idbLibrary = this;\n\tvar tx = idbLibrary.db.transaction(store_name, mode);\n\treturn tx.objectStore(store_name);\n};\n\nmodule.exports.Library.prototype.clearObjectStore = function (store_name) {\n\tvar idbLibrary = this;\n\tvar store = idbLibrary.getObjectStore(store_name, 'readwrite');\n\treturn new Promise(function(resolve, reject){\n\t\tvar req = store.clear();\n\t\treq.onsuccess = function(evt) {\n\t\t\tlog.debug('Store cleared', 3);\n\t\t\tresolve();\n\t\t};\n\t\treq.onerror = function (evt) {\n\t\t\tlog.error('clearObjectStore:', evt.target.errorCode);\n\t\t\treject();\n\t\t};\n\t});\n};\n\n/**\n* Add array of items to indexedDB\n* @param {array} items\n*/\nmodule.exports.Library.prototype.addItems = function(items){\n\treturn this.addObjects(items, 'item');\n};\n\n/**\n* Update/add array of items to indexedDB\n* @param {array} items\n*/\nmodule.exports.Library.prototype.updateItems = function(items){\n\treturn this.updateObjects(items, 'item');\n};\n\n/**\n* Remove array of items to indexedDB. Just references itemKey and does no other checks that items match\n* @param {array} items\n*/\nmodule.exports.Library.prototype.removeItems = function(items){\n\treturn this.removeObjects(items, 'item');\n};\n\n/**\n* Get item from indexedDB that has given itemKey\n* @param {string} itemKey\n*/\nmodule.exports.Library.prototype.getItem = function(itemKey){\n\tvar idbLibrary = this;\n\treturn new Promise(function(resolve, reject){\n\t\tvar success = function(event){\n\t\t\tresolve(event.target.result);\n\t\t};\n\t\tidbLibrary.db.transaction('items').objectStore(['items'], 'readonly').get(itemKey).onsuccess = success;\n\t});\n};\n\n/**\n* Get all the items in this indexedDB\n* @param {array} items\n*/\nmodule.exports.Library.prototype.getAllItems = function(){\n\treturn this.getAllObjects('item');\n};\n\nmodule.exports.Library.prototype.getOrderedItemKeys = function(field, order){\n\tvar idbLibrary = this;\n\tlog.debug('Zotero.Idb.getOrderedItemKeys', 3);\n\tlog.debug('' + field + ' ' + order, 3);\n\treturn new Promise(function(resolve, reject){\n\t\tvar objectStore = idbLibrary.db.transaction(['items'], 'readonly').objectStore('items');\n\t\tvar index = objectStore.index(field);\n\t\tif(!index){\n\t\t\tthrow new Error(\"Index for requested field '\" + field + \"'' not found\");\n\t\t}\n\t\t\n\t\tvar cursorDirection = 'next';\n\t\tif(order == 'desc'){\n\t\t\tcursorDirection = 'prev';\n\t\t}\n\t\t\n\t\tvar cursorRequest = index.openKeyCursor(null, cursorDirection);\n\t\tvar itemKeys = [];\n\t\tcursorRequest.onsuccess = function(event) {\n\t\t\tvar cursor = event.target.result;\n\t\t\tif (cursor) {\n\t\t\t\titemKeys.push(cursor.primaryKey);\n\t\t\t\tcursor.continue();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlog.debug('No more cursor: done. Resolving deferred.', 3);\n\t\t\t\tresolve(itemKeys);\n\t\t\t}\n\t\t}.bind(this);\n\t\t\n\t\tcursorRequest.onfailure = function(event){\n\t\t\treject();\n\t\t}.bind(this);\n\t});\n};\n\n//filter the items in indexedDB by value in field\nmodule.exports.Library.prototype.filterItems = function(field, value){\n\tvar idbLibrary = this;\n\tlog.debug('Zotero.Idb.filterItems ' + field + ' - ' + value, 3);\n\treturn new Promise(function(resolve, reject){\n\t\tvar itemKeys = [];\n\t\tvar objectStore = idbLibrary.db.transaction(['items'], 'readonly').objectStore('items');\n\t\tvar index = objectStore.index(field);\n\t\tif(!index){\n\t\t\tthrow new Error(\"Index for requested field '\" + field + \"'' not found\");\n\t\t}\n\t\t\n\t\tvar cursorDirection = 'next';\n\t\t/*if(order == \"desc\"){\n\t\t\tcursorDirection = \"prev\";\n\t\t}*/\n\t\t\n\t\tvar range = IDBKeyRange.only(value);\n\t\tvar cursorRequest = index.openKeyCursor(range, cursorDirection);\n\t\tcursorRequest.onsuccess = function(event) {\n\t\t\tvar cursor = event.target.result;\n\t\t\tif (cursor) {\n\t\t\t\titemKeys.push(cursor.primaryKey);\n\t\t\t\tcursor.continue();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlog.debug('No more cursor: done. Resolving deferred.', 3);\n\t\t\t\tresolve(itemKeys);\n\t\t\t}\n\t\t}.bind(this);\n\t\t\n\t\tcursorRequest.onfailure = function(event){\n\t\t\treject();\n\t\t}.bind(this);\n\t});\n};\n\nmodule.exports.Library.prototype.inferType = function(object){\n\tif(!object){\n\t\treturn false;\n\t}\n\tif(!object.instance){\n\t\treturn false;\n\t}\n\tswitch(object.instance){\n\t\tcase 'Zotero.Item':\n\t\t\treturn 'item';\n\t\tcase 'Zotero.Collection':\n\t\t\treturn 'collection';\n\t\tcase 'Zotero.Tag':\n\t\t\treturn 'tag';\n\t\tdefault:\n\t\t\treturn false;\n\t}\n};\n\nmodule.exports.Library.prototype.getTransactionAndStore = function(type, access){\n\tvar idbLibrary = this;\n\tvar transaction;\n\tvar objectStore;\n\tswitch(type){\n\t\tcase 'item':\n\t\t\ttransaction = idbLibrary.db.transaction(['items'], access);\n\t\t\tobjectStore = transaction.objectStore('items');\n\t\t\tbreak;\n\t\tcase 'collection':\n\t\t\ttransaction = idbLibrary.db.transaction(['collections'], access);\n\t\t\tobjectStore = transaction.objectStore('collections');\n\t\t\tbreak;\n\t\tcase 'tag':\n\t\t\ttransaction = idbLibrary.db.transaction(['tags'], access);\n\t\t\tobjectStore = transaction.objectStore('tags');\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn Promise.reject();\n\t}\n\treturn [transaction, objectStore];\n};\n\nmodule.exports.Library.prototype.addObjects = function(objects, type){\n\tlog.debug('Zotero.Idb.Library.addObjects', 3);\n\tvar idbLibrary = this;\n\tif(!type){\n\t\ttype = idbLibrary.inferType(objects[0]);\n\t}\n\tvar TS = idbLibrary.getTransactionAndStore(type, 'readwrite');\n\tvar transaction = TS[0];\n\tvar objectStore = TS[1];\n\t\n\treturn new Promise(function(resolve, reject){\n\t\ttransaction.oncomplete = function(event){\n\t\t\tlog.debug('Add Objects transaction completed.', 3);\n\t\t\tresolve();\n\t\t};\n\t\t\n\t\ttransaction.onerror = function(event){\n\t\t\tlog.error('Add Objects transaction failed.');\n\t\t\treject();\n\t\t};\n\t\t\n\t\tvar reqSuccess = function(event){\n\t\t\tlog.debug('Added Object ' + event.target.result, 4);\n\t\t};\n\t\tfor (var i in objects) {\n\t\t\tvar request = objectStore.add(objects[i].apiObj);\n\t\t\trequest.onsuccess = reqSuccess;\n\t\t}\n\t});\n};\n\nmodule.exports.Library.prototype.updateObjects = function(objects, type){\n\tlog.debug('Zotero.Idb.Library.updateObjects', 3);\n\tvar idbLibrary = this;\n\tif(!type){\n\t\ttype = idbLibrary.inferType(objects[0]);\n\t}\n\tvar TS = idbLibrary.getTransactionAndStore(type, 'readwrite');\n\tvar transaction = TS[0];\n\tvar objectStore = TS[1];\n\t\n\treturn new Promise(function(resolve, reject){\n\t\ttransaction.oncomplete = function(event){\n\t\t\tlog.debug('Update Objects transaction completed.', 3);\n\t\t\tresolve();\n\t\t};\n\t\t\n\t\ttransaction.onerror = function(event){\n\t\t\tlog.error('Update Objects transaction failed.');\n\t\t\treject();\n\t\t};\n\t\t\n\t\tvar reqSuccess = function(event){\n\t\t\tlog.debug('Updated Object ' + event.target.result, 4);\n\t\t};\n\t\tfor (var i in objects) {\n\t\t\tvar request = objectStore.put(objects[i].apiObj);\n\t\t\trequest.onsuccess = reqSuccess;\n\t\t}\n\t});\n};\n\nmodule.exports.Library.prototype.removeObjects = function(objects, type){\n\tvar idbLibrary = this;\n\tif(!type){\n\t\ttype = idbLibrary.inferType(objects[0]);\n\t}\n\tvar TS = idbLibrary.getTransactionAndStore(type, 'readwrite');\n\tvar transaction = TS[0];\n\tvar objectStore = TS[1];\n\t\n\treturn new Promise(function(resolve, reject){\n\t\ttransaction.oncomplete = function(event){\n\t\t\tlog.debug('Remove Objects transaction completed.', 3);\n\t\t\tresolve();\n\t\t};\n\t\t\n\t\ttransaction.onerror = function(event){\n\t\t\tlog.error('Remove Objects transaction failed.');\n\t\t\treject();\n\t\t};\n\t\t\n\t\tvar reqSuccess = function(event){\n\t\t\tlog.debug('Removed Object ' + event.target.result, 4);\n\t\t};\n\t\tfor (var i in objects) {\n\t\t\tvar request = objectStore.delete(objects[i].key);\n\t\t\trequest.onsuccess = reqSuccess;\n\t\t}\n\t});\n};\n\nmodule.exports.Library.prototype.getAllObjects = function(type){\n\tvar idbLibrary = this;\n\treturn new Promise(function(resolve, reject){\n\t\tvar objects = [];\n\t\tvar objectStore = idbLibrary.db.transaction(type + 's').objectStore(type + 's');\n\t\t\n\t\tobjectStore.openCursor().onsuccess = function(event) {\n\t\t\tvar cursor = event.target.result;\n\t\t\tif (cursor) {\n\t\t\t\tobjects.push(cursor.value);\n\t\t\t\tcursor.continue();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tresolve(objects);\n\t\t\t}\n\t\t};\n\t});\n};\n\nmodule.exports.Library.prototype.addCollections = function(collections){\n\treturn this.addObjects(collections, 'collection');\n};\n\nmodule.exports.Library.prototype.updateCollections = function(collections){\n\tlog.debug('Zotero.Idb.Library.updateCollections', 3);\n\treturn this.updateObjects(collections, 'collection');\n};\n\n/**\n* Get collection from indexedDB that has given collectionKey\n* @param {string} collectionKey\n*/\nmodule.exports.Library.prototype.getCollection = function(collectionKey){\n\tvar idbLibrary = this;\n\treturn new Promise(function(resolve, reject){\n\t\tvar success = function(event){\n\t\t\tresolve(event.target.result);\n\t\t};\n\t\tidbLibrary.db.transaction('collections').objectStore(['collections'], 'readonly').get(collectionKey).onsuccess = success;\n\t});\n};\n\nmodule.exports.Library.prototype.removeCollections = function(collections){\n\tlog.debug('Zotero.Idb.Library.removeCollections', 3);\n\treturn this.removeObjects(collections, 'collection');\n};\n\nmodule.exports.Library.prototype.getAllCollections = function(){\n\tlog.debug('Zotero.Idb.Library.getAllCollections', 3);\n\treturn this.getAllObjects('collection');\n};\n\nmodule.exports.Library.prototype.addTags = function(tags){\n\treturn this.addObjects(tags, 'tag');\n};\n\nmodule.exports.Library.prototype.updateTags = function(tags){\n\tlog.debug('Zotero.Idb.Library.updateTags', 3);\n\treturn this.updateObjects(tags, 'tag');\n};\n\nmodule.exports.Library.prototype.getAllTags = function(){\n\tlog.debug('getAllTags', 3);\n\treturn this.getAllObjects('tag');\n};\n\nmodule.exports.Library.prototype.setVersion = function(type, version){\n\tlog.debug('Zotero.Idb.Library.setVersion', 3);\n\tvar idbLibrary = this;\n\treturn new Promise(function(resolve, reject){\n\t\tvar transaction = idbLibrary.db.transaction(['versions'], 'readwrite');\n\t\t\n\t\ttransaction.oncomplete = function(event){\n\t\t\tlog.debug('set version transaction completed.', 3);\n\t\t\tresolve();\n\t\t};\n\t\t\n\t\ttransaction.onerror = function(event){\n\t\t\tlog.error('set version transaction failed.');\n\t\t\treject();\n\t\t};\n\t\t\n\t\tvar versionStore = transaction.objectStore('versions');\n\t\tvar reqSuccess = function(event){\n\t\t\tlog.debug('Set Version' + event.target.result, 3);\n\t\t};\n\t\tvar request = versionStore.put(version, type);\n\t\trequest.onsuccess = reqSuccess;\n\t});\n};\n\n/**\n* Get version data from indexedDB\n* @param {string} type\n*/\nmodule.exports.Library.prototype.getVersion = function(type){\n\tlog.debug('Zotero.Idb.Library.getVersion', 3);\n\tvar idbLibrary = this;\n\treturn new Promise(function(resolve, reject){\n\t\tvar success = function(event){\n\t\t\tlog.debug('done getting version');\n\t\t\tresolve(event.target.result);\n\t\t};\n\t\tidbLibrary.db.transaction(['versions'], 'readonly').objectStore('versions').get(type).onsuccess = success;\n\t});\n};\n\nmodule.exports.Library.prototype.setFile = function(itemKey, fileData){\n\tlog.debug('Zotero.Idb.Library.setFile', 3);\n\tvar idbLibrary = this;\n\treturn new Promise(function(resolve, reject){\n\t\tvar transaction = idbLibrary.db.transaction(['files'], 'readwrite');\n\t\t\n\t\ttransaction.oncomplete = function(event){\n\t\t\tlog.debug('set file transaction completed.', 3);\n\t\t\tresolve();\n\t\t};\n\t\t\n\t\ttransaction.onerror = function(event){\n\t\t\tlog.error('set file transaction failed.');\n\t\t\treject();\n\t\t};\n\t\t\n\t\tvar fileStore = transaction.objectStore('files');\n\t\tvar reqSuccess = function(event){\n\t\t\tlog.debug('Set File' + event.target.result, 3);\n\t\t};\n\t\tvar request = fileStore.put(fileData, itemKey);\n\t\trequest.onsuccess = reqSuccess;\n\t});\n};\n\n/**\n* Get item from indexedDB that has given itemKey\n* @param {string} itemKey\n*/\nmodule.exports.Library.prototype.getFile = function(itemKey){\n\tlog.debug('Zotero.Idb.Library.getFile', 3);\n\tvar idbLibrary = this;\n\treturn new Promise(function(resolve, reject){\n\t\tvar success = function(event){\n\t\t\tlog.debug('done getting file');\n\t\t\tresolve(event.target.result);\n\t\t};\n\t\tidbLibrary.db.transaction(['files'], 'readonly').objectStore('files').get(itemKey).onsuccess = success;\n\t});\n};\n\nmodule.exports.Library.prototype.deleteFile = function(itemKey){\n\tlog.debug('Zotero.Idb.Library.deleteFile', 3);\n\tvar idbLibrary = this;\n\treturn new Promise(function(resolve, reject){\n\t\tvar transaction = idbLibrary.db.transaction(['files'], 'readwrite');\n\t\t\n\t\ttransaction.oncomplete = function(event){\n\t\t\tlog.debug('delete file transaction completed.', 3);\n\t\t\tresolve();\n\t\t};\n\t\t\n\t\ttransaction.onerror = function(event){\n\t\t\tlog.error('delete file transaction failed.');\n\t\t\treject();\n\t\t};\n\t\t\n\t\tvar fileStore = transaction.objectStore('files');\n\t\tvar reqSuccess = function(event){\n\t\t\tlog.debug('Deleted File' + event.target.result, 4);\n\t\t};\n\t\tvar request = fileStore.delete(itemKey);\n\t\trequest.onsuccess = reqSuccess;\n\t});\n};\n\n\n//intersect two arrays of strings as an AND condition on index results\nmodule.exports.Library.prototype.intersect = function(ar1, ar2){\n\tvar idbLibrary = this;\n\tvar result = [];\n\tfor(var i = 0; i < ar1.length; i++){\n\t\tif(ar2.indexOf(ar1[i]) !== -1){\n\t\t\tresult.push(ar1[i]);\n\t\t}\n\t}\n\treturn result;\n};\n\n//intersect an array of arrays of strings as an AND condition on index results\nmodule.exports.Library.prototype.intersectAll = function(arrs) {\n\tvar idbLibrary = this;\n\tvar result = arrs[0];\n\tfor(var i = 0; i < arrs.length - 1; i++){\n\t\tresult = idbLibrary.intersect(result, arrs[i+1]);\n\t}\n\treturn result;\n};\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Item');\n\nvar striptags = require('striptags');\nvar ItemMaps = require('./ItemMaps.js');\n\n/*\n * TODO: several functions should not work unless we build a fresh item with a template\n * or parsed an item from the api with json content (things that depend on apiObj)\n * There should be a flag to note whether this is the case and throwing on attempts to\n * use these functions when it is not.\n */\nvar Item = function(itemObj){\n\tthis.instance = 'Zotero.Item';\n\tthis.version = 0;\n\tthis.key = '';\n\tthis.synced = false;\n\tthis.apiObj = {};\n\tthis.pristineData = null;\n\tthis.childItemKeys = [];\n\tthis.writeErrors = [];\n\tthis.notes = [];\n\tif(itemObj){\n\t\tthis.parseJsonItem(itemObj);\n\t} else {\n\t\tthis.parseJsonItem(this.emptyJsonItem());\n\t}\n\tthis.initSecondaryData();\n};\n\nItem.prototype = new Zotero.ApiObject();\n\nItem.prototype.parseJsonItem = function (apiObj) {\n\tvar item = this;\n\titem.version = apiObj.version;\n\titem.key = apiObj.key;\n\titem.apiObj = Z.extend({}, apiObj);\n\titem.pristineData = Z.extend({}, apiObj.data);\n\tif(!item.apiObj._supplement){\n\t\titem.apiObj._supplement = {};\n\t}\n};\n\nItem.prototype.emptyJsonItem = function(){\n\treturn {\n\t\tkey: '',\n\t\tversion: 0,\n\t\tlibrary:{},\n\t\tlinks:{},\n\t\tdata: {\n\t\t\tkey:'',\n\t\t\tversion:0,\n\t\t\ttitle:'',\n\t\t\tcreators:[],\n\t\t\tcollections:[],\n\t\t\ttags:[],\n\t\t\trelations:{}\n\t\t},\n\t\tmeta: {},\n\t\t_supplement: {}\n\t};\n};\n\n//populate property values derived from json content\nItem.prototype.initSecondaryData = function(){\n\tvar item = this;\n\t\n\titem.version = item.apiObj.version;\n\t\n\tif(item.apiObj.data.itemType == 'attachment'){\n\t\titem.mimeType = item.apiObj.data.contentType;\n\t\titem.translatedMimeType = Zotero.utils.translateMimeType(item.mimeType);\n\t}\n\tif('linkMode' in item.apiObj){\n\t\titem.linkMode = item.apiObj.data.linkMode;\n\t}\n\t\n\titem.attachmentDownloadUrl = Zotero.url.attachmentDownloadUrl(item);\n\t\n\tif(item.apiObj.meta.parsedDate){\n\t\titem.parsedDate = new Date(item.apiObj.meta.parsedDate);\n\t} else {\n\t\titem.parsedDate = false;\n\t}\n\t\n\titem.synced = false;\n\n\titem.updateTagStrings();\n};\n\nItem.prototype.updateTagStrings = function(){\n\tvar item = this;\n\tvar tagstrings = [];\n\tfor (var i = 0; i < item.apiObj.data.tags.length; i++) {\n\t\ttagstrings.push(item.apiObj.data.tags[i].tag);\n\t}\n\titem.apiObj._supplement.tagstrings = tagstrings;\n};\n\nItem.prototype.initEmpty = function(itemType, linkMode){\n\tvar item = this;\n\treturn item.getItemTemplate(itemType, linkMode)\n\t.then(function(template){\n\t\titem.initEmptyFromTemplate(template);\n\t\treturn item;\n\t});\n};\n\n//special case note initialization to guarentee synchronous and simplify some uses\nItem.prototype.initEmptyNote = function(){\n\tvar item = this;\n\titem.version = 0;\n\tvar noteTemplate = {'itemType':'note','note':'','tags':[],'collections':[],'relations':{}};\n\t\n\titem.initEmptyFromTemplate(noteTemplate);\n\t\n\treturn item;\n};\n\nItem.prototype.initEmptyFromTemplate = function(template){\n\tvar item = this;\n\titem.version = 0;\n\t\n\titem.key = '';\n\titem.pristineData = Z.extend({}, template);\n\titem.apiObj = {\n\t\tkey: '',\n\t\tversion: 0,\n\t\tlibrary: {},\n\t\tlinks: {},\n\t\tdata: template,\n\t\tmeta: {},\n\t\t_supplement: {}\n\t};\n\t\n\titem.initSecondaryData();\n\treturn item;\n};\n\nItem.prototype.isSupplementaryItem = function(){\n\tvar item = this;\n\tvar itemType = item.get('itemType');\n\tif(itemType == 'attachment' || itemType == 'note'){\n\t\treturn true;\n\t}\n\treturn false;\n};\n\nItem.prototype.isSnapshot = function(){\n\tvar item = this;\n\tif(item.apiObj.links['enclosure']){\n\t\tvar ftype = item.apiObj.links['enclosure'].type;\n\t\tif(!item.apiObj.links['enclosure']['length'] && ftype == 'text/html'){\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n};\n\nItem.prototype.updateObjectKey = function(objectKey){\n\treturn this.updateItemKey(objectKey);\n};\n\nItem.prototype.updateItemKey = function(itemKey){\n\tvar item = this;\n\titem.key = itemKey;\n\titem.apiObj.key = itemKey;\n\titem.apiObj.data.key = itemKey;\n\titem.pristineData.key = itemKey;\n\treturn item;\n};\n\n/*\n * Write updated information for the item to the api and potentiallyp\n * create new child notes (or attachments?) of this item\n */\nItem.prototype.writeItem = function(){\n\tvar item = this;\n\tif(!item.owningLibrary){\n\t\tthrow new Error('Item must be associated with a library');\n\t}\n\treturn item.owningLibrary.items.writeItems([item]);\n};\n\n//get the JS object to be PUT/POSTed for write\nItem.prototype.writeApiObj = function(){\n\tvar item = this;\n\t\n\t//remove any creators that have no names\n\tif(item.apiObj.data.creators){\n\t\tvar newCreatorsArray = item.apiObj.data.creators.filter(function(c){\n\t\t\tif(c.name || c.firstName || c.lastName){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t\titem.apiObj.data.creators = newCreatorsArray;\n\t}\n\t\n\t//copy apiObj, extend with pristine to make sure required fields are present\n\t//and remove unwriteable fields(?)\n\tvar writeApiObj = Z.extend({}, item.pristineData, item.apiObj.data);\n\treturn writeApiObj;\n};\n\nItem.prototype.createChildNotes = function(notes){\n\tvar item = this;\n\tvar childItems = [];\n\tvar childItemPromises = [];\n\t\n\tnotes.forEach(function(note){\n\t\tvar childItem = new Item();\n\t\tvar p = childItem.initEmpty('note')\n\t\t.then(function(noteItem){\n\t\t\tnoteItem.set('note', note.note);\n\t\t\tnoteItem.set('parentItem', item.key);\n\t\t\tchildItems.push(noteItem);\n\t\t});\n\t\tchildItemPromises.push(p);\n\t});\n\t\n\treturn Promise.all(childItemPromises)\n\t.then(function(){\n\t\treturn item.owningLibrary.writeItems(childItems);\n\t});\n};\n\n//TODO: implement\nItem.prototype.writePatch = function(){\n\t\n};\n\nItem.prototype.getChildren = function(library){\n\tlog.debug('Zotero.Item.getChildren', 4);\n\tvar item = this;\n\treturn Promise.resolve()\n\t.then(function(){\n\t\t//short circuit if has item has no children\n\t\tif(!item.apiObj.meta.numChildren){\n\t\t\treturn [];\n\t\t}\n\t\t\n\t\tvar config = {\n\t\t\turl: {\n\t\t\t\t'target':'children',\n\t\t\t\t'libraryType':item.apiObj.library.type,\n\t\t\t\t'libraryID':item.apiObj.library.id,\n\t\t\t\t'itemKey':item.key\n\t\t\t}\n\t\t};\n\t\t\n\t\treturn item.owningLibrary.ajaxRequest(config)\n\t\t.then(function(response){\n\t\t\tlog.debug('getChildren proxied callback', 4);\n\t\t\tvar items = library.items;\n\t\t\tvar childItems = items.addItemsFromJson(response.data);\n\t\t\tfor (var i = childItems.length - 1; i >= 0; i--) {\n\t\t\t\tchildItems[i].associateWithLibrary(library);\n\t\t\t}\n\t\t\t\n\t\t\treturn childItems;\n\t\t});\n\t});\n};\n\nItem.prototype.getItemTypes = function (locale) {\n\tlog.debug('Zotero.Item.prototype.getItemTypes', 3);\n\tif(!locale){\n\t\tlocale = 'en-US';\n\t}\n\tlocale = 'en-US';\n\n\tvar itemTypes = Zotero.cache.load({locale:locale, target:'itemTypes'});\n\tif(itemTypes){\n\t\tlog.debug('have itemTypes in localStorage', 3);\n\t\tItem.prototype.itemTypes = itemTypes;//JSON.parse(Zotero.storage.localStorage['itemTypes']);\n\t\treturn;\n\t}\n\t\n\tvar query = Zotero.ajax.apiQueryString({locale:locale});\n\tvar url = Zotero.config.baseApiUrl + '/itemTypes' + query;\n\tZotero.net.ajax({\n\t\turl: Zotero.ajax.proxyWrapper(url, 'GET'),\n\t\ttype: 'GET'\n\t}).then(function(xhr){\n\t\tlog.debug('got itemTypes response', 3);\n\t\tlog.debug(xhr.response, 4);\n\t\tItem.prototype.itemTypes = JSON.parse(xhr.responseText);\n\t\tZotero.cache.save({locale:locale, target:'itemTypes'}, Item.prototype.itemTypes);\n\t});\n};\n\nItem.prototype.getItemFields = function (locale) {\n\tlog.debug('Zotero.Item.prototype.getItemFields', 3);\n\tif(!locale){\n\t\tlocale = 'en-US';\n\t}\n\tlocale = 'en-US';\n\t\n\tvar itemFields = Zotero.cache.load({locale:locale, target:'itemFields'});\n\tif(itemFields){\n\t\tlog.debug('have itemFields in localStorage', 3);\n\t\tItem.prototype.itemFields = itemFields;//JSON.parse(Zotero.storage.localStorage['itemFields']);\n\t\tObject.keys(Item.prototype.itemFields).forEach(function(key){\n\t\t\tvar val = Item.prototype.itemFields[key];\n\t\t\tZotero.localizations.fieldMap[val.field] = val.localized;\n\t\t});\n\t\treturn;\n\t}\n\t\n\tvar query = Zotero.ajax.apiQueryString({locale:locale});\n\tvar requestUrl = Zotero.config.baseApiUrl + '/itemFields' + query;\n\tZotero.net.ajax({\n\t\turl: Zotero.ajax.proxyWrapper(requestUrl),\n\t\ttype: 'GET'\n\t}).then(function(xhr){\n\t\tlog.debug('got itemTypes response', 4);\n\t\tvar data = JSON.parse(xhr.responseText);\n\t\tItem.prototype.itemFields = data;\n\t\tZotero.cache.save({locale:locale, target:'itemFields'}, data);\n\t\t//Zotero.storage.localStorage['itemFields'] = JSON.stringify(data);\n\t\tObject.keys(Item.prototype.itemFields).forEach(function(key){\n\t\t\tvar val = Item.prototype.itemFields[key];\n\t\t\tZotero.localizations.fieldMap[val.field] = val.localized;\n\t\t});\n\t});\n};\n\nItem.prototype.getItemTemplate = function (itemType='document', linkMode='') {\n\tlog.debug('Zotero.Item.prototype.getItemTemplate', 3);\n\tif(itemType == 'attachment' && linkMode == ''){\n\t\tthrow new Error('attachment template requested with no linkMode');\n\t}\n\t\n\tvar query = Zotero.ajax.apiQueryString({itemType:itemType, linkMode:linkMode});\n\tvar requestUrl = Zotero.config.baseApiUrl + '/items/new' + query;\n\t\n\tvar cacheConfig = {itemType:itemType, target:'itemTemplate'};\n\tvar itemTemplate = Zotero.cache.load(cacheConfig);\n\tif(itemTemplate){\n\t\tlog.debug('have itemTemplate in localStorage', 3);\n\t\tvar template = itemTemplate;// JSON.parse(Zotero.storage.localStorage[url]);\n\t\treturn Promise.resolve(template);\n\t}\n\t\n\treturn Zotero.ajaxRequest(requestUrl, 'GET', {dataType:'json'})\n\t.then(function(response){\n\t\tlog.debug('got itemTemplate response', 3);\n\t\tZotero.cache.save(cacheConfig, response.data);\n\t\treturn response.data;\n\t});\n};\n\nItem.prototype.getUploadAuthorization = function(fileinfo){\n\t//fileInfo: md5, filename, filesize, mtime, zip, contentType, charset\n\tlog.debug('Zotero.Item.getUploadAuthorization', 3);\n\tvar item = this;\n\t\n\tvar config = {\n\t\t'target':'item',\n\t\t'targetModifier':'file',\n\t\t'libraryType':item.owningLibrary.type,\n\t\t'libraryID':item.owningLibrary.libraryID,\n\t\t'itemKey':item.key\n\t};\n\tvar headers = {\n\t\t'Content-Type': 'application/x-www-form-urlencoded'\n\t};\n\tvar oldmd5 = item.get('md5');\n\tif(oldmd5){\n\t\theaders['If-Match'] = oldmd5;\n\t}\n\telse{\n\t\theaders['If-None-Match'] = '*';\n\t}\n\t\n\treturn Zotero.ajaxRequest(config, 'POST',\n\t\t{\n\t\t\tprocessData: true,\n\t\t\tdata:fileinfo,\n\t\t\theaders:headers\n\t\t}\n\t);\n};\n\nItem.prototype.registerUpload = function(uploadKey){\n\tlog.debug('Zotero.Item.registerUpload', 3);\n\tvar item = this;\n\tvar config = {\n\t\t'target':'item',\n\t\t'targetModifier':'file',\n\t\t'libraryType':item.owningLibrary.type,\n\t\t'libraryID':item.owningLibrary.libraryID,\n\t\t'itemKey':item.key\n\t};\n\tvar headers = {\n\t\t'Content-Type': 'application/x-www-form-urlencoded'\n\t};\n\tvar oldmd5 = item.get('md5');\n\tif(oldmd5){\n\t\theaders['If-Match'] = oldmd5;\n\t}\n\telse{\n\t\theaders['If-None-Match'] = '*';\n\t}\n\t\n\treturn Zotero.ajaxRequest(config, 'POST',\n\t{\n\t\tprocessData: true,\n\t\tdata:{upload: uploadKey},\n\t\theaders: headers\n\t});\n};\n\nItem.prototype.fullUpload = function(file){\n\n};\n\nItem.prototype.creatorTypes = {};\n\nItem.prototype.getCreatorTypes = function (itemType) {\n\tlog.debug('Zotero.Item.prototype.getCreatorTypes: ' + itemType, 3);\n\tif(!itemType){\n\t\titemType = 'document';\n\t}\n\t\n\t//parse stored creatorTypes object if it exists\n\t//creatorTypes maps itemType to the possible creatorTypes\n\tvar creatorTypes = Zotero.cache.load({target:'creatorTypes'});\n\tif(creatorTypes){\n\t\tlog.debug('have creatorTypes in localStorage', 3);\n\t\tItem.prototype.creatorTypes = creatorTypes;//JSON.parse(Zotero.storage.localStorage['creatorTypes']);\n\t}\n\t\n\tif(Item.prototype.creatorTypes[itemType]){\n\t\tlog.debug('creatorTypes of requested itemType available in localStorage', 3);\n\t\tlog.debug(Item.prototype.creatorTypes, 4);\n\t\treturn Promise.resolve(Item.prototype.creatorTypes[itemType]);\n\t}\n\telse{\n\t\tlog.debug('sending request for creatorTypes', 3);\n\t\tvar query = Zotero.ajax.apiQueryString({itemType:itemType});\n\t\t//TODO: this probably shouldn't be using baseApiUrl directly\n\t\tvar requestUrl = Zotero.config.baseApiUrl + '/itemTypeCreatorTypes' + query;\n\t\t\n\t\treturn Zotero.ajaxRequest(requestUrl, 'GET', {dataType:'json'})\n\t\t.then(function(response){\n\t\t\tlog.debug('got creatorTypes response', 4);\n\t\t\tItem.prototype.creatorTypes[itemType] = response.data;\n\t\t\t//Zotero.storage.localStorage['creatorTypes'] = JSON.stringify(Item.prototype.creatorTypes);\n\t\t\tZotero.cache.save({target:'creatorTypes'}, Item.prototype.creatorTypes);\n\t\t\treturn Item.prototype.creatorTypes[itemType];\n\t\t});\n\t}\n};\n\nItem.prototype.getCreatorFields = function (locale) {\n\tlog.debug('Zotero.Item.prototype.getCreatorFields', 3);\n\tvar creatorFields = Zotero.cache.load({target:'creatorFields'});\n\tif(creatorFields){\n\t\tlog.debug('have creatorFields in localStorage', 3);\n\t\tItem.prototype.creatorFields = creatorFields;// JSON.parse(Zotero.storage.localStorage['creatorFields']);\n\t\treturn Promise.resolve(creatorFields);\n\t}\n\t\n\tvar requestUrl = Zotero.config.baseApiUrl + '/creatorFields';\n\treturn Zotero.ajaxRequest(requestUrl, 'GET', {dataType:'json'})\n\t.then(function(response){\n\t\tlog.debug('got itemTypes response', 4);\n\t\tItem.prototype.creatorFields = response.data;\n\t\tZotero.cache.save({target:'creatorFields'}, response.data);\n\t});\n};\n\n//---Functions to manually add Zotero format data instead of fetching it from the API ---\n//To be used first with cached data for offline, could also maybe be used for custom types\nItem.prototype.addItemTypes = function(itemTypes, locale){\n\t\n};\n\nItem.prototype.addItemFields = function(itemType, itemFields){\n\t\n};\n\nItem.prototype.addCreatorTypes = function(itemType, creatorTypes){\n\t\n};\n\nItem.prototype.addCreatorFields = function(itemType, creatorFields){\n\t\n};\n\nItem.prototype.addItemTemplates = function(templates){\n\t\n};\n\nItem.prototype.itemTypeImageClass = function(){\n\t//linkModes: imported_file,imported_url,linked_file,linked_url\n\tvar item = this;\n\tif(item.apiObj.data.itemType == 'attachment'){\n\t\tswitch(item.apiObj.data.linkMode){\n\t\t\tcase 'imported_file':\n\t\t\t\tif(item.translatedMimeType == 'pdf'){\n\t\t\t\t\treturn item.itemTypeImageSrc['attachmentPdf'];\n\t\t\t\t}\n\t\t\t\treturn item.itemTypeImageSrc['attachmentFile'];\n\t\t\tcase 'imported_url':\n\t\t\t\tif(item.translatedMimeType == 'pdf'){\n\t\t\t\t\treturn item.itemTypeImageSrc['attachmentPdf'];\n\t\t\t\t}\n\t\t\t\treturn item.itemTypeImageSrc['attachmentSnapshot'];\n\t\t\tcase 'linked_file':\n\t\t\t\treturn item.itemTypeImageSrc['attachmentLink'];\n\t\t\tcase 'linked_url':\n\t\t\t\treturn item.itemTypeImageSrc['attachmentWeblink'];\n\t\t\tdefault:\n\t\t\t\treturn item.itemTypeImageSrc['attachment'];\n\t\t}\n\t}\n\telse {\n\t\treturn item.apiObj.data.itemType;\n\t}\n};\n\nItem.prototype.itemTypeIconClass = function(){\n\t//linkModes: imported_file,imported_url,linked_file,linked_url\n\tvar item = this;\n\tvar defaultIcon = 'fa fa-file-text-o';\n\tswitch(item.apiObj.data.itemType){\n\t\tcase 'attachment':\n\t\t\tswitch(item.apiObj.data.linkMode){\n\t\t\t\tcase 'imported_file':\n\t\t\t\t\tif(item.translatedMimeType == 'pdf'){\n\t\t\t\t\t\treturn 'fa fa-file-pdf-o';\n\t\t\t\t\t}\n\t\t\t\t\treturn 'glyphicons glyphicons-file';\n\t\t\t\tcase 'imported_url':\n\t\t\t\t\tif(item.translatedMimeType == 'pdf'){\n\t\t\t\t\t\treturn 'fa fa-file-pdf-o';\n\t\t\t\t\t}\n\t\t\t\t\treturn 'glyphicons glyphicons-file';\n\t\t\t\tcase 'linked_file':\n\t\t\t\t\treturn 'glyphicons glyphicons-link';\n\t\t\t\t\t//return item.itemTypeImageSrc['attachmentLink'];\n\t\t\t\tcase 'linked_url':\n\t\t\t\t\treturn 'glyphicons glyphicons-link';\n\t\t\t\t\t//return item.itemTypeImageSrc['attachmentWeblink'];\n\t\t\t\tdefault:\n\t\t\t\t\treturn 'glyphicons glyphicons-paperclip';\n\t\t\t\t\t//return item.itemTypeImageSrc['attachment'];\n\t\t\t}\n\t\t\treturn 'glyphicons file';\n\t\tcase 'artwork':\n\t\t\treturn 'glyphicons glyphicons-picture';\n\t\tcase 'audioRecording':\n\t\t\treturn 'glyphicons glyphicons-microphone';\n\t\tcase 'bill':\n\t\t\treturn defaultIcon;\n\t\tcase 'blogPost':\n\t\t\treturn 'glyphicons glyphicons-blog';\n\t\tcase 'book':\n\t\t\treturn 'glyphicons glyphicons-book';\n\t\tcase 'bookSection':\n\t\t\treturn 'glyphicons glyphicons-book-open';\n\t\tcase 'case':\n\t\t\treturn defaultIcon;\n\t\tcase 'computerProgram':\n\t\t\treturn 'glyphicons glyphicons-floppy-disk';\n\t\tcase 'conferencePaper':\n\t\t\treturn defaultIcon;\n\t\tcase 'dictionaryEntry':\n\t\t\treturn 'glyphicons glyphicons-translate';\n\t\tcase 'document':\n\t\t\treturn 'glyphicons glyphicons-file';\n\t\tcase 'email':\n\t\t\treturn 'glyphicons glyphicons-envelope';\n\t\tcase 'encyclopediaArticle':\n\t\t\treturn 'glyphicons glyphicons-bookmark';\n\t\tcase 'film':\n\t\t\treturn 'glyphicons glyphicons-film';\n\t\tcase 'forumPost':\n\t\t\treturn 'glyphicons glyphicons-bullhorn';\n\t\tcase 'hearing':\n\t\t\treturn 'fa fa-gavel';\n\t\tcase 'instantMessage':\n\t\t\treturn 'fa fa-comment-o';\n\t\tcase 'interview':\n\t\t\treturn 'fa fa-comments-o';\n\t\tcase 'journalArticle':\n\t\t\treturn 'fa fa-file-text-o';\n\t\tcase 'letter':\n\t\t\treturn 'glyphicons glyphicons-message-full';\n\t\tcase 'magazineArticle':\n\t\t\treturn defaultIcon;\n\t\tcase 'manuscript':\n\t\t\treturn 'glyphicons glyphicons-pen';\n\t\tcase 'map':\n\t\t\treturn 'glyphicons glyphicons-google-maps';\n\t\tcase 'newspaperArticle':\n\t\t\treturn 'fa fa-newspaper-o';\n\t\tcase 'note':\n\t\t\treturn 'glyphicons glyphicons-notes noteyellow';\n\t\tcase 'patent':\n\t\t\treturn 'glyphicons glyphicons-lightbulb';\n\t\tcase 'podcast':\n\t\t\treturn 'glyphicons glyphicons-ipod';\n\t\tcase 'presentation':\n\t\t\treturn 'glyphicons glyphicons-keynote';\n\t\tcase 'radioBroadcast':\n\t\t\treturn 'glyphicons glyphicons-wifi-alt';\n\t\tcase 'report':\n\t\t\treturn 'glyphicons glyphicons-notes-2';\n\t\tcase 'statue':\n\t\t\treturn 'glyphicons glyphicons-bank';\n\t\tcase 'thesis':\n\t\t\treturn 'fa fa-graduation-cap';\n\t\tcase 'tvBroadcast':\n\t\t\treturn 'glyphicons glyphicons-display';\n\t\tcase 'videoRecording':\n\t\t\treturn 'glyphicons glyphicons-facetime-video';\n\t\tcase 'webpage':\n\t\t\treturn 'glyphicons glyphicons-embed-close';\n\t\tdefault:\n\t\t\treturn 'glyphicons file';\n\t}\n};\n\nItem.prototype.get = function(key){\n\tvar item = this;\n\tswitch(key) {\n\t\tcase 'title':\n\t\t\tvar title = '';\n\t\t\tif(item.apiObj.data.itemType == 'note'){\n\t\t\t\treturn item.noteTitle(item.apiObj.data.note);\n\t\t\t} else {\n\t\t\t\treturn item.apiObj.data.title;\n\t\t\t}\n\t\t\tif(title === ''){\n\t\t\t\treturn '[Untitled]';\n\t\t\t}\n\t\t\treturn title;\n\t\tcase 'creatorSummary':\n\t\tcase 'creator':\n\t\t\tif(typeof item.apiObj.meta.creatorSummary !== 'undefined'){\n\t\t\t\treturn item.apiObj.meta.creatorSummary;\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'year':\n\t\t\tif(item.parsedDate) {\n\t\t\t\treturn item.parsedDate.getFullYear();\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn '';\n\t\t\t}\n\t}\n\t\n\tif(key in item.apiObj.data){\n\t\treturn item.apiObj.data[key];\n\t}\n\telse if(key in item.apiObj.meta){\n\t\treturn item.apiObj.meta[key];\n\t}\n\telse if(item.hasOwnProperty(key)){\n\t\treturn item[key];\n\t}\n\t\n\treturn null;\n};\n\nItem.prototype.set = function(key, val){\n\tvar item = this;\n\tif(key in item.apiObj){\n\t\titem.apiObj[key] = val;\n\t}\n\tif(key in item.apiObj.data){\n\t\titem.apiObj.data[key] = val;\n\t}\n\tif(key in item.apiObj.meta){\n\t\titem.apiObj.meta[key] = val;\n\t}\n\t\n\tswitch (key) {\n\t\tcase 'itemKey':\n\t\tcase 'key':\n\t\t\titem.key = val;\n\t\t\titem.apiObj.data.key = val;\n\t\t\tbreak;\n\t\tcase 'itemVersion':\n\t\tcase 'version':\n\t\t\titem.version = val;\n\t\t\titem.apiObj.data.version = val;\n\t\t\tbreak;\n\t\tcase 'itemType':\n\t\t\titem.itemType = val;\n\t\t\t//TODO: translate api object to new item type\n\t\t\tbreak;\n\t\tcase 'linkMode':\n\t\t\tbreak;\n\t\tcase 'deleted':\n\t\t\titem.apiObj.data.deleted = val;\n\t\t\tbreak;\n\t\tcase 'parentItem':\n\t\t\tif( val === '' ){ val = false; }\n\t\t\titem.apiObj.data.parentItem = val;\n\t\t\tbreak;\n\t}\n\t\n//    item.synced = false;\n\treturn item;\n};\n\nItem.prototype.noteTitle = function(note){\n\tvar len = 120;\n\tvar notetext = striptags(note);\n\tvar firstNewline = notetext.indexOf('\\n');\n\tif((firstNewline != -1) && firstNewline < len){\n\t\treturn notetext.substr(0, firstNewline);\n\t}\n\telse {\n\t\treturn notetext.substr(0, len);\n\t}\n};\n\nItem.prototype.setParent = function(parentItemKey){\n\tvar item = this;\n\t//pull out itemKey string if we were passed an item object\n\tif(typeof parentItemKey != 'string' &&\n\t\tparentItemKey.hasOwnProperty('instance') &&\n\t\tparentItemKey.instance == 'Zotero.Item'){\n\t\tparentItemKey = parentItemKey.key;\n\t}\n\titem.set('parentItem', parentItemKey);\n\treturn item;\n};\n\nItem.prototype.addToCollection = function(collectionKey){\n\tvar item = this;\n\t//take out the collection key if we're passed a collection object instead\n\tif(typeof collectionKey != 'string'){\n\t\tif(collectionKey.instance == 'Zotero.Collection'){\n\t\t\tcollectionKey = collectionKey.key;\n\t\t}\n\t}\n\tif(item.apiObj.data.collections.indexOf(collectionKey) === -1){\n\t\titem.apiObj.data.collections.push(collectionKey);\n\t}\n\treturn;\n};\n\nItem.prototype.removeFromCollection = function(collectionKey){\n\tvar item = this;\n\t//take out the collection key if we're passed a collection object instead\n\tif(typeof collectionKey != 'string'){\n\t\tif(collectionKey.instance == 'Zotero.Collection'){\n\t\t\tcollectionKey = collectionKey.key;\n\t\t}\n\t}\n\tvar index = item.apiObj.data.collections.indexOf(collectionKey);\n\tif(index != -1){\n\t\titem.apiObj.data.collections.splice(index, 1);\n\t}\n\treturn;\n};\n\nItem.prototype.uploadChildAttachment = function(childItem, fileInfo, progressCallback){\n\t/*\n\t * write child item so that it exists\n\t * get upload authorization for actual file\n\t * perform full upload\n\t */\n\tvar item = this;\n\tlog.debug('uploadChildAttachment', 3);\n\tif(!item.owningLibrary){\n\t\treturn Promise.reject(new Error('Item must be associated with a library'));\n\t}\n\n\t//make sure childItem has parent set\n\tchildItem.set('parentItem', item.key);\n\tchildItem.associateWithLibrary(item.owningLibrary);\n\t\n\treturn childItem.writeItem()\n\t.then(function(response){\n\t\t//successful attachmentItemWrite\n\t\titem.numChildren++;\n\t\treturn childItem.uploadFile(fileInfo, progressCallback);\n\t}, function(response){\n\t\t//failure during attachmentItem write\n\t\tthrow {\n\t\t\t'message':'Failure during attachmentItem write.',\n\t\t\t'code': response.status,\n\t\t\t'serverMessage': response.jqxhr.responseText,\n\t\t\t'response': response\n\t\t};\n\t});\n};\n\nItem.prototype.uploadFile = function(fileInfo, progressCallback){\n\tvar item = this;\n\tlog.debug('Zotero.Item.uploadFile', 3);\n\tvar uploadAuthFileData = {\n\t\tmd5:fileInfo.md5,\n\t\tfilename: item.get('title'),\n\t\tfilesize: fileInfo.filesize,\n\t\tmtime:fileInfo.mtime,\n\t\tcontentType:fileInfo.contentType,\n\t\tparams:1\n\t};\n\tif(fileInfo.contentType === ''){\n\t\tuploadAuthFileData.contentType = 'application/octet-stream';\n\t}\n\treturn item.getUploadAuthorization(uploadAuthFileData)\n\t.then(function(response){\n\t\tlog.debug('uploadAuth callback', 3);\n\t\tvar upAuthOb;\n\t\tif(typeof response.data == 'string'){upAuthOb = JSON.parse(response.data);}\n\t\telse{upAuthOb = response.data;}\n\t\tif(upAuthOb.exists == 1){\n\t\t\treturn {'message':'File Exists'};\n\t\t}\n\t\telse{\n\t\t\t//TODO: add progress\n\t\t\treturn Zotero.file.uploadFile(upAuthOb, fileInfo)\n\t\t\t.then(function(){\n\t\t\t\t//upload was successful: register it\n\t\t\t\treturn item.registerUpload(upAuthOb.uploadKey)\n\t\t\t\t.then(function(response){\n\t\t\t\t\tif(response.isError){\n\t\t\t\t\t\tvar e = {\n\t\t\t\t\t\t\t'message':'Failed to register uploaded file.',\n\t\t\t\t\t\t\t'code': response.status,\n\t\t\t\t\t\t\t'serverMessage': response.jqxhr.responseText,\n\t\t\t\t\t\t\t'response': response\n\t\t\t\t\t\t};\n\t\t\t\t\t\tlog.error(e);\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn {'message': 'Upload Successful'};\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}).catch(function(response){\n\t\tlog.debug('Failure caught during upload', 3);\n\t\tlog.debug(response, 3);\n\t\tthrow {\n\t\t\t'message':'Failure during upload.',\n\t\t\t'code': response.status,\n\t\t\t'serverMessage': response.jqxhr.responseText,\n\t\t\t'response': response\n\t\t};\n\t});\n};\n\nItem.prototype.cslItem = function(){\n\tvar zoteroItem = this;\n\t\n\t// don't return URL or accessed information for journal articles if a\n\t// pages field exists\n\tvar itemType = zoteroItem.get('itemType');//Zotero_ItemTypes::getName($zoteroItem->itemTypeID);\n\tvar cslType = zoteroItem.cslTypeMap.hasOwnProperty(itemType) ? zoteroItem.cslTypeMap[itemType] : false;\n\tif (!cslType) cslType = 'article';\n\tvar ignoreURL = ((zoteroItem.get('accessDate') || zoteroItem.get('url')) &&\n\t\t\titemType in {'journalArticle':1, 'newspaperArticle':1, 'magazineArticle':1} &&\n\t\t\tzoteroItem.get('pages') &&\n\t\t\tzoteroItem.citePaperJournalArticleURL);\n\t\n\tvar cslItem = {'type': cslType};\n\tif(zoteroItem.owningLibrary){\n\t\tcslItem['id'] = zoteroItem.apiObj.library.id + '/' + zoteroItem.get('key');\n\t} else {\n\t\tcslItem['id'] = Zotero.utils.getKey();\n\t}\n\t\n\t// get all text variables (there must be a better way)\n\t// TODO: does citeproc-js permit short forms?\n\tObject.keys(zoteroItem.cslFieldMap).forEach(function(variable){\n\t\tvar fields = zoteroItem.cslFieldMap[variable];\n\t\tif (variable == 'URL' && ignoreURL) return;\n\t\tfields.forEach(function(field){\n\t\t\tvar value = zoteroItem.get(field);\n\t\t\tif(value){\n\t\t\t\t//TODO: strip enclosing quotes? necessary when not pulling from DB?\n\t\t\t\tcslItem[variable] = value;\n\t\t\t}\n\t\t});\n\t});\n\t\n\t// separate name variables\n\tvar creators = zoteroItem.get('creators');\n\tcreators.forEach(function(creator){\n\t\tvar creatorType = creator['creatorType'];// isset(self::$zoteroNameMap[$creatorType]) ? self::$zoteroNameMap[$creatorType] : false;\n\t\tif (!creatorType) return;\n\t\t\n\t\tvar nameObj;\n\t\tif(creator.hasOwnProperty('name')){\n\t\t\tnameObj = {'literal': creator['name']};\n\t\t}\n\t\telse {\n\t\t\tnameObj = {'family': creator['lastName'], 'given': creator['firstName']};\n\t\t}\n\t\t\n\t\tif (cslItem.hasOwnProperty(creatorType)) {\n\t\t\tcslItem[creatorType].push(nameObj);\n\t\t}\n\t\telse {\n\t\t\tcslItem[creatorType] = [nameObj];\n\t\t}\n\t});\n\t\n\t// get date variables\n\tObject.keys(zoteroItem.cslDateMap).forEach(function(key){\n\t\tvar val = zoteroItem.cslDateMap[key];\n\t\tvar date = zoteroItem.get(val);\n\t\tif (date) {\n\t\t\tcslItem[key] = {'raw': date};\n\t\t}\n\t});\n\t\n\treturn cslItem;\n};\n\nObject.keys(ItemMaps).forEach(function(key) {\n\tItem.prototype[key] = ItemMaps[key];\n});\n\nmodule.exports = Item;\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:ItemMaps');\n\nvar ItemMaps = {};\n\nItemMaps.fieldMap = {\n\t'itemType'\t\t\t\t: 'Item Type',\n\t'title'\t\t\t\t\t: 'Title',\n\t'dateAdded'\t\t\t\t: 'Date Added',\n\t'dateModified'\t\t\t: 'Date Modified',\n\t'source'\t\t\t\t: 'Source',\n\t'notes'\t\t\t\t\t: 'Notes',\n\t'tags'\t\t\t\t\t: 'Tags',\n\t'attachments'\t\t\t: 'Attachments',\n\t'related'\t\t\t\t: 'Related',\n\t'url'\t\t\t\t\t: 'URL',\n\t'rights'\t\t\t\t: 'Rights',\n\t'series'\t\t\t\t: 'Series',\n\t'volume'\t\t\t\t: 'Volume',\n\t'issue'\t\t\t\t\t: 'Issue',\n\t'edition'\t\t\t\t: 'Edition',\n\t'place'\t\t\t\t\t: 'Place',\n\t'publisher'\t\t\t\t: 'Publisher',\n\t'pages'\t\t\t\t\t: 'Pages',\n\t'ISBN'\t\t\t\t\t: 'ISBN',\n\t'publicationTitle'\t\t: 'Publication',\n\t'ISSN'\t\t\t\t\t: 'ISSN',\n\t'date'\t\t\t\t\t: 'Date',\n\t'year'\t\t\t\t\t: 'Year',\n\t'section'\t\t\t\t: 'Section',\n\t'callNumber'\t\t\t: 'Call Number',\n\t'archive'\t\t\t\t: 'Archive',\n\t'archiveLocation'\t\t: 'Loc. in Archive',\n\t'libraryCatalog'\t\t: 'Library Catalog',\n\t'distributor'\t\t\t: 'Distributor',\n\t'extra'\t\t\t\t\t: 'Extra',\n\t'journalAbbreviation'\t: 'Journal Abbr',\n\t'DOI'\t\t\t\t\t: 'DOI',\n\t'accessDate'\t\t\t: 'Accessed',\n\t'seriesTitle'\t\t\t: 'Series Title',\n\t'seriesText'\t\t\t: 'Series Text',\n\t'seriesNumber'\t\t\t: 'Series Number',\n\t'institution'\t\t\t: 'Institution',\n\t'reportType'\t\t\t: 'Report Type',\n\t'code'\t\t\t\t\t: 'Code',\n\t'session'\t\t\t\t: 'Session',\n\t'legislativeBody'\t\t: 'Legislative Body',\n\t'history'\t\t\t\t: 'History',\n\t'reporter'\t\t\t\t: 'Reporter',\n\t'court'\t\t\t\t\t: 'Court',\n\t'numberOfVolumes'\t\t: '# of Volumes',\n\t'committee'\t\t\t\t: 'Committee',\n\t'assignee'\t\t\t\t: 'Assignee',\n\t'patentNumber'\t\t\t: 'Patent Number',\n\t'priorityNumbers'\t\t: 'Priority Numbers',\n\t'issueDate'\t\t\t\t: 'Issue Date',\n\t'references'\t\t\t: 'References',\n\t'legalStatus'\t\t\t: 'Legal Status',\n\t'codeNumber'\t\t\t: 'Code Number',\n\t'artworkMedium'\t\t\t: 'Medium',\n\t'number'\t\t\t\t: 'Number',\n\t'artworkSize'\t\t\t: 'Artwork Size',\n\t'repository'\t\t\t: 'Repository',\n\t'videoRecordingType'\t: 'Recording Type',\n\t'interviewMedium'\t\t: 'Medium',\n\t'letterType'\t\t\t: 'Type',\n\t'manuscriptType'\t\t: 'Type',\n\t'mapType'\t\t\t\t: 'Type',\n\t'scale'\t\t\t\t\t: 'Scale',\n\t'thesisType'\t\t\t: 'Type',\n\t'websiteType'\t\t\t: 'Website Type',\n\t'audioRecordingType'\t: 'Recording Type',\n\t'label'\t\t\t\t\t: 'Label',\n\t'presentationType'\t\t: 'Type',\n\t'meetingName'\t\t\t: 'Meeting Name',\n\t'studio'\t\t\t\t: 'Studio',\n\t'runningTime'\t\t\t: 'Running Time',\n\t'network'\t\t\t\t: 'Network',\n\t'postType'\t\t\t\t: 'Post Type',\n\t'audioFileType'\t\t\t: 'File Type',\n\t'versionNumber'\t\t\t: 'Version Number',\n\t'system'\t\t\t\t: 'System',\n\t'company'\t\t\t\t: 'Company',\n\t'conferenceName'\t\t: 'Conference Name',\n\t'encyclopediaTitle'\t\t: 'Encyclopedia Title',\n\t'dictionaryTitle'\t\t: 'Dictionary Title',\n\t'language'\t\t\t\t: 'Language',\n\t'programmingLanguage'\t: 'Language',\n\t'university'\t\t\t: 'University',\n\t'abstractNote'\t\t\t: 'Abstract',\n\t'websiteTitle'\t\t\t: 'Website Title',\n\t'reportNumber'\t\t\t: 'Report Number',\n\t'billNumber'\t\t\t: 'Bill Number',\n\t'codeVolume'\t\t\t: 'Code Volume',\n\t'codePages'\t\t\t\t: 'Code Pages',\n\t'dateDecided'\t\t\t: 'Date Decided',\n\t'reporterVolume'\t\t: 'Reporter Volume',\n\t'firstPage'\t\t\t\t: 'First Page',\n\t'documentNumber'\t\t: 'Document Number',\n\t'dateEnacted'\t\t\t: 'Date Enacted',\n\t'publicLawNumber'\t\t: 'Public Law Number',\n\t'country'\t\t\t\t: 'Country',\n\t'applicationNumber'\t\t: 'Application Number',\n\t'forumTitle'\t\t\t: 'Forum/Listserv Title',\n\t'episodeNumber'\t\t\t: 'Episode Number',\n\t'blogTitle'\t\t\t\t: 'Blog Title',\n\t'caseName'\t\t\t\t: 'Case Name',\n\t'nameOfAct'\t\t\t\t: 'Name of Act',\n\t'subject'\t\t\t\t: 'Subject',\n\t'proceedingsTitle'\t\t: 'Proceedings Title',\n\t'bookTitle'\t\t\t\t: 'Book Title',\n\t'shortTitle'\t\t\t: 'Short Title',\n\t'docketNumber'\t\t\t: 'Docket Number',\n\t'numPages'\t\t\t\t: '# of Pages',\n\t'note'\t\t\t\t\t: 'Note',\n\t'numChildren'\t\t\t: '# of Children',\n\t'addedBy'\t\t\t\t: 'Added By',\n\t'creator'\t\t\t\t: 'Creator'\n};\n\nItemMaps.typeMap = {\n\t'note'\t\t\t\t\t: 'Note',\n\t'attachment'\t\t\t: 'Attachment',\n\t'book'\t\t\t\t\t: 'Book',\n\t'bookSection'\t\t\t: 'Book Section',\n\t'journalArticle'\t\t: 'Journal Article',\n\t'magazineArticle'\t\t: 'Magazine Article',\n\t'newspaperArticle'\t\t: 'Newspaper Article',\n\t'thesis'\t\t\t\t: 'Thesis',\n\t'letter'\t\t\t\t: 'Letter',\n\t'manuscript'\t\t\t: 'Manuscript',\n\t'interview'\t\t\t\t: 'Interview',\n\t'film'\t\t\t\t\t: 'Film',\n\t'artwork'\t\t\t\t: 'Artwork',\n\t'webpage'\t\t\t\t: 'Web Page',\n\t'report'\t\t\t\t: 'Report',\n\t'bill'\t\t\t\t\t: 'Bill',\n\t'case'\t\t\t\t\t: 'Case',\n\t'hearing'\t\t\t\t: 'Hearing',\n\t'patent'\t\t\t\t: 'Patent',\n\t'statute'\t\t\t\t: 'Statute',\n\t'email'\t\t\t\t\t: 'E-mail',\n\t'map'\t\t\t\t\t: 'Map',\n\t'blogPost'\t\t\t\t: 'Blog Post',\n\t'instantMessage'\t\t: 'Instant Message',\n\t'forumPost'\t\t\t\t: 'Forum Post',\n\t'audioRecording'\t\t: 'Audio Recording',\n\t'presentation'\t\t\t: 'Presentation',\n\t'videoRecording'\t\t: 'Video Recording',\n\t'tvBroadcast'\t\t\t: 'TV Broadcast',\n\t'radioBroadcast'\t\t: 'Radio Broadcast',\n\t'podcast'\t\t\t\t: 'Podcast',\n\t'computerProgram'\t\t: 'Computer Program',\n\t'conferencePaper'\t\t: 'Conference Paper',\n\t'document'\t\t\t\t: 'Document',\n\t'encyclopediaArticle'\t: 'Encyclopedia Article',\n\t'dictionaryEntry'\t\t: 'Dictionary Entry'\n};\n\nItemMaps.creatorMap = {\n\t'author'\t\t\t: 'Author',\n\t'contributor'\t\t: 'Contributor',\n\t'editor'\t\t\t: 'Editor',\n\t'translator'\t\t: 'Translator',\n\t'seriesEditor'\t\t: 'Series Editor',\n\t'interviewee'\t\t: 'Interview With',\n\t'interviewer'\t\t: 'Interviewer',\n\t'director'\t\t\t: 'Director',\n\t'scriptwriter'\t\t: 'Scriptwriter',\n\t'producer'\t\t\t: 'Producer',\n\t'castMember'\t\t: 'Cast Member',\n\t'sponsor'\t\t\t: 'Sponsor',\n\t'counsel'\t\t\t: 'Counsel',\n\t'inventor'\t\t\t: 'Inventor',\n\t'attorneyAgent'\t\t: 'Attorney/Agent',\n\t'recipient'\t\t\t: 'Recipient',\n\t'performer'\t\t\t: 'Performer',\n\t'composer'\t\t\t: 'Composer',\n\t'wordsBy'\t\t\t: 'Words By',\n\t'cartographer'\t\t: 'Cartographer',\n\t'programmer'\t\t: 'Programmer',\n\t'reviewedAuthor'\t: 'Reviewed Author',\n\t'artist'\t\t\t: 'Artist',\n\t'commenter'\t\t\t: 'Commenter',\n\t'presenter'\t\t\t: 'Presenter',\n\t'guest'\t\t\t\t: 'Guest',\n\t'podcaster'\t\t\t: 'Podcaster'\n};\n\nItemMaps.hideFields = [\n\t'mimeType',\n\t'linkMode',\n\t'charset',\n\t'md5',\n\t'mtime',\n\t'version',\n\t'key',\n\t'collections',\n\t'relations',\n\t'parentItem',\n\t'contentType',\n\t'filename',\n\t'tags'\n];\n\nItemMaps.noEditFields = [\n\t'accessDate',\n\t'modified',\n\t'filename',\n\t'dateAdded',\n\t'dateModified'\n];\n\nItemMaps.itemTypeImageSrc = {\n\t'note'\t\t\t\t\t: 'note',\n\t'attachment'\t\t\t: 'attachment-pdf',\n\t'attachmentPdf'\t\t\t: 'attachment-pdf',\n\t'attachmentWeblink'\t\t: 'attachment-web-link',\n\t'attachmentSnapshot'\t: 'attachment-snapshot',\n\t'attachmentFile'\t\t: 'attachment-file',\n\t'attachmentLink'\t\t: 'attachment-link',\n\t'book'\t\t\t\t\t: 'book',\n\t'bookSection'\t\t\t: 'book_open',\n\t'journalArticle'\t\t: 'page_white_text',\n\t'magazineArticle'\t\t: 'layout',\n\t'newspaperArticle'\t\t: 'newspaper',\n\t'thesis'\t\t\t\t: 'report',\n\t'letter'\t\t\t\t: 'email_open',\n\t'manuscript'\t\t\t: 'script',\n\t'interview'\t\t\t\t: 'comments',\n\t'film'\t\t\t\t\t: 'film',\n\t'artwork'\t\t\t\t: 'picture',\n\t'webpage'\t\t\t\t: 'page',\n\t'report'\t\t\t\t: 'report',\n\t'bill'\t\t\t\t\t: 'page_white',\n\t'case'\t\t\t\t\t: 'page_white',\n\t'hearing'\t\t\t\t: 'page_white',\n\t'patent'\t\t\t\t: 'page_white',\n\t'statute'\t\t\t\t: 'page_white',\n\t'email'\t\t\t\t\t: 'email',\n\t'map'\t\t\t\t\t: 'map',\n\t'blogPost'\t\t\t\t: 'layout',\n\t'instantMessage'\t\t: 'page_white',\n\t'forumPost'\t\t\t\t: 'page',\n\t'audioRecording'\t\t: 'ipod',\n\t'presentation'\t\t\t: 'page_white',\n\t'videoRecording'\t\t: 'film',\n\t'tvBroadcast'\t\t\t: 'television',\n\t'radioBroadcast'\t\t: 'transmit',\n\t'podcast'\t\t\t\t: 'ipod_cast',\n\t'computerProgram'\t\t: 'page_white_code',\n\t'conferencePaper'\t\t: 'treeitem-conferencePaper',\n\t'document'\t\t\t\t: 'page_white',\n\t'encyclopediaArticle'\t: 'page_white',\n\t'dictionaryEntry'\t\t: 'page_white'\n};\n\nItemMaps.cslNameMap = {\n\t'author': 'author',\n\t'editor': 'editor',\n\t'bookAuthor': 'container-author',\n\t'composer': 'composer',\n\t'interviewer': 'interviewer',\n\t'recipient': 'recipient',\n\t'seriesEditor': 'collection-editor',\n\t'translator': 'translator'\n};\n\nItemMaps.cslFieldMap = {\n\t'title': ['title'],\n\t'container-title': ['publicationTitle',  'reporter', 'code'], /* reporter and code should move to SQL mapping tables */\n\t'collection-title': ['seriesTitle', 'series'],\n\t'collection-number': ['seriesNumber'],\n\t'publisher': ['publisher', 'distributor'], /* distributor should move to SQL mapping tables */\n\t'publisher-place': ['place'],\n\t'authority': ['court'],\n\t'page': ['pages'],\n\t'volume': ['volume'],\n\t'issue': ['issue'],\n\t'number-of-volumes': ['numberOfVolumes'],\n\t'number-of-pages': ['numPages'],\n\t'edition': ['edition'],\n\t'versionNumber': ['version'],\n\t'section': ['section'],\n\t'genre': ['type', 'artworkSize'], /* artworkSize should move to SQL mapping tables, or added as a CSL variable */\n\t'medium': ['medium', 'system'],\n\t'archive': ['archive'],\n\t'archive_location': ['archiveLocation'],\n\t'event': ['meetingName', 'conferenceName'], /* these should be mapped to the same base field in SQL mapping tables */\n\t'event-place': ['place'],\n\t'abstract': ['abstractNote'],\n\t'URL': ['url'],\n\t'DOI': ['DOI'],\n\t'ISBN': ['ISBN'],\n\t'call-number': ['callNumber'],\n\t'note': ['extra'],\n\t'number': ['number'],\n\t'references': ['history'],\n\t'shortTitle': ['shortTitle'],\n\t'journalAbbreviation': ['journalAbbreviation'],\n\t'language': ['language']\n};\n\nItemMaps.cslDateMap = {\n\t'issued': 'date',\n\t'accessed': 'accessDate'\n};\n\nItemMaps.cslTypeMap = {\n\t'book': 'book',\n\t'bookSection': 'chapter',\n\t'journalArticle': 'article-journal',\n\t'magazineArticle': 'article-magazine',\n\t'newspaperArticle': 'article-newspaper',\n\t'thesis': 'thesis',\n\t'encyclopediaArticle': 'entry-encyclopedia',\n\t'dictionaryEntry': 'entry-dictionary',\n\t'conferencePaper': 'paper-conference',\n\t'letter': 'personal_communication',\n\t'manuscript': 'manuscript',\n\t'interview': 'interview',\n\t'film': 'motion_picture',\n\t'artwork': 'graphic',\n\t'webpage': 'webpage',\n\t'report': 'report',\n\t'bill': 'bill',\n\t'case': 'legal_case',\n\t'hearing': 'bill',                // ??\n\t'patent': 'patent',\n\t'statute': 'bill',                // ??\n\t'email': 'personal_communication',\n\t'map': 'map',\n\t'blogPost': 'webpage',\n\t'instantMessage': 'personal_communication',\n\t'forumPost': 'webpage',\n\t'audioRecording': 'song',     // ??\n\t'presentation': 'speech',\n\t'videoRecording': 'motion_picture',\n\t'tvBroadcast': 'broadcast',\n\t'radioBroadcast': 'broadcast',\n\t'podcast': 'song',            // ??\n\t'computerProgram': 'book'     // ??\n};\n\nItemMaps.citePaperJournalArticleURL = false;\n\nmodule.exports = ItemMaps;","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Items');\n\nmodule.exports = function(jsonBody){\n\tthis.instance = 'Zotero.Items';\n\t//represent items as array for ordering purposes\n\tthis.itemsVersion = 0;\n\tthis.syncState = {\n\t\tearliestVersion: null,\n\t\tlatestVersion: null\n\t};\n\tthis.itemObjects = {};\n\tthis.objectMap = this.itemObjects;\n\tthis.objectArray = [];\n\tthis.unsyncedItemKeys = [];\n\t\n\tif(jsonBody){\n\t\tthis.addItemsFromJson(jsonBody);\n\t}\n};\n\nmodule.exports.prototype = new Zotero.Container();\n\nmodule.exports.prototype.getItem = function(key){\n\treturn this.getObject(key);\n};\n\nmodule.exports.prototype.getItems = function(keys){\n\treturn this.getObjects(keys);\n};\n\nmodule.exports.prototype.addItem = function(item){\n\tthis.addObject(item);\n\treturn this;\n};\n\nmodule.exports.prototype.addItemsFromJson = function(jsonBody){\n\tlog.debug('addItemsFromJson', 3);\n\tvar items = this;\n\tvar parsedItemJson = jsonBody;\n\tvar itemsAdded = [];\n\tparsedItemJson.forEach(function(itemObj){\n\t\tvar item = new Zotero.Item(itemObj);\n\t\titems.addItem(item);\n\t\titemsAdded.push(item);\n\t});\n\treturn itemsAdded;\n};\n\n//Remove item from local set if it has been marked as deleted by the server\nmodule.exports.prototype.removeLocalItem = function(key){\n\treturn this.removeObject(key);\n};\n\nmodule.exports.prototype.removeLocalItems = function(keys){\n\treturn this.removeObjects(keys);\n};\n\nmodule.exports.prototype.deleteItem = function(itemKey){\n\tlog.debug('Zotero.Items.deleteItem', 3);\n\tvar items = this;\n\tvar item;\n\t\n\tif(!itemKey) return false;\n\titemKey = items.extractKey(itemKey);\n\titem = items.getItem(itemKey);\n\t\n\tvar urlconfig = {\n\t\t'target':'item',\n\t\t'libraryType':items.owningLibrary.libraryType,\n\t\t'libraryID':items.owningLibrary.libraryID,\n\t\t'itemKey':item.key\n\t};\n\tvar requestConfig = {\n\t\turl: urlconfig,\n\t\ttype: 'DELETE',\n\t\theaders:{'If-Unmodified-Since-Version':item.get('version')}\n\t};\n\t\n\treturn items.owningLibrary.ajaxRequest(requestConfig);\n};\n\nmodule.exports.prototype.deleteItems = function(deleteItems, version){\n\t//TODO: split into multiple requests if necessary\n\tlog.debug('Zotero.Items.deleteItems', 3);\n\tvar items = this;\n\tvar deleteKeys = [];\n\tvar i;\n\tif((!version) && (items.itemsVersion !== 0)){\n\t\tversion = items.itemsVersion;\n\t}\n\t\n\t//make sure we're working with item keys, not items\n\tvar key;\n\tfor(i = 0; i < deleteItems.length; i++){\n\t\tif(!deleteItems[i]) continue;\n\t\tkey = items.extractKey(deleteItems[i]);\n\t\tif(key){\n\t\t\tdeleteKeys.push(key);\n\t\t}\n\t}\n\t\n\t//split keys into chunks of 50 per request\n\tvar deleteChunks = items.chunkObjectsArray(deleteKeys);\n\t/*\n\tvar successCallback = function(response){\n\t\tvar deleteProgress = index / deleteChunks.length;\n\t\tZotero.trigger(\"deleteProgress\", {'progress': deleteProgress});\n\t\treturn response;\n\t};\n\t*/\n\tvar requestObjects = [];\n\tfor(i = 0; i < deleteChunks.length; i++){\n\t\tvar deleteKeysString = deleteChunks[i].join(',');\n\t\tvar urlconfig = {\n\t\t\t'target':'items',\n\t\t\t'libraryType':items.owningLibrary.libraryType,\n\t\t\t'libraryID':items.owningLibrary.libraryID,\n\t\t\t'itemKey': deleteKeysString\n\t\t};\n\t\t//headers['If-Unmodified-Since-Version'] = version;\n\t\t\n\t\tvar requestConfig = {\n\t\t\turl: urlconfig,\n\t\t\ttype: 'DELETE'\n\t\t};\n\t\trequestObjects.push(requestConfig);\n\t}\n\t\n\treturn items.owningLibrary.sequentialRequests(requestObjects);\n};\n\nmodule.exports.prototype.trashItems = function(itemsArray){\n\tvar items = this;\n\tvar i;\n\tfor(i = 0; i < itemsArray.length; i++){\n\t\tvar item = itemsArray[i];\n\t\titem.set('deleted', 1);\n\t}\n\treturn items.writeItems(itemsArray);\n};\n\nmodule.exports.prototype.untrashItems = function(itemsArray){\n\tvar items = this;\n\tvar i;\n\tfor(i = 0; i < itemsArray.length; i++){\n\t\tvar item = itemsArray[i];\n\t\titem.set('deleted', 0);\n\t}\n\treturn items.writeItems(itemsArray);\n};\n\nmodule.exports.prototype.findItems = function(config){\n\tvar items = this;\n\tvar matchingItems = [];\n\tObject.keys(items.itemObjects).forEach(function(key){\n\t\tvar item = item.itemObjects[key];\n\t\tif(config.collectionKey && (item.apiObj.collections.indexOf(config.collectionKey) === -1) ){\n\t\t\treturn;\n\t\t}\n\t\tmatchingItems.push(items.itemObjects[key]);\n\t});\n\treturn matchingItems;\n};\n\n//take an array of items and extract children into their own items\n//for writing\nmodule.exports.prototype.atomizeItems = function(itemsArray){\n\t//process the array of items, pulling out child notes/attachments to write\n\t//separately with correct parentItem set and assign generated itemKeys to\n\t//new items\n\tvar writeItems = [];\n\tvar item;\n\tfor(var i = 0; i < itemsArray.length; i++){\n\t\titem = itemsArray[i];\n\t\t//generate an itemKey if the item does not already have one\n\t\tvar itemKey = item.get('key');\n\t\tif(itemKey === '' || itemKey === null) {\n\t\t\tvar newItemKey = Zotero.utils.getKey();\n\t\t\titem.set('key', newItemKey);\n\t\t\titem.set('version', 0);\n\t\t}\n\t\t//items that already have item key always in first pass, as are their children\n\t\twriteItems.push(item);\n\t\tif(item.hasOwnProperty('notes') && item.notes.length > 0){\n\t\t\tfor(var j = 0; j < item.notes.length; j++){\n\t\t\t\titem.notes[j].set('parentItem', item.get('key'));\n\t\t\t}\n\t\t\twriteItems = writeItems.concat(item.notes);\n\t\t}\n\t\tif(item.hasOwnProperty('attachments') && item.attachments.length > 0){\n\t\t\tfor(var k = 0; k < item.attachments.length; k++){\n\t\t\t\titem.attachments[k].set('parentItem', item.get('key'));\n\t\t\t}\n\t\t\twriteItems = writeItems.concat(item.attachments);\n\t\t}\n\t}\n\treturn writeItems;\n};\n\n//accept an array of 'Zotero.Item's\nmodule.exports.prototype.writeItems = function(itemsArray){\n\tvar items = this;\n\tvar library = items.owningLibrary;\n\tvar i;\n\tvar writeItems = items.atomizeItems(itemsArray);\n\t\n\tvar config = {\n\t\t'target':'items',\n\t\t'libraryType':items.owningLibrary.libraryType,\n\t\t'libraryID':items.owningLibrary.libraryID\n\t};\n\t\n\tvar writeChunks = items.chunkObjectsArray(writeItems);\n\tvar rawChunkObjects = items.rawChunks(writeChunks);\n\t\n\t//update item with server response if successful\n\tvar writeItemsSuccessCallback = function(response){\n\t\tlog.debug('writeItem successCallback', 3);\n\t\titems.updateObjectsFromWriteResponse(this.writeChunk, response);\n\t\t//save updated items to IDB\n\t\tif(Zotero.config.useIndexedDB){\n\t\t\tthis.library.idbLibrary.updateItems(this.writeChunk);\n\t\t}\n\t\t\n\t\tZotero.trigger('itemsChanged', {library:this.library});\n\t\tresponse.returnItems = this.writeChunk;\n\t\treturn response;\n\t};\n\t\n\tlog.debug('items.itemsVersion: ' + items.itemsVersion, 3);\n\tlog.debug('items.libraryVersion: ' + items.libraryVersion, 3);\n\t\n\tvar requestObjects = [];\n\tfor(i = 0; i < writeChunks.length; i++){\n\t\tvar successContext = {\n\t\t\twriteChunk: writeChunks[i],\n\t\t\tlibrary: library\n\t\t};\n\t\t\n\t\tvar requestData = JSON.stringify(rawChunkObjects[i]);\n\t\trequestObjects.push({\n\t\t\turl: config,\n\t\t\ttype: 'POST',\n\t\t\tdata: requestData,\n\t\t\tprocessData: false,\n\t\t\tsuccess: writeItemsSuccessCallback.bind(successContext)\n\t\t});\n\t}\n\t\n\treturn library.sequentialRequests(requestObjects)\n\t.then(function(responses){\n\t\tlog.debug('Done with writeItems sequentialRequests promise', 3);\n\t\treturn responses;\n\t});\n};\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Library');\n\n/**\n * A user or group Zotero library. This is generally the top level object\n * through which interactions should happen. It houses containers for\n * Zotero API objects (collections, items, etc) and handles making requests\n * with particular API credentials, as well as storing data locally.\n * @param {string} type                 type of library, 'user' or 'group'\n * @param {int} libraryID            ID of the library\n * @param {string} libraryUrlIdentifier identifier used in urls, could be library id or user/group slug\n * @param {string} apiKey               key to use for API requests\n */\nvar Library = function(type, libraryID, libraryUrlIdentifier, apiKey){\n\tlog.debug('Zotero.Library constructor', 3);\n\tlog.debug('Library Constructor: ' + type + ' ' + libraryID + ' ', 3);\n\tvar library = this;\n\tlog.debug(libraryUrlIdentifier, 4);\n\tlibrary.instance = 'Zotero.Library';\n\tlibrary.libraryVersion = 0;\n\tlibrary.syncState = {\n\t\tearliestVersion: null,\n\t\tlatestVersion: null\n\t};\n\tlibrary._apiKey = apiKey || '';\n\t\n\tlibrary.libraryUrlIdentifier = libraryUrlIdentifier;\n\tif(Zotero.config.librarySettings){\n\t\tlibrary.libraryBaseWebsiteUrl = Zotero.config.librarySettings.libraryPathString;\n\t}\n\telse{\n\t\tlibrary.libraryBaseWebsiteUrl = Zotero.config.baseWebsiteUrl;\n\t\tif(type == 'group'){\n\t\t\tlibrary.libraryBaseWebsiteUrl += 'groups/';\n\t\t}\n\t\tif(libraryUrlIdentifier){\n\t\t\tthis.libraryBaseWebsiteUrl += libraryUrlIdentifier + '/items';\n\t\t} else {\n\t\t\tlog.warn('no libraryUrlIdentifier specified');\n\t\t}\n\t}\n\t//object holders within this library, whether tied to a specific library or not\n\tlibrary.items = new Zotero.Items();\n\tlibrary.items.owningLibrary = library;\n\tlibrary.itemKeys = [];\n\tlibrary.collections = new Zotero.Collections();\n\tlibrary.collections.libraryUrlIdentifier = library.libraryUrlIdentifier;\n\tlibrary.collections.owningLibrary = library;\n\tlibrary.tags = new Zotero.Tags();\n\tlibrary.searches = new Zotero.Searches();\n\tlibrary.searches.owningLibrary = library;\n\tlibrary.groups = new Zotero.Groups();\n\tlibrary.groups.owningLibrary = library;\n\tlibrary.deleted = new Zotero.Deleted();\n\tlibrary.deleted.owningLibrary = library;\n\t\n\tif(!type){\n\t\t//return early if library not specified\n\t\tlog.warn('No type specified for library');\n\t\treturn;\n\t}\n\t//attributes tying instance to a specific Zotero library\n\tlibrary.type = type;\n\tlibrary.libraryType = type;\n\tlibrary.libraryID = libraryID;\n\tlibrary.libraryString = Zotero.utils.libraryString(library.libraryType, library.libraryID);\n\tlibrary.libraryUrlIdentifier = libraryUrlIdentifier;\n\t\n\t//initialize preferences object\n\tlibrary.preferences = new Zotero.Preferences(Zotero.store, library.libraryString);\n\t\n\tif(typeof window === 'undefined') {\n\t\tZotero.config.useIndexedDB = false;\n\t\tlog.warn('Node detected; disabling indexedDB');\n\t} else {\n\t\t//initialize indexedDB if we're supposed to use it\n\t\t//detect safari until they fix their shit\n\t\tvar is_chrome = navigator.userAgent.indexOf('Chrome') > -1;\n\t\tvar is_explorer = navigator.userAgent.indexOf('MSIE') > -1;\n\t\tvar is_firefox = navigator.userAgent.indexOf('Firefox') > -1;\n\t\tvar is_safari = navigator.userAgent.indexOf('Safari') > -1;\n\t\tvar is_opera = navigator.userAgent.toLowerCase().indexOf('op') > -1;\n\t\tif ((is_chrome)&&(is_safari)) {is_safari=false;}\n\t\tif ((is_chrome)&&(is_opera)) {is_chrome=false;}\n\t\tif(is_safari) {\n\t\t\tZotero.config.useIndexedDB = false;\n\t\t\tlog.warn('Safari detected; disabling indexedDB');\n\t\t}\n\t}\n\n\tif(Zotero.config.useIndexedDB === true) {\n\t\tlog.debug('Library Constructor: indexedDB init', 3);\n\t\tvar idbLibrary = new Zotero.Idb.Library(library.libraryString);\n\t\tidbLibrary.owningLibrary = this;\n\t\tlibrary.idbLibrary = idbLibrary;\n\t\tlibrary.cachedDataPromise = idbLibrary.init()\n\t\t.then(function(){\n\t\t\tlog.debug('Library Constructor: idbInitD Done', 3);\n\t\t\tif(Zotero.config.preloadCachedLibrary === true){\n\t\t\t\tlog.debug('Library Constructor: preloading cached library', 3);\n\t\t\t\tvar cacheLoadD = library.loadIndexedDBCache();\n\t\t\t\tcacheLoadD.then(function(){\n\t\t\t\t\t//TODO: any stuff that needs to execute only after cache is loaded\n\t\t\t\t\t//possibly fire new events to cause display to refresh after load\n\t\t\t\t\tlog.debug('Library Constructor: Library.items.itemsVersion: ' + library.items.itemsVersion, 3);\n\t\t\t\t\tlog.debug('Library Constructor: Library.collections.collectionsVersion: ' + library.collections.collectionsVersion, 3);\n\t\t\t\t\tlog.debug('Library Constructor: Library.tags.tagsVersion: ' + library.tags.tagsVersion, 3);\n\t\t\t\t\tlog.debug('Library Constructor: Triggering cachedDataLoaded', 3);\n\t\t\t\t\tlibrary.trigger('cachedDataLoaded');\n\t\t\t\t},\n\t\t\t\tfunction(err){\n\t\t\t\t\tlog.error('Error loading cached library');\n\t\t\t\t\tlog.error(err);\n\t\t\t\t\tthrow new Error('Error loading cached library');\n\t\t\t\t});\n\n\t\t\t\treturn cacheLoadD;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t//trigger cachedDataLoaded since we are done with that step\n\t\t\t\tlibrary.trigger('cachedDataLoaded');\n\t\t\t}\n\t\t},\n\t\tfunction(){\n\t\t\t//can't use indexedDB. Set to false in config and trigger error to notify user\n\t\t\tZotero.config.useIndexedDB = false;\n\t\t\tlibrary.trigger('indexedDBError');\n\t\t\tlibrary.trigger('cachedDataLoaded');\n\t\t\tlog.error('Error initializing indexedDB. Promise rejected.');\n\t\t\t//don't re-throw error, since we can still load data from the API\n\t\t});\n\t} else {\n\t\tlibrary.cachedDataPromise = Promise.resolve();\n\t}\n\t\n\tlibrary.dirty = false;\n\t\n\t//set noop data-change callbacks\n\tlibrary.tagsChanged = function(){};\n\tlibrary.collectionsChanged = function(){};\n\tlibrary.itemsChanged = function(){};\n};\n/**\n * Items columns for which sorting is supported\n * @type {Array}\n */\nLibrary.prototype.sortableColumns = ['title',\n\t\t\t\t\t\t\t\t\t\t\t'creator',\n\t\t\t\t\t\t\t\t\t\t\t'itemType',\n\t\t\t\t\t\t\t\t\t\t\t'date',\n\t\t\t\t\t\t\t\t\t\t\t'year',\n\t\t\t\t\t\t\t\t\t\t\t'publisher',\n\t\t\t\t\t\t\t\t\t\t\t'publicationTitle',\n\t\t\t\t\t\t\t\t\t\t\t'journalAbbreviation',\n\t\t\t\t\t\t\t\t\t\t\t'language',\n\t\t\t\t\t\t\t\t\t\t\t'accessDate',\n\t\t\t\t\t\t\t\t\t\t\t'libraryCatalog',\n\t\t\t\t\t\t\t\t\t\t\t'callNumber',\n\t\t\t\t\t\t\t\t\t\t\t'rights',\n\t\t\t\t\t\t\t\t\t\t\t'dateAdded',\n\t\t\t\t\t\t\t\t\t\t\t'dateModified',\n\t\t\t\t\t\t\t\t\t\t\t/*'numChildren',*/\n\t\t\t\t\t\t\t\t\t\t\t'addedBy'\n\t\t\t\t\t\t\t\t\t\t\t/*'modifiedBy'*/];\n/**\n * Columns that can be displayed in an items table UI\n * @type {Array}\n */\nLibrary.prototype.displayableColumns = ['title',\n\t\t\t\t\t\t\t\t\t\t\t'creator',\n\t\t\t\t\t\t\t\t\t\t\t'itemType',\n\t\t\t\t\t\t\t\t\t\t\t'date',\n\t\t\t\t\t\t\t\t\t\t\t'year',\n\t\t\t\t\t\t\t\t\t\t\t'publisher',\n\t\t\t\t\t\t\t\t\t\t\t'publicationTitle',\n\t\t\t\t\t\t\t\t\t\t\t'journalAbbreviation',\n\t\t\t\t\t\t\t\t\t\t\t'language',\n\t\t\t\t\t\t\t\t\t\t\t'accessDate',\n\t\t\t\t\t\t\t\t\t\t\t'libraryCatalog',\n\t\t\t\t\t\t\t\t\t\t\t'callNumber',\n\t\t\t\t\t\t\t\t\t\t\t'rights',\n\t\t\t\t\t\t\t\t\t\t\t'dateAdded',\n\t\t\t\t\t\t\t\t\t\t\t'dateModified',\n\t\t\t\t\t\t\t\t\t\t\t'numChildren',\n\t\t\t\t\t\t\t\t\t\t\t'addedBy'\n\t\t\t\t\t\t\t\t\t\t\t/*'modifiedBy'*/];\n/**\n * Items columns that only apply to group libraries\n * @type {Array}\n */\nLibrary.prototype.groupOnlyColumns = ['addedBy'\n\t\t\t\t\t\t\t\t\t\t\t/*'modifiedBy'*/];\n\n/**\n * Sort function that converts strings to locale lower case before comparing,\n * however this is still not particularly effective at getting correct localized\n * sorting in modern browsers due to browser implementations being poor. What we\n * really want here is to strip diacritics first.\n * @param  {string} a [description]\n * @param  {string} b [description]\n * @return {int}   [description]\n */\nLibrary.prototype.comparer = function(){\n\tif(Intl){\n\t\treturn new Intl.Collator().compare;\n\t} else {\n\t\treturn function(a, b){\n\t\t\tif(a.toLocaleLowerCase() == b.toLocaleLowerCase()){\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tif(a.toLocaleLowerCase() < b.toLocaleLowerCase()){\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\treturn 1;\n\t\t};\n\t}\n};\n\n//Zotero library wrapper around jQuery ajax that returns a jQuery promise\n//@url String url to request or object for input to apiRequestUrl and query string\n//@type request method\n//@options jquery options that are not the default for Zotero requests\nLibrary.prototype.ajaxRequest = function(url, type, options){\n\tlog.debug('Library.ajaxRequest', 3);\n\tif(!type){\n\t\ttype = 'GET';\n\t}\n\tif(!options){\n\t\toptions = {};\n\t}\n\tvar requestObject = {\n\t\turl: url,\n\t\ttype: type\n\t};\n\trequestObject = Z.extend({}, requestObject, options);\n\tif(!requestObject.key && (this._apiKey != '')){\n\t\trequestObject.key = this._apiKey;\n\t}\n\tlog.debug(requestObject, 3);\n\treturn Zotero.net.queueRequest(requestObject);\n};\n\n//Take an array of objects that specify Zotero API requests and perform them\n//in sequence.\n//return deferred that gets resolved when all requests have gone through.\n//Update versions after each request, otherwise subsequent writes won't go through.\n//or do we depend on specified callbacks to update versions if necessary?\n//fail on error?\n//request object must specify: url, method, body, headers, success callback, fail callback(?)\n\n/**\n * Take an array of objects that specify Zotero API requests and perform them\n * in sequence. Return a promise that gets resolved when all requests have\n * gone through.\n * @param  {[] Objects} requests Array of objects specifying requests to be made\n * @return {Promise}          Promise that resolves/rejects along with requests\n */\nLibrary.prototype.sequentialRequests = function(requests){\n\tlog.debug('Zotero.Library.sequentialRequests', 3);\n\tlet modRequests = requests.map((request)=>{\n\t\tif(!request.key && (this._apiKey != '')){\n\t\t\trequest.key = this._apiKey;\n\t\t}\n\t\treturn request;\n\t});\n\treturn Zotero.net.queueRequest(modRequests);\n};\n\n/**\n * Generate a website url based on a dictionary of variables and the configured\n * libraryBaseWebsiteUrl\n * @param  {Object} urlvars Dictionary of key/value variables\n * @return {string}         website url\n */\nLibrary.prototype.websiteUrl = function(urlvars){\n\tlog.debug('Zotero.library.websiteUrl', 3);\n\tlog.debug(urlvars, 4);\n\tvar library = this;\n\t\n\tvar urlVarsArray = [];\n\tObject.keys(urlvars).forEach(function(key){\n\t\tvar value = urlvars[key];\n\t\tif(value === '') return;\n\t\turlVarsArray.push(key + '/' + value);\n\t});\n\turlVarsArray.sort();\n\tlog.debug(urlVarsArray, 4);\n\tvar pathVarsString = urlVarsArray.join('/');\n\t\n\treturn library.libraryBaseWebsiteUrl + '/' + pathVarsString;\n};\n\n\nLibrary.prototype.synchronize = function(){\n\t//get updated group metadata if applicable\n\t//  (this is an individual library method, so only necessary if this is\n\t//  a group library and we want to keep info about it)\n\t//sync library data\n\t//  get updated collections versions newer than current library version\n\t//  get updated searches versions newer than current library version\n\t//  get updated item versions newer than current library version\n\t//\n};\n\n/**\n * Make and process API requests to update the local library items based on the\n * versions we have locally. When the promise is resolved, we should have up to\n * date items in this library's items container, as well as saved to indexedDB\n * if configured to use it.\n * @return {Promise} Promise\n */\nLibrary.prototype.loadUpdatedItems = function(){\n\tlog.debug('Zotero.Library.loadUpdatedItems', 3);\n\tvar library = this;\n\t//sync from the libraryVersion if it exists, otherwise use the itemsVersion, which is likely\n\t//derived from the most recent version of any individual item we have.\n\tvar syncFromVersion = library.libraryVersion ? library.libraryVersion : library.items.itemsVersion;\n\treturn Promise.resolve(library.updatedVersions('items', syncFromVersion))\n\t.then(function(response){\n\t\tlog.debug('itemVersions resolved', 3);\n\t\tlog.debug('items Last-Modified-Version: ' + response.lastModifiedVersion, 3);\n\t\tlibrary.items.updateSyncState(response.lastModifiedVersion);\n\t\t\n\t\tvar itemVersions = response.data;\n\t\tlibrary.itemVersions = itemVersions;\n\t\tvar itemKeys = [];\n\t\tObject.keys(itemVersions).forEach(function(key){\n\t\t\tvar val = itemVersions[key];\n\t\t\tvar item = library.items.getItem(key);\n\t\t\tif((!item) || (item.apiObj.key != val)){\n\t\t\t\titemKeys.push(key);\n\t\t\t}\n\t\t});\n\t\treturn library.loadItemsFromKeys(itemKeys);\n\t}).then(function(responses){\n\t\tlog.debug('loadItemsFromKeys resolved', 3);\n\t\tlibrary.items.updateSyncedVersion();\n\t\t\n\t\t//TODO: library needs its own state\n\t\tvar displayParams = Zotero.state.getUrlVars();\n\t\tlibrary.buildItemDisplayView(displayParams);\n\t\t//save updated items to IDB\n\t\tif(Zotero.config.useIndexedDB){\n\t\t\tvar saveItemsD = library.idbLibrary.updateItems(library.items.objectArray);\n\t\t}\n\t});\n};\n\nLibrary.prototype.loadUpdatedCollections = function(){\n\tlog.debug('Zotero.Library.loadUpdatedCollections', 3);\n\tvar library = this;\n\t//sync from the libraryVersion if it exists, otherwise use the collectionsVersion, which is likely\n\t//derived from the most recent version of any individual collection we have.\n\tlog.debug('library.collections.collectionsVersion:' + library.collections.collectionsVersion, 4);\n\t//var syncFromVersion = library.libraryVersion ? library.libraryVersion : library.collections.collectionsVersion;\n\tvar syncFromVersion = library.collections.collectionsVersion;\n\tlog.debug(`loadUpdatedCollections syncFromVersion: ${syncFromVersion}`, 3);\n\t//we need modified collectionKeys regardless, so load them\n\treturn library.updatedVersions('collections', syncFromVersion)\n\t.then(function(response){\n\t\tlog.debug('collectionVersions finished', 3);\n\t\tlog.debug('Collections Last-Modified-Version: ' + response.lastModifiedVersion, 3);\n\t\t//start the syncState version tracking. This should be the earliest version throughout\n\t\tlibrary.collections.updateSyncState(response.lastModifiedVersion);\n\t\t\n\t\tvar collectionVersions = response.data;\n\t\tlibrary.collectionVersions = collectionVersions;\n\t\tvar collectionKeys = [];\n\t\tObject.keys(collectionVersions).forEach(function(key){\n\t\t\tvar val = collectionVersions[key];\n\t\t\tvar c = library.collections.getCollection(key);\n\t\t\tif((!c) || (c.apiObj.version != val)){\n\t\t\t\tcollectionKeys.push(key);\n\t\t\t}\n\t\t});\n\t\tif(collectionKeys.length === 0){\n\t\t\tlog.debug('No collectionKeys need updating. resolving', 3);\n\t\t\treturn response;\n\t\t}\n\t\telse {\n\t\t\tlog.debug('fetching collections by key', 3);\n\t\t\treturn library.loadCollectionsFromKeys(collectionKeys)\n\t\t\t.then(function(){\n\t\t\t\tvar collections = library.collections;\n\t\t\t\tcollections.initSecondaryData();\n\t\t\t\t\n\t\t\t\tlog.debug('All updated collections loaded', 3);\n\t\t\t\tlibrary.collections.updateSyncedVersion();\n\t\t\t\t//TODO: library needs its own state\n\t\t\t\tvar displayParams = Zotero.state.getUrlVars();\n\t\t\t\t//save updated collections to cache\n\t\t\t\tlog.debug('loadUpdatedCollections complete - saving collections to cache before resolving', 3);\n\t\t\t\tlog.debug('collectionsVersion: ' + library.collections.collectionsVersion, 3);\n\t\t\t\t//library.saveCachedCollections();\n\t\t\t\t//save updated collections to IDB\n\t\t\t\tif(Zotero.config.useIndexedDB){\n\t\t\t\t\treturn library.idbLibrary.updateCollections(collections.collectionsArray);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t})\n\t.then(function(){\n\t\tlog.debug('done getting collection data. requesting deleted data', 3);\n\t\treturn library.getDeleted(library.libraryVersion);\n\t})\n\t.then(function(response){\n\t\tlog.debug('got deleted collections data: removing local copies', 3);\n\t\tlog.debug(library.deleted, 3);\n\t\tif(library.deleted.deletedData.collections && library.deleted.deletedData.collections.length > 0 ){\n\t\t\tlibrary.collections.removeLocalCollections(library.deleted.deletedData.collections);\n\t\t}\n\t});\n};\n\nLibrary.prototype.loadUpdatedTags = function(){\n\tlog.debug('Zotero.Library.loadUpdatedTags', 3);\n\tvar library = this;\n\tlog.debug('tagsVersion: ' + library.tags.tagsVersion, 3);\n\treturn Promise.resolve(library.loadAllTags({since:library.tags.tagsVersion}))\n\t.then(function(){\n\t\tlog.debug('done getting tags, request deleted tags data', 3);\n\t\treturn library.getDeleted(library.libraryVersion);\n\t})\n\t.then(function(response){\n\t\tlog.debug('got deleted tags data', 3);\n\t\tif(library.deleted.deletedData.tags && library.deleted.deletedData.tags.length > 0 ){\n\t\t\tlibrary.tags.removeTags(library.deleted.deletedData.tags);\n\t\t}\n\t\t//save updated tags to IDB\n\t\tif(Zotero.config.useIndexedDB){\n\t\t\tlog.debug('saving updated tags to IDB', 3);\n\t\t\tvar saveTagsD = library.idbLibrary.updateTags(library.tags.tagsArray);\n\t\t}\n\t});\n};\n\nLibrary.prototype.getDeleted = function(version) {\n\tlog.debug('Zotero.Library.getDeleted', 3);\n\tvar library = this;\n\tvar urlconf = {\n\t\ttarget:'deleted',\n\t\tlibraryType:library.libraryType,\n\t\tlibraryID:library.libraryID,\n\t\tsince:version\n\t};\n\t\n\t//if there is already a request working, create a new promise to resolve\n\t//when the actual request finishes\n\tif(library.deleted.pending){\n\t\tlog.debug('getDeleted resolving with previously pending promise', 3);\n\t\treturn Promise.resolve(library.deleted.pendingPromise);\n\t}\n\t\n\t//don't fetch again if version we'd be requesting is between\n\t//deleted.newer and delete.deleted versions, just use that one\n\tlog.debug('version:' + version, 3);\n\tlog.debug('sinceVersion:' + library.deleted.sinceVersion, 3);\n\tlog.debug('untilVersion:' + library.deleted.untilVersion, 3);\n\t\n\tif(library.deleted.untilVersion &&\n\t\tversion >= library.deleted.sinceVersion /*&&\n\t\tversion < library.deleted.untilVersion*/){\n\t\tlog.debug('deletedVersion matches requested: immediately resolving', 3);\n\t\treturn Promise.resolve(library.deleted.deletedData);\n\t}\n\t\n\tlibrary.deleted.pending = true;\n\tlibrary.deleted.pendingPromise = library.ajaxRequest(urlconf)\n\t.then(function(response){\n\t\tlog.debug('got deleted response', 3);\n\t\tlibrary.deleted.deletedData = response.data;\n\t\tlog.debug('Deleted Last-Modified-Version:' + response.lastModifiedVersion, 3);\n\t\tlibrary.deleted.untilVersion = response.lastModifiedVersion;\n\t\tlibrary.deleted.sinceVersion = version;\n\t}).then(function(response){\n\t\tlog.debug('cleaning up deleted pending', 3);\n\t\tlibrary.deleted.pending = false;\n\t\tlibrary.deleted.pendingPromise = false;\n\t});\n\t\n\treturn library.deleted.pendingPromise;\n};\n\nLibrary.prototype.processDeletions = function(deletions){\n\tvar library = this;\n\t//process deleted collections\n\tlibrary.collections.processDeletions(deletions.collections);\n\t//process deleted items\n\tlibrary.items.processDeletions(deletions.items);\n};\n\n//Get a full bibliography from the API for web based citating\nLibrary.prototype.loadFullBib = function(itemKeys, style){\n\tvar library = this;\n\tvar itemKeyString = itemKeys.join(',');\n\tvar urlconfig = {\n\t\t'target':'items',\n\t\t'libraryType':library.libraryType,\n\t\t'libraryID':library.libraryID,\n\t\t'itemKey':itemKeyString,\n\t\t'format':'bib',\n\t\t'linkwrap':'1'\n\t};\n\tif(itemKeys.length == 1){\n\t\turlconfig.target = 'item';\n\t}\n\tif(style){\n\t\turlconfig['style'] = style;\n\t}\n\t\n\tvar loadBibPromise = library.ajaxRequest(urlconfig)\n\t.then(function(response){\n\t\treturn response.data;\n\t});\n\t\n\treturn loadBibPromise;\n};\n\n//load bib for a single item from the API\nLibrary.prototype.loadItemBib = function(itemKey, style) {\n\tlog.debug('Zotero.Library.loadItemBib', 3);\n\tvar library = this;\n\tvar urlconfig = {\n\t\t'target':'item',\n\t\t'libraryType':library.libraryType,\n\t\t'libraryID':library.libraryID,\n\t\t'itemKey':itemKey,\n\t\t'content':'bib'\n\t};\n\tif(style){\n\t\turlconfig['style'] = style;\n\t}\n\t\n\tvar itemBibPromise = library.ajaxRequest(urlconfig)\n\t.then(function(response){\n\t\tvar item = new Zotero.Item(response.data);\n\t\tvar bibContent = item.apiObj.bib;\n\t\treturn bibContent;\n\t});\n\t\n\treturn itemBibPromise;\n};\n\n//load library settings from Zotero API and return a promise that gets resolved with\n//the Zotero.Preferences object for this library\nLibrary.prototype.loadSettings = function() {\n\tlog.debug('Zotero.Library.loadSettings', 3);\n\tvar library = this;\n\tvar urlconfig = {\n\t\t'target':'settings',\n\t\t'libraryType':library.libraryType,\n\t\t'libraryID':library.libraryID\n\t};\n\t\n\treturn library.ajaxRequest(urlconfig)\n\t.then(function(response){\n\t\tvar resultObject;\n\t\tif(typeof response.data == 'string'){\n\t\t\tresultObject = JSON.parse(response.data);\n\t\t}\n\t\telse {\n\t\t\tresultObject = response.data;\n\t\t}\n\t\t//save the full settings object so we have it available if we need to write,\n\t\t//even if it has settings we don't use or know about\n\t\tlibrary.preferences.setPref('settings', resultObject);\n\t\t\n\t\t//pull out the settings we know we care about so we can query them directly\n\t\tif(resultObject.tagColors){\n\t\t\tvar tagColors = resultObject.tagColors.value;\n\t\t\tlibrary.preferences.setPref('tagColors', tagColors);\n\t\t\t/*\n\t\t\tfor(var i = 0; i < tagColors.length; i++){\n\t\t\t\tvar t = library.tags.getTag(tagColors[i].name);\n\t\t\t\tif(t){\n\t\t\t\t\tt.color = tagColors[i].color;\n\t\t\t\t}\n\t\t\t}\n\t\t\t*/\n\t\t}\n\t\t\n\t\tlibrary.trigger('settingsLoaded');\n\t\treturn library.preferences;\n\t});\n};\n\n//take an array of tags and return subset of tags that should be colored, along with\n//the colors they should be\nLibrary.prototype.matchColoredTags = function(tags) {\n\tvar library = this;\n\tvar i;\n\tvar tagColorsSettings = library.preferences.getPref('tagColors');\n\tif(!tagColorsSettings) return [];\n\t\n\tvar tagColorsMap = {};\n\tfor(i = 0; i < tagColorsSettings.length; i++){\n\t\ttagColorsMap[tagColorsSettings[i].name.toLowerCase()] = tagColorsSettings[i].color;\n\t}\n\tvar resultTags = [];\n\t\n\tfor(i = 0; i < tags.length; i++){\n\t\tif(tagColorsMap.hasOwnProperty(tags[i]) ) {\n\t\t\tresultTags.push(tagColorsMap[tags[i]]);\n\t\t}\n\t}\n\treturn resultTags;\n};\n\n/**\n * Duplicate existing Items from this library and save to foreignLibrary\n * with relationships indicating the ties. At time of writing, Zotero client\n * saves the relationship with either the destination group of two group\n * libraries or the personal library.\n * @param  {Zotero.Item[]} items\n * @param  {Zotero.Library} foreignLibrary\n * @return {Promise.Zotero.Item[]} - newly created items\n */\nLibrary.prototype.sendToLibrary = function(items, foreignLibrary){\n\tvar foreignItems = [];\n\tfor(var i = 0; i < items.length; i++){\n\t\tvar item = items[i];\n\t\tvar transferData = item.emptyJsonItem();\n\t\ttransferData.data = Z.extend({}, items[i].apiObj.data);\n\t\t//clear data that shouldn't be transferred:itemKey, collections\n\t\ttransferData.data.key = '';\n\t\ttransferData.data.version = 0;\n\t\ttransferData.data.collections = [];\n\t\tdelete transferData.data.dateModified;\n\t\tdelete transferData.data.dateAdded;\n\t\t\n\t\tvar newForeignItem = new Zotero.Item(transferData);\n\t\t\n\t\tnewForeignItem.pristine = Z.extend({}, newForeignItem.apiObj);\n\t\tnewForeignItem.initSecondaryData();\n\t\t\n\t\t//set relationship to tie to old item\n\t\tif(!newForeignItem.apiObj.data.relations){\n\t\t\tnewForeignItem.apiObj.data.relations = {};\n\t\t}\n\t\tnewForeignItem.apiObj.data.relations['owl:sameAs'] = Zotero.url.relationUrl(item.owningLibrary.libraryType, item.owningLibrary.libraryID, item.key);\n\t\tforeignItems.push(newForeignItem);\n\t}\n\treturn foreignLibrary.items.writeItems(foreignItems);\n};\n\n/*METHODS FOR WORKING WITH THE ENTIRE LIBRARY -- NOT FOR GENERAL USE */\n\n//sync pull:\n//upload changed data\n// get updatedVersions for collections\n// get updatedVersions for searches\n// get upatedVersions for items\n// (sanity check versions we have for individual objects?)\n// loadCollectionsFromKeys\n// loadSearchesFromKeys\n// loadItemsFromKeys\n// process updated objects:\n//      ...\n// getDeletedData\n// process deleted\n// checkConcurrentUpdates (compare Last-Modified-Version from collections?newer request to one from /deleted request)\n\nLibrary.prototype.updatedVersions = function(target='items', version=this.libraryVersion){\n\tlog.debug('Library.updatedVersions', 3);\n\tvar library = this;\n\tvar urlconf = {\n\t\ttarget: target,\n\t\tformat: 'versions',\n\t\tlibraryType: library.libraryType,\n\t\tlibraryID: library.libraryID,\n\t\tsince: version\n\t};\n\treturn library.ajaxRequest(urlconf);\n};\n\n//Download and save information about every item in the library\n//keys is an array of itemKeys from this library that we need to download\nLibrary.prototype.loadItemsFromKeys = function(keys){\n\tlog.debug('Zotero.Library.loadItemsFromKeys', 3);\n\tvar library = this;\n\treturn library.loadFromKeys(keys, 'items');\n};\n\n//keys is an array of collectionKeys from this library that we need to download\nLibrary.prototype.loadCollectionsFromKeys = function(keys){\n\tlog.debug('Zotero.Library.loadCollectionsFromKeys', 3);\n\tvar library = this;\n\treturn library.loadFromKeys(keys, 'collections');\n};\n\n//keys is an array of searchKeys from this library that we need to download\nLibrary.prototype.loadSeachesFromKeys = function(keys){\n\tlog.debug('Zotero.Library.loadSearchesFromKeys', 3);\n\tvar library = this;\n\treturn library.loadFromKeys(keys, 'searches');\n};\n\nLibrary.prototype.loadFromKeys = function(keys, objectType){\n\tlog.debug('Zotero.Library.loadFromKeys', 3);\n\tif(!objectType) objectType = 'items';\n\tvar library = this;\n\tvar keyslices = [];\n\twhile(keys.length > 0){\n\t\tkeyslices.push(keys.splice(0, 50));\n\t}\n\t\n\tvar requestObjects = [];\n\tkeyslices.forEach(function(keyslice){\n\t\tvar keystring = keyslice.join(',');\n\t\tswitch (objectType) {\n\t\t\tcase 'items':\n\t\t\t\trequestObjects.push({\n\t\t\t\t\turl: {\n\t\t\t\t\t\t'target':'items',\n\t\t\t\t\t\t'targetModifier':null,\n\t\t\t\t\t\t'itemKey':keystring,\n\t\t\t\t\t\t'limit':50,\n\t\t\t\t\t\t'libraryType':library.libraryType,\n\t\t\t\t\t\t'libraryID':library.libraryID\n\t\t\t\t\t},\n\t\t\t\t\ttype: 'GET',\n\t\t\t\t\tsuccess: library.processLoadedItems.bind(library)\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'collections':\n\t\t\t\trequestObjects.push({\n\t\t\t\t\turl: {\n\t\t\t\t\t\t'target':'collections',\n\t\t\t\t\t\t'targetModifier':null,\n\t\t\t\t\t\t'collectionKey':keystring,\n\t\t\t\t\t\t'limit':50,\n\t\t\t\t\t\t'libraryType':library.libraryType,\n\t\t\t\t\t\t'libraryID':library.libraryID\n\t\t\t\t\t},\n\t\t\t\t\ttype: 'GET',\n\t\t\t\t\tsuccess: library.processLoadedCollections.bind(library)\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'searches':\n\t\t\t\trequestObjects.push({\n\t\t\t\t\turl: {\n\t\t\t\t\t\t'target':'searches',\n\t\t\t\t\t\t'targetModifier':null,\n\t\t\t\t\t\t'searchKey':keystring,\n\t\t\t\t\t\t'limit':50,\n\t\t\t\t\t\t'libraryType':library.libraryType,\n\t\t\t\t\t\t'libraryID':library.libraryID\n\t\t\t\t\t},\n\t\t\t\t\ttype: 'GET'\n\t\t\t\t\t//success: library.processLoadedSearches.bind(library)\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t}\n\t});\n\t\n\tvar promises = [];\n\tfor(var i = 0; i < requestObjects.length; i++){\n\t\tlet url = requestObjects[i].url;\n\t\tlet type = requestObjects[i].type;\n\t\tlet options = {\n\t\t\tsuccess: requestObjects[i].success\n\t\t};\n\t\tpromises.push(library.ajaxRequest(url, type, options));\n\t}\n\treturn Promise.all(promises);\n};\n\n//publishes: displayedItemsUpdated\n//assume we have up to date information about items in indexeddb.\n//build a list of indexedDB filter requests to then intersect to get final result\nLibrary.prototype.buildItemDisplayView = function(params) {\n\tlog.debug('Zotero.Library.buildItemDisplayView', 3);\n\tlog.debug(params, 4);\n\t//start with list of all items if we don't have collectionKey\n\t//otherwise get the list of items in that collection\n\tvar library = this;\n\t//short-circuit if we don't have an initialized IDB yet\n\tif(!library.idbLibrary.db){\n\t\treturn Promise.resolve([]);\n\t}\n\t\n\tvar filterPromises = [];\n\tif(params.collectionKey){\n\t\tif(params.collectionKey == 'trash'){\n\t\t\tfilterPromises.push(library.idbLibrary.filterItems('deleted', 1));\n\t\t}\n\t\telse{\n\t\t\tfilterPromises.push(library.idbLibrary.filterItems('collectionKeys', params.collectionKey));\n\t\t}\n\t}\n\telse {\n\t\tfilterPromises.push(library.idbLibrary.getOrderedItemKeys('title'));\n\t}\n\t\n\t//filter by selected tags\n\tvar selectedTags = params.tag || [];\n\tif(typeof selectedTags == 'string') selectedTags = [selectedTags];\n\tfor(var i = 0; i < selectedTags.length; i++){\n\t\tlog.debug('adding selected tag filter', 3);\n\t\tfilterPromises.push(library.idbLibrary.filterItems('itemTagStrings', selectedTags[i]));\n\t}\n\t\n\t//TODO: filter by search term. \n\t//(need full text array or to decide what we're actually searching on to implement this locally)\n\t\n\t//when all the filters have been applied, combine and sort\n\treturn Promise.all(filterPromises)\n\t.then(function(results){\n\t\tvar i;\n\t\tfor(i = 0; i < results.length; i++){\n\t\t\tlog.debug('result from filterPromise: ' + results[i].length, 3);\n\t\t\tlog.debug(results[i], 3);\n\t\t}\n\t\tvar finalItemKeys = library.idbLibrary.intersectAll(results);\n\t\tvar itemsArray = library.items.getItems(finalItemKeys);\n\t\t\n\t\tlog.debug('All filters applied - Down to ' + itemsArray.length + ' items displayed', 3);\n\t\t\n\t\tlog.debug('remove child items and, if not viewing trash, deleted items', 3);\n\t\tvar displayItemsArray = [];\n\t\tfor(i = 0; i < itemsArray.length; i++){\n\t\t\tif(itemsArray[i].apiObj.data.parentItem){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t\n\t\t\tif(params.collectionKey != 'trash' && itemsArray[i].apiObj.deleted){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t\n\t\t\tdisplayItemsArray.push(itemsArray[i]);\n\t\t}\n\t\t\n\t\t//sort displayedItemsArray by given or configured column\n\t\tvar orderCol = params['order'] || 'title';\n\t\tvar sort = params['sort'] || 'asc';\n\t\tlog.debug('Sorting by ' + orderCol + ' - ' + sort, 3);\n\t\t\n\t\tvar comparer = Zotero.Library.prototype.comparer();\n\t\t\n\t\tdisplayItemsArray.sort(function(a, b){\n\t\t\tvar aval = a.get(orderCol);\n\t\t\tvar bval = b.get(orderCol);\n\t\t\t\n\t\t\treturn comparer(aval, bval);\n\t\t});\n\t\t\n\t\tif(sort == 'desc'){\n\t\t\tlog.debug('sort is desc - reversing array', 4);\n\t\t\tdisplayItemsArray.reverse();\n\t\t}\n\t\t\n\t\t//publish event signalling we're done\n\t\tlog.debug('triggering publishing displayedItemsUpdated', 3);\n\t\tlibrary.trigger('displayedItemsUpdated');\n\t\treturn displayItemsArray;\n\t});\n};\n\nLibrary.prototype.trigger = function(eventType, data){\n\tvar library = this;\n\tZotero.trigger(eventType, data, library.libraryString);\n};\n\nLibrary.prototype.listen = function(events, handler, data){\n\tvar library = this;\n\tvar filter = library.libraryString;\n\tZotero.listen(events, handler, data, filter);\n};\n\n//CollectionFunctions\nLibrary.prototype.processLoadedCollections = function(response){\n\tlog.debug('processLoadedCollections', 3);\n\tvar library = this;\n\t\n\t//clear out display items\n\tlog.debug('adding collections to library.collections', 3);\n\tvar collectionsAdded = library.collections.addCollectionsFromJson(response.data);\n\tfor (var i = 0; i < collectionsAdded.length; i++) {\n\t\tcollectionsAdded[i].associateWithLibrary(library);\n\t}\n\t//update sync state\n\tlibrary.collections.updateSyncState(response.lastModifiedVersion);\n\t\n\tZotero.trigger('loadedCollectionsProcessed', {library:library, collectionsAdded:collectionsAdded});\n\treturn response;\n};\n\n//create+write a collection given a name and optional parentCollectionKey\nLibrary.prototype.addCollection = function(name, parentCollection){\n\tlog.debug('Zotero.Library.addCollection', 3);\n\tvar library = this;\n\t\n\tvar collection = new Zotero.Collection();\n\tcollection.associateWithLibrary(library);\n\tcollection.set('name', name);\n\tcollection.set('parentCollection', parentCollection);\n\t\n\treturn library.collections.writeCollections([collection]);\n};\n\n//ItemFunctions\n//make request for item keys and return jquery ajax promise\nLibrary.prototype.fetchItemKeys = function(config={}){\n\tlog.debug('Zotero.Library.fetchItemKeys', 3);\n\tvar library = this;\n\tvar urlconfig = Z.extend(true, {\n\t\t'target':'items',\n\t\t'libraryType':this.libraryType,\n\t\t'libraryID':this.libraryID,\n\t\t'format':'keys'\n\t}, config);\n\t\n\treturn library.ajaxRequest(urlconfig);\n};\n\n//get keys of all items marked for deletion\nLibrary.prototype.getTrashKeys = function(){\n\tlog.debug('Zotero.Library.getTrashKeys', 3);\n\tvar library = this;\n\tvar urlconfig = {\n\t\t'target': 'items',\n\t\t'libraryType': library.libraryType,\n\t\t'libraryID': library.libraryID,\n\t\t'format': 'keys',\n\t\t'collectionKey': 'trash'\n\t};\n\t\n\treturn library.ajaxRequest(urlconfig);\n};\n\nLibrary.prototype.emptyTrash = function(){\n\tlog.debug('Zotero.Library.emptyTrash', 3);\n\tvar library = this;\n\treturn library.getTrashKeys()\n\t.then(function(response){\n\t\tvar trashedItemKeys = response.data.split('\\n');\n\t\treturn library.items.deleteItems(trashedItemKeys, response.lastModifiedVersion);\n\t});\n};\n\nLibrary.prototype.loadItemKeys = function(config){\n\tlog.debug('Zotero.Library.loadItemKeys', 3);\n\tvar library = this;\n\treturn this.fetchItemKeys(config)\n\t.then(function(response){\n\t\tlog.debug('loadItemKeys proxied callback', 3);\n\t\tvar keys = response.data.split(/[\\s]+/);\n\t\tlibrary.itemKeys = keys;\n\t});\n};\n\nLibrary.prototype.loadItems = function(config){\n\tlog.debug('Zotero.Library.loadItems', 3);\n\tvar library = this;\n\tif(!config){\n\t\tconfig = {};\n\t}\n\t\n\tvar defaultConfig = {\n\t\ttarget:'items',\n\t\ttargetModifier: 'top',\n\t\tstart: 0,\n\t\tlimit: 25,\n\t\torder: Zotero.config.defaultSortColumn,\n\t\tsort: Zotero.config.defaultSortOrder\n\t};\n\t\n\t//Build config object that should be displayed next and compare to currently displayed\n\tvar newConfig = Z.extend({}, defaultConfig, config);\n\t//newConfig.start = parseInt(newConfig.limit, 10) * (parseInt(newConfig.itemPage, 10) - 1);\n\t\n\tvar urlconfig = Z.extend({\n\t\t'target':'items',\n\t\t'libraryType':library.libraryType,\n\t\t'libraryID':library.libraryID\n\t}, newConfig);\n\t\n\treturn library.ajaxRequest(urlconfig)\n\t.then(function(response){\n\t\tlog.debug('loadItems proxied callback', 3);\n\t\t//var library = this;\n\t\tvar items = library.items;\n\t\t//clear out display items\n\t\tvar loadedItemsArray = items.addItemsFromJson(response.data);\n\t\tfor (let i = 0; i < loadedItemsArray.length; i++) {\n\t\t\tloadedItemsArray[i].associateWithLibrary(library);\n\t\t}\n\t\t\n\t\tresponse.loadedItems = loadedItemsArray;\n\t\tZotero.trigger('itemsChanged', {library:library});\n\t\treturn response;\n\t});\n};\n\nLibrary.prototype.loadPublications = function(config){\n\tlog.debug('Zotero.Library.loadPublications', 3);\n\tvar library = this;\n\tif(!config){\n\t\tconfig = {};\n\t}\n\t\n\tvar defaultConfig = {\n\t\ttarget:'publications',\n\t\tstart: 0,\n\t\tlimit: 50,\n\t\torder: Zotero.config.defaultSortColumn,\n\t\tsort: Zotero.config.defaultSortOrder,\n\t\tinclude: 'bib'\n\t};\n\t\n\t//Build config object that should be displayed next and compare to currently displayed\n\tvar newConfig = Z.extend({}, defaultConfig, config);\n\t\n\tvar urlconfig = Z.extend({\n\t\t'target':'publications',\n\t\t'libraryType':library.libraryType,\n\t\t'libraryID':library.libraryID\n\t}, newConfig);\n\t\n\treturn library.ajaxRequest(urlconfig)\n\t.then(function(response){\n\t\tlog.debug('loadPublications proxied callback', 3);\n\t\tvar publicationItems = [];\n\t\tvar parsedItemJson = response.data;\n\t\tparsedItemJson.forEach(function(itemObj){\n\t\t\tvar item = new Zotero.Item(itemObj);\n\t\t\tpublicationItems.push(item);\n\t\t});\n\t\t\n\t\tresponse.publicationItems = publicationItems;\n\t\treturn response;\n\t});\n};\n\nLibrary.prototype.processLoadedItems = function(response){\n\tlog.debug('processLoadedItems', 3);\n\tvar library = this;\n\tvar items = library.items;\n\t//clear out display items\n\tvar loadedItemsArray = items.addItemsFromJson(response.data);\n\tfor (var i = 0; i < loadedItemsArray.length; i++) {\n\t\tloadedItemsArray[i].associateWithLibrary(library);\n\t}\n\t\n\t//update sync state\n\tlibrary.items.updateSyncState(response.lastModifiedVersion);\n\t\n\tZotero.trigger('itemsChanged', {library:library, loadedItems:loadedItemsArray});\n\treturn response;\n};\n\nLibrary.prototype.loadItem = function(itemKey) {\n\tlog.debug('Zotero.Library.loadItem', 3);\n\tvar library = this;\n\tif(!config){\n\t\tvar config = {};\n\t}\n\t\n\tvar urlconfig = {\n\t\t'target':'item',\n\t\t'libraryType':library.libraryType,\n\t\t'libraryID':library.libraryID,\n\t\t'itemKey':itemKey\n\t};\n\t\n\treturn library.ajaxRequest(urlconfig)\n\t.then(function(response){\n\t\tlog.debug('Got loadItem response', 3);\n\t\tvar item = new Zotero.Item(response.data);\n\t\titem.owningLibrary = library;\n\t\tlibrary.items.itemObjects[item.key] = item;\n\t\tZotero.trigger('itemsChanged', {library:library});\n\t\treturn(item);\n\t},\n\tfunction(response){\n\t\tlog.warn('Error loading Item');\n\t});\n};\n\nLibrary.prototype.trashItem = function(itemKey){\n\tvar library = this;\n\treturn library.items.trashItems([library.items.getItem(itemKey)]);\n};\n\nLibrary.prototype.untrashItem = function(itemKey){\n\tlog.debug('Zotero.Library.untrashItem', 3);\n\tif(!itemKey) return false;\n\t\n\tvar item = this.items.getItem(itemKey);\n\titem.apiObj.deleted = 0;\n\treturn item.writeItem();\n};\n\nLibrary.prototype.deleteItem = function(itemKey){\n\tlog.debug('Zotero.Library.deleteItem', 3);\n\tvar library = this;\n\treturn library.items.deleteItem(itemKey);\n};\n\nLibrary.prototype.deleteItems = function(itemKeys){\n\tlog.debug('Zotero.Library.deleteItems', 3);\n\tvar library = this;\n\treturn library.items.deleteItems(itemKeys);\n};\n\nLibrary.prototype.addNote = function(itemKey, note){\n\tlog.debug('Zotero.Library.prototype.addNote', 3);\n\tvar library = this;\n\tvar config = {\n\t\t'target':'children',\n\t\t'libraryType':library.libraryType,\n\t\t'libraryID':library.libraryID,\n\t\t'itemKey':itemKey\n\t};\n\t\n\tvar item = this.items.getItem(itemKey);\n\t\n\treturn library.ajaxRequest(config, 'POST', {processData: false});\n};\n\nLibrary.prototype.fetchGlobalItems = function(config){\n\tlog.debug('Zotero.Library.fetchGlobalItems', 3);\n\tvar library = this;\n\tif(!config){\n\t\tconfig = {};\n\t}\n\t\n\tvar defaultConfig = {\n\t\ttarget:'items',\n\t\tstart: 0,\n\t\tlimit: 25\n\t};\n\t\n\t//Build config object that should be displayed next and compare to currently displayed\n\tvar newConfig = Z.extend({}, defaultConfig, config);\n\t\n\tvar urlconfig = Z.extend({'target':'items', 'libraryType': ''}, newConfig);\n\t\n\treturn library.ajaxRequest(urlconfig, 'GET', {dataType:'json'})\n\t.then(function(response){\n\t\tlog.debug('globalItems callback', 3);\n\t\treturn(response.data);\n\t});\n};\n\nLibrary.prototype.fetchGlobalItem = function(globalKey){\n\tlog.debug('Zotero.Library.fetchGlobalItem', 3);\n\tlog.debug(globalKey, 3);\n\tvar library = this;\n\t\n\tvar defaultConfig = {target:'item'};\n\t\n\t//Build config object that should be displayed next and compare to currently displayed\n\tvar newConfig = Z.extend({}, defaultConfig);\n\tvar urlconfig = Z.extend({\n\t\t'target':'item',\n\t\t'libraryType': '',\n\t\t'itemKey': globalKey\n\t}, newConfig);\n\t\n\treturn library.ajaxRequest(urlconfig, 'GET', {dataType:'json'})\n\t.then(function(response){\n\t\tlog.debug('globalItem callback', 3);\n\t\treturn(response.data);\n\t});\n};\n\n//TagFunctions\nLibrary.prototype.fetchTags = function(config){\n\tlog.debug('Zotero.Library.fetchTags', 3);\n\tvar library = this;\n\tvar defaultConfig = {\n\t\ttarget:'tags',\n\t\torder:'title',\n\t\tsort:'asc',\n\t\tlimit: 100\n\t};\n\tvar newConfig = Z.extend({}, defaultConfig, config);\n\tvar urlconfig = Z.extend({\n\t\t'target':'tags',\n\t\t'libraryType':this.libraryType,\n\t\t'libraryID':this.libraryID\n\t}, newConfig);\n\t\n\treturn Zotero.ajaxRequest(urlconfig);\n};\n\nLibrary.prototype.loadTags = function(config={}){\n\tlog.debug('Zotero.Library.loadTags', 3);\n\tvar library = this;\n\t\n\tif(config.showAutomaticTags && config.collectionKey){\n\t\tdelete config.collectionKey;\n\t}\n\t\n\tlibrary.tags.displayTagsArray = [];\n\treturn library.fetchTags(config)\n\t.then(function(response){\n\t\tlog.debug('loadTags proxied callback', 3);\n\t\tvar updatedVersion = response.lastModifiedVersion;\n\t\tlibrary.tags.updateSyncState(updatedVersion);\n\t\tvar addedTags = library.tags.addTagsFromJson(response.data);\n\t\tlibrary.tags.updateTagsVersion(updatedVersion);\n\t\tlibrary.tags.rebuildTagsArray();\n\t\t\n\t\tif(response.parsedLinks.hasOwnProperty('next')){\n\t\t\tlibrary.tags.hasNextLink = true;\n\t\t\tlibrary.tags.nextLink = response.parsedLinks['next'];\n\t\t}\n\t\telse{\n\t\t\tlibrary.tags.hasNextLink = false;\n\t\t\tlibrary.tags.nextLink = null;\n\t\t}\n\t\tlibrary.trigger('tagsChanged', {library:library});\n\t\treturn library.tags;\n\t});\n};\n\n\nLibrary.prototype.loadAllTags = function(config={}){\n\tlog.debug('Zotero.Library.loadAllTags', 3);\n\tvar library = this;\n\tvar defaultConfig = {\n\t\ttarget:'tags',\n\t\torder:'title',\n\t\tsort:'asc',\n\t\tlimit: 100,\n\t\tlibraryType:library.libraryType,\n\t\tlibraryID:library.libraryID\n\t};\n\t\n\t//Build config object that should be displayed next and compare to currently displayed\n\tvar newConfig = Z.extend({}, defaultConfig, config);\n\tvar urlconfig = Z.extend({}, newConfig);\n\t\n\t//check if already loaded tags are okay to use\n\treturn new Promise(function(resolve, reject){\n\t\tvar continueLoadingCallback = function(tags){\n\t\t\tlog.debug('loadAllTags continueLoadingCallback', 3);\n\t\t\tvar plainList = Zotero.Tags.prototype.plainTagsList(tags.tagsArray);\n\t\t\tplainList.sort(Library.prototype.comparer());\n\t\t\ttags.plainList = plainList;\n\t\t\t\n\t\t\tif(tags.hasNextLink){\n\t\t\t\tlog.debug('still has next link.', 3);\n\t\t\t\ttags.tagsArray.sort(Zotero.Tag.prototype.tagComparer());\n\t\t\t\tplainList = Zotero.Tags.prototype.plainTagsList(tags.tagsArray);\n\t\t\t\tplainList.sort(Library.prototype.comparer());\n\t\t\t\ttags.plainList = plainList;\n\t\t\t\t\n\t\t\t\tvar nextLink = tags.nextLink;\n\t\t\t\tvar nextLinkConfig = Zotero.utils.parseQuery(Zotero.utils.querystring(nextLink));\n\t\t\t\tvar newConfig = Z.extend({}, config);\n\t\t\t\tnewConfig.start = nextLinkConfig.start;\n\t\t\t\tnewConfig.limit = nextLinkConfig.limit;\n\t\t\t\treturn library.loadTags(newConfig).then(continueLoadingCallback);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tlog.debug('no next in tags link', 3);\n\t\t\t\ttags.updateSyncedVersion();\n\t\t\t\ttags.tagsArray.sort(Zotero.Tag.prototype.tagComparer());\n\t\t\t\tplainList = Zotero.Tags.prototype.plainTagsList(tags.tagsArray);\n\t\t\t\tplainList.sort(Library.prototype.comparer());\n\t\t\t\ttags.plainList = plainList;\n\t\t\t\tlog.debug('resolving loadTags deferred', 3);\n\t\t\t\tlibrary.tagsLoaded = true;\n\t\t\t\tlibrary.tags.loaded = true;\n\t\t\t\ttags.loadedConfig = config;\n\t\t\t\t\n\t\t\t\t//update all tags with tagsVersion\n\t\t\t\tfor (var i = 0; i < library.tags.tagsArray.length; i++) {\n\t\t\t\t\ttags.tagsArray[i].apiObj.version = tags.tagsVersion;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlibrary.trigger('tagsChanged', {library:library});\n\t\t\t\treturn tags;\n\t\t\t}\n\t\t};\n\t\t\n\t\tresolve( library.loadTags(urlconfig)\n\t\t.then(continueLoadingCallback));\n\t});\n};\n\n//LibraryCache\n//load objects from indexedDB\nLibrary.prototype.loadIndexedDBCache = function(){\n\tlog.debug('Zotero.Library.loadIndexedDBCache', 3);\n\t\n\tvar library = this;\n\t\n\tvar itemsPromise = library.idbLibrary.getAllItems();\n\tvar collectionsPromise = library.idbLibrary.getAllCollections();\n\tvar tagsPromise = library.idbLibrary.getAllTags();\n\t\n\titemsPromise.then(function(itemsArray){\n\t\tlog.debug('loadIndexedDBCache itemsD done', 3);\n\t\t//create itemsDump from array of item objects\n\t\tvar latestItemVersion = 0;\n\t\tfor(var i = 0; i < itemsArray.length; i++){\n\t\t\tvar item = new Zotero.Item(itemsArray[i]);\n\t\t\tlibrary.items.addItem(item);\n\t\t\tif(item.version > latestItemVersion){\n\t\t\t\tlatestItemVersion = item.version;\n\t\t\t}\n\t\t}\n\t\tlibrary.items.itemsVersion = latestItemVersion;\n\t\t\n\t\t//TODO: add itemsVersion as last version in any of these items?\n\t\t//or store it somewhere else for indexedDB cache purposes\n\t\tlibrary.items.loaded = true;\n\t\tlog.debug('Done loading indexedDB items promise into library', 3);\n\t});\n\t\n\tcollectionsPromise.then(function(collectionsArray){\n\t\tlog.debug('loadIndexedDBCache collectionsD done', 3);\n\t\t//create collectionsDump from array of collection objects\n\t\tvar latestCollectionVersion = 0;\n\t\tfor(var i = 0; i < collectionsArray.length; i++){\n\t\t\tvar collection = new Zotero.Collection(collectionsArray[i]);\n\t\t\tlibrary.collections.addCollection(collection);\n\t\t\tif(collection.version > latestCollectionVersion){\n\t\t\t\tlatestCollectionVersion = collection.version;\n\t\t\t}\n\t\t}\n\t\tlibrary.collections.collectionsVersion = latestCollectionVersion;\n\t\t\n\t\t//TODO: add collectionsVersion as last version in any of these items?\n\t\t//or store it somewhere else for indexedDB cache purposes\n\t\tlibrary.collections.initSecondaryData();\n\t\tlibrary.collections.loaded = true;\n\t});\n\t\n\ttagsPromise.then(function(tagsArray){\n\t\tlog.debug('loadIndexedDBCache tagsD done', 3);\n\t\tlog.debug(tagsArray, 4);\n\t\t//create tagsDump from array of tag objects\n\t\tvar latestVersion = 0;\n\t\tvar tagsVersion = 0;\n\t\tfor(var i = 0; i < tagsArray.length; i++){\n\t\t\tvar tag = new Zotero.Tag(tagsArray[i]);\n\t\t\tlibrary.tags.addTag(tag);\n\t\t\tif(tagsArray[i].version > latestVersion){\n\t\t\t\tlatestVersion = tagsArray[i].version;\n\t\t\t}\n\t\t}\n\t\ttagsVersion = latestVersion;\n\t\tlibrary.tags.tagsVersion = tagsVersion;\n\n\t\t//TODO: add tagsVersion as last version in any of these items?\n\t\t//or store it somewhere else for indexedDB cache purposes\n\t\tlibrary.tags.loaded = true;\n\t});\n\t\n\t\n\t//resolve the overall deferred when all the child deferreds are finished\n\treturn Promise.all([itemsPromise, collectionsPromise, tagsPromise]);\n};\n\nLibrary.prototype.saveIndexedDB = function(){\n\tvar library = this;\n\t\n\tvar saveItemsPromise = library.idbLibrary.updateItems(library.items.itemsArray);\n\tvar saveCollectionsPromise = library.idbLibrary.updateCollections(library.collections.collectionsArray);\n\tvar saveTagsPromise = library.idbLibrary.updateTags(library.tags.tagsArray);\n\t\n\t//resolve the overall deferred when all the child deferreds are finished\n\treturn Promise.all([saveItemsPromise, saveCollectionsPromise, saveTagsPromise]);\n};\n\nmodule.exports = Library;\n\n","'use strict';\n\nvar ItemMaps = require('./ItemMaps.js');\n\nmodule.exports.fieldMap = ItemMaps.fieldMap;\nmodule.exports.typeMap = ItemMaps.typeMap;\nmodule.exports.creatorMap = ItemMaps.creatorMap;","'use strict';\n\nvar log = {};\n\nvar prefLevel = 1;\n\nvar debugOut;\nvar warnOut;\nvar errorOut;\n\nif(typeof console == 'undefined'){\n\tdebugOut = function(){};\n\twarnOut = function(){};\n\terrorOut = function(){};\n} else {\n\tdebugOut = function(s){\n\t\tconsole.log(s);\n\t};\n\twarnOut = function(s){\n\t\tconsole.warn(s);\n\t};\n\terrorOut = function(s){\n\t\tconsole.error(s);\n\t};\n}\n\n\nlog.SetLevel = function(level){\n\tprefLevel = level;\n};\n\nlog.debug = function(debugstring, level){\n\tif(typeof(level) !== 'number'){\n\t\tlevel = 1;\n\t}\n\tif(level <= prefLevel) {\n\t\tdebugOut(debugstring);\n\t}\n};\n\nlog.debugObject = function(obj, level){\n\tif(typeof(level) !== 'number'){\n\t\tlevel = 1;\n\t}\n\tif(level <= prefLevel) {\n\t\tdebugOut(obj);\n\t}\n};\n\nlog.warn = function(warnstring){\n\twarnOut(warnstring);\n};\n\nlog.error = function(errorstring){\n\terrorOut(errorstring);\n};\n\nlog.Logger = function(prefix, llevel=2){\n\tprefLevel = llevel;\n\treturn {\n\t\tdebug: function(debugstring, level){\n\t\t\tif(typeof debugstring == 'string'){\n\t\t\t\treturn log.debug(`${prefix}: ${debugstring}`, level);\n\t\t\t} else {\n\t\t\t\tlog.debug(`${prefix}: \\\\`, level);\n\t\t\t\tlog.debug(debugstring, level);\n\t\t\t\treturn;\n\t\t\t}\n\t\t},\n\t\twarn: function(warnstring){\n\t\t\treturn log.warn(`${prefix}: ${warnstring}`);\n\t\t},\n\t\terror: function(errorstring){\n\t\t\treturn log.error(`${prefix}: ${errorstring}`);\n\t\t}\n\t};\n};\n\nmodule.exports = log;\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:MultiFetch');\n\nvar MultiFetch = function(config={}){\n\tlet defaultConfig = {\n\t\tstart: 0,\n\t\tlimit: 50\n\t};\n\t\n\tthis.config = Z.extend({}, defaultConfig, config);\n\tthis.hasMore = true;\n};\n\nMultiFetch.prototype.next = function(){\n\tif(this.hasMore == false){\n\t\treturn Promise.resolve(null);\n\t}\n\t\n\tlet nconfig = Z.extend({}, this.config);\n\tlet p = Zotero.ajaxRequest(nconfig);\n\tp.then((response)=>{\n\t\tif(response.parsedLinks.hasOwnProperty('next')){\n\t\t\tthis.hasMore = true;\n\t\t} else {\n\t\t\tthis.hasMore = false;\n\t\t}\n\n\t\treturn response;\n\t});\n\n\tnconfig.start = nconfig.start + nconfig.limit;\n\treturn p;\n};\n\nMultiFetch.prototype.fetchAll = function(){\n\tlet results = [];\n\tlet tryNext = () => {\n\t\tif(this.hasMore){\n\t\t\treturn this.next().then((response)=>{\n\t\t\t\tresults = results.concat(response.data);\n\t\t\t}).then(tryNext);\n\t\t} else {\n\t\t\treturn Promise.resolve(results);\n\t\t}\n\t};\n\n\treturn tryNext();\n};\n\nmodule.exports = MultiFetch;\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Net');\n\nvar Deferred = require('deferred');\n/*\n * Make concurrent and sequential network requests, respecting backoff/retry-after\n * headers, and keeping concurrent requests below a certain limit.\n * \n * Push onto the queue individual or arrays of requestConfig objects\n * If there is room for requests and we are not currently backing off:\n *   start a sequential series, or individual request\n * When any request or set of requests finishes, we preprocess the response,\n * looking for backoff/retry-after to obey, and putting sequential responses\n * into an array. We then trigger the next waiting request.\n * \n */\n\nvar Net = function() {\n\tthis.deferredQueue = [];\n\tthis.numRunning = 0;\n\tthis.numConcurrent = 3;\n\tthis.backingOff = false;\n};\n\nNet.prototype.queueDeferred = function(){\n\tvar net = this;\n\tvar d = new Deferred();\n\tnet.deferredQueue.push(d);\n\treturn Promise.resolve(d);\n};\n\nNet.prototype.queueRequest = function(requestObject){\n\tlog.debug('Zotero.Net.queueRequest', 3);\n\tvar net = this;\n\tvar resultPromise;\n\t\n\tif(Array.isArray(requestObject)){\n\t\tresultPromise = net.queueDeferred().then(function(){\n\t\t\tlog.debug('running sequential after queued deferred resolved', 4);\n\t\t\treturn net.runSequential(requestObject);\n\t\t}).then(function(response){\n\t\t\tlog.debug('runSequential done', 3);\n\t\t\tnet.queuedRequestDone();\n\t\t\treturn response;\n\t\t});\n\t}\n\telse {\n\t\tresultPromise = net.queueDeferred().then(function(){\n\t\t\tlog.debug('running concurrent after queued deferred resolved', 4);\n\t\t\treturn net.runConcurrent(requestObject);\n\t\t}).then(function(response){\n\t\t\tlog.debug('done with queuedRequest', 4);\n\t\t\tnet.queuedRequestDone();\n\t\t\treturn response;\n\t\t});\n\t}\n\t\n\tnet.runNext();\n\treturn resultPromise.catch(function(error){\n\t\tlog.error('Error before leaving Zotero.Net');\n\t\tlog.error(error);\n\t});\n};\n\nNet.prototype.runConcurrent = function(requestObject){\n\tlog.debug('Zotero.Net.runConcurrent', 3);\n\treturn this.ajaxRequest(requestObject).then(function(response){\n\t\tlog.debug('done with runConcurrent request', 3);\n\t\treturn response;\n\t});\n};\n\n//run the set of requests serially\n//chaining each request onto the .then of the previous one, after\n//adding the previous response to a responses array that will be\n//returned via promise to the caller when all requests are complete\nNet.prototype.runSequential = function(requestObjects){\n\tlog.debug('Zotero.Net.runSequential', 3);\n\tvar net = this;\n\tvar responses = [];\n\tvar seqPromise = Promise.resolve();\n\t\n\tfor(var i = 0; i < requestObjects.length; i++){\n\t\tvar requestObject = requestObjects[i];\n\t\tseqPromise = seqPromise.then(function(){\n\t\t\tvar p = net.ajaxRequest(requestObject)\n\t\t\t.then(function(response){\n\t\t\t\tlog.debug('pushing sequential response into result array', 3);\n\t\t\t\tresponses.push(response);\n\t\t\t});\n\t\t\treturn p;\n\t\t});\n\t}\n\t\n\treturn seqPromise.then(function(){\n\t\tlog.debug('done with sequential aggregator promise - returning responses', 4);\n\t\treturn responses;\n\t});\n};\n\n//when one concurrent call, or a sequential series finishes, subtract it from the running\n//count and run the next if there is something waiting to be run\nNet.prototype.individualRequestDone = function(response){\n\tlog.debug('Zotero.Net.individualRequestDone', 3);\n\tvar net = this;\n\t\n\t//check if we need to back off before making more requests\n\tvar wait = net.checkDelay(response);\n\tif(wait > 0){\n\t\tvar waitms = wait * 1000;\n\t\tnet.backingOff = true;\n\t\tvar waitExpiration = Date.now() + waitms;\n\t\tif(waitExpiration > net.waitingExpires){\n\t\t\tnet.waitingExpires = waitExpiration;\n\t\t}\n\t\tsetTimeout(net.runNext, waitms);\n\t}\n\t\n\treturn response;\n};\n\nNet.prototype.queuedRequestDone = function(response){\n\tlog.debug('queuedRequestDone', 3);\n\tvar net = this;\n\tnet.numRunning--;\n\tnet.runNext();\n\treturn response;\n};\n\nNet.prototype.runNext = function(){\n\tlog.debug('Zotero.Net.runNext', 3);\n\tvar net = this;\n\tvar nowms = Date.now();\n\t\n\t//check if we're backing off and need to remain backing off,\n\t//or if we should now continue\n\tif(net.backingOff && (net.waitingExpires > (nowms - 100)) ){\n\t\tlog.debug('currently backing off', 3);\n\t\tvar waitms = net.waitingExpires - nowms;\n\t\tsetTimeout(net.runNext, waitms);\n\t\treturn;\n\t}\n\telse if(net.backingOff && (net.waitingExpires <= (nowms - 100))){\n\t\tnet.backingOff = false;\n\t}\n\t\n\t//continue making requests up to the concurrent limit\n\tlog.debug(net.numRunning + '/' + net.numConcurrent + ' Running. ' + net.deferredQueue.length + ' queued.', 3);\n\twhile((net.deferredQueue.length > 0) && (net.numRunning < net.numConcurrent)){\n\t\tnet.numRunning++;\n\t\tvar nextD = net.deferredQueue.shift();\n\t\tnextD.resolve();\n\t\tlog.debug(net.numRunning + '/' + net.numConcurrent + ' Running. ' + net.deferredQueue.length + ' queued.', 3);\n\t}\n};\n\nNet.prototype.checkDelay = function(response){\n\tlog.debug('Zotero.Net.checkDelay', 4);\n\tvar net = this;\n\tvar wait = 0;\n\tif(Array.isArray(response)){\n\t\tfor(var i = 0; i < response.length; i++){\n\t\t\tvar iwait = net.checkDelay(response[i]);\n\t\t\tif(iwait > wait){\n\t\t\t\twait = iwait;\n\t\t\t}\n\t\t}\n\t}\n\telse {\n\t\tif(response.status == 429){\n\t\t\twait = response.retryAfter;\n\t\t}\n\t\telse if(response.backoff){\n\t\t\twait = response.backoff;\n\t\t}\n\t}\n\treturn wait;\n};\n\nNet.prototype.ajaxRequest = function(requestConfig){\n\tlog.debug('Zotero.Net.ajaxRequest', 2);\n\tvar net = this;\n\tvar defaultConfig = {\n\t\ttype:'GET',\n\t\theaders:{\n\t\t\t'Zotero-API-Version': Zotero.config.apiVersion,\n\t\t\t'Content-Type': 'application/json'\n\t\t},\n\t\tsuccess: function(response){\n\t\t\treturn response;\n\t\t},\n\t\terror: function(response){\n\t\t\tlog.error('ajaxRequest rejected:' + response.jqxhr.status + ' - ' + response.jqxhr.responseText);\n\t\t\treturn response;\n\t\t}\n\t\t//cache:false\n\t};\n\t\n\tvar headers = Z.extend({}, defaultConfig.headers, requestConfig.headers);\n\tif(requestConfig.key){\n\t\theaders = Z.extend(headers, {'Zotero-API-Key': requestConfig.key});\n\t\t//headers = Z.extend(headers, {'Authorization': 'Bearer ' + requestConfig.key});\n\t\tdelete requestConfig.key;\n\t}\n\t\n\tvar config = Z.extend({}, defaultConfig, requestConfig);\n\tconfig.headers = headers;\n\tif(typeof config.url == 'object'){\n\t\tconfig.url = Zotero.ajax.apiRequestString(config.url);\n\t}\n\tconfig.url = Zotero.ajax.proxyWrapper(config.url, config.type);\n\t\n\tif(!config.url){\n\t\tthrow 'No url specified in Zotero.Net.ajaxRequest';\n\t}\n\t//rename success/error callbacks so J.ajax does not actually use them\n\t//and we can use them as es6 promise result functions with expected\n\t//single value arguments\n\tconfig.zsuccess = config.success;\n\tconfig.zerror = config.error;\n\tdelete config.success;\n\tdelete config.error;\n\t\n\tlog.debug('AJAX config', 4);\n\tlog.debug(config, 4);\n\tvar ajaxpromise = new Promise(function(resolve, reject){\n\t\tnet.ajax(config)\n\t\t.then(function(request){\n\t\t\tvar data;\n\n\t\t\tif(request.responseType == 'json'\n\t\t\t\t|| (request.responseType === '' && request.getResponseHeader('content-type') === 'application/json')\n\t\t\t) {\n\t\t\t\ttry{\n\t\t\t\t\t\tdata = JSON.parse(request.response);\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tdata = request.response;\n\t\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdata = request.response;\n\t\t\t}\n\t\t\t\n\t\t\tvar r = new Zotero.ApiResponse({\n\t\t\t\tjqxhr: request,\n\t\t\t\tdata: data,\n\t\t\t\ttextStatus: request.responseText\n\t\t\t});\n\t\t\tresolve(r);\n\t\t}, function(request){\n\t\t\tvar r = new Zotero.ApiResponse({\n\t\t\t\tjqxhr: request,\n\t\t\t\ttextStatus: request.responseText,\n\t\t\t\tisError: true\n\t\t\t});\n\t\t\treject(r);\n\t\t});\n\t})\n\t.then(net.individualRequestDone.bind(net))\n\t.then(function(response){\n\t\t//now that we're done handling, reject\n\t\tif(response.isError){\n\t\t\tlog.error('re-throwing ApiResponse that was a rejection');\n\t\t\tthrow response;\n\t\t}\n\t\treturn response;\n\t})\n\t.then(config.zsuccess, config.zerror);\n\t\n\treturn ajaxpromise;\n};\n\nNet.prototype.ajax = function(config){\n\tconfig = Zotero.extend({type:'GET'}, config);\n\tvar promise = new Promise(function(resolve, reject){\n\t\tvar req = new XMLHttpRequest();\n\t\tvar uri = config.url;\n\t\treq.open(config.type, uri);\n\t\t\n\t\tif(config.headers){\n\t\t\tObject.keys(config.headers).forEach(function(key){\n\t\t\t\tvar val = config.headers[key];\n\t\t\t\treq.setRequestHeader(key, val);\n\t\t\t});\n\t\t}\n\n\t\treq.send(config.data);\n\n\t\treq.onload = function(){\n\t\t\tlog.debug('XMLHttpRequest done', 4);\n\t\t\tlog.debug(req, 4);\n\t\t\tif (req.status >= 200 && req.status < 300) {\n\t\t\t\tlog.debug('200-300 response: resolving Net.ajax promise', 3);\n\t\t\t\t// Performs the function \"resolve\" when this.status is equal to 2xx\n\t\t\t\tresolve(req);\n\t\t\t} else {\n\t\t\t\tlog.debug('not 200-300 response: rejecting Net.ajax promise', 3);\n\t\t\t\t// Performs the function \"reject\" when this.status is different than 2xx\n\t\t\t\treject(req);\n\t\t\t}\n\t\t};\n\t\treq.onerror = function() {\n\t\t\treject(req);\n\t\t};\n\t});\n\n\treturn promise;\n};\n\nmodule.exports = new Net();\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Preferences');\n\nvar Preferences = function(store, idString) {\n\tthis.store = store;\n\tthis.idString = idString;\n\tthis.preferencesObject = {};\n\tthis.defaults = {\n\t\tdebug_level: 3, //lower level is higher priority\n\t\tdebug_log: true,\n\t\tdebug_mock: false,\n\t\tlistDisplayedFields: ['title', 'creator', 'dateModified'],\n\t\tshowAutomaticTags: false,//tagType:1 is automatic, tagType:0 was added by user\n\t\titemsPerPage: 25,\n\t\torder: 'title',\n\t\ttitle: 'asc'\n\t};\n\tthis.load();\n};\n\nPreferences.prototype.setPref = function(key, value) {\n\tvar preferences = this;\n\tpreferences.preferencesObject[key] = value;\n\tpreferences.persist();\n};\n\nPreferences.prototype.setPrefs = function(newPrefs) {\n\tvar preferences = this;\n\tif(typeof(newPrefs) != 'object') {\n\t\tthrow new Error('Preferences must be an object');\n\t}\n\tpreferences.preferencesObject = newPrefs;\n\tpreferences.persist();\n};\n\nPreferences.prototype.getPref = function(key){\n\tvar preferences = this;\n\tif(preferences.preferencesObject[key]){\n\t\treturn preferences.preferencesObject[key];\n\t}\n\telse if(preferences.defaults[key]){\n\t\treturn preferences.defaults[key];\n\t}\n\telse {\n\t\treturn null;\n\t}\n};\n\nPreferences.prototype.getPrefs = function(){\n\tvar preferences = this;\n\treturn preferences.preferencesObject;\n};\n\nPreferences.prototype.persist = function(){\n\tvar preferences = this;\n\tvar storageString = 'preferences_' + preferences.idString;\n\tpreferences.store[storageString] = JSON.stringify(preferences.preferencesObject);\n};\n\nPreferences.prototype.load = function(){\n\tvar preferences = this;\n\tvar storageString = 'preferences_' + preferences.idString;\n\tvar storageObjectString = preferences.store[storageString];\n\tif(!storageObjectString){\n\t\tpreferences.preferencesObject = {};\n\t}\n\telse {\n\t\tpreferences.preferencesObject = JSON.parse(storageObjectString);\n\t}\n};\n\nmodule.exports = Preferences;\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Search');\n\nmodule.exports = function(){\n\tthis.instance = 'Zotero.Search';\n\tthis.searchObject = {};\n};\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Searches');\n\nmodule.exports = function(){\n\tthis.instance = 'Zotero.Searches';\n\tthis.searchObjects = {};\n\tthis.syncState = {\n\t\tearliestVersion: null,\n\t\tlatestVersion: null\n\t};\n};\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Tag');\n\nmodule.exports = function (tagObj) {\n\tthis.instance = 'Zotero.Tag';\n\tthis.color = null;\n\tthis.version = 0;\n\tif( typeof tagObj == 'object'){\n\t\tthis.parseJsonTag(tagObj);\n\t} else if(typeof tagObj == 'string') {\n\t\tthis.parseJsonTag(this.templateApiObj(tagObj));\n\t} else {\n\t\tthis.parseJsonTag(this.tamplateApiObj(''));\n\t}\n};\n\nmodule.exports.prototype = new Zotero.ApiObject();\n\nmodule.exports.prototype.parseJsonTag = function(tagObj) {\n\tvar tag = this;\n\ttag.apiObj = Z.extend({}, tagObj);\n\ttag.urlencodedtag = encodeURIComponent(tag.apiObj.tag);\n\ttag.version = tag.apiObj.version;\n};\n\nmodule.exports.prototype.templateApiObj = function(tagString) {\n\treturn {\n\t\ttag: tagString,\n\t\tlinks: {},\n\t\tmeta: {\n\t\t\ttype:0,\n\t\t\tnumItems:1\n\t\t}\n\t};\n};\n\nmodule.exports.prototype.tagComparer = function(){\n\tif(Intl){\n\t\tvar collator = new Intl.Collator();\n\t\treturn function(a, b){\n\t\t\treturn collator.compare(a.apiObj.tag, b.apiObj.tag);\n\t\t};\n\t} else {\n\t\treturn function(a, b) {\n\t\t\tif(a.apiObj.tag.toLocaleLowerCase() == b.apiObj.tag.toLocaleLowerCase()){\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tif(a.apiObj.tag.toLocaleLowerCase() < b.apiObj.tag.toLocaleLowerCase()){\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\treturn 1;\n\t\t};\n\t}\n};\n\nmodule.exports.prototype.set = function(key, val){\n\tvar tag = this;\n\t\n\tif(key in tag.apiObj){\n\t\ttag.apiObj[key] = val;\n\t}\n\tif(key in tag.apiObj.meta){\n\t\ttag.apiObj.meta[key] = val;\n\t}\n\t\n\tswitch (key) {\n\t\tcase 'tagVersion':\n\t\tcase 'version':\n\t\t\ttag.version = val;\n\t\t\ttag.apiObj.version = val;\n\t\t\tbreak;\n\t}\n\t\n\treturn tag;\n};\n\nmodule.exports.prototype.get = function(key){\n\tvar tag = this;\n\n\tif(key in tag.apiObj){\n\t\treturn tag.apiObj[key];\n\t}\n\tif(key in tag.apiObj.meta){\n\t\treturn tag.apiObj.meta[key];\n\t}\n\n\tswitch (key) {\n\t\tcase 'tagVersion':\n\t\tcase 'version':\n\t\t\treturn tag.version;\n\t}\n\n\treturn null;\n};\n\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Tags');\n\nmodule.exports = function(jsonBody){\n\tthis.instance = 'Zotero.Tags';\n\t//represent collections as array for ordering purposes\n\tthis.tagsVersion = 0;\n\tthis.syncState = {\n\t\tearliestVersion: null,\n\t\tlatestVersion: null\n\t};\n\tthis.displayTagsArray = [];\n\tthis.displayTagsUrl = '';\n\tthis.tagObjects = {};\n\tthis.tagsArray = [];\n\tthis.loaded = false;\n\tif(jsonBody){\n\t\tthis.addTagsFromJson(jsonBody);\n\t}\n};\n\nmodule.exports.prototype = new Zotero.Container();\n\nmodule.exports.prototype.addTag = function(tag){\n\tvar tags = this;\n\ttags.tagObjects[tag.apiObj.tag] = tag;\n\ttags.tagsArray.push(tag);\n\tif(tags.owningLibrary){\n\t\ttag.associateWithLibrary(tags.owningLibrary);\n\t}\n};\n\nmodule.exports.prototype.getTag = function(tagname){\n\tvar tags = this;\n\tif(tags.tagObjects.hasOwnProperty(tagname)){\n\t\treturn this.tagObjects[tagname];\n\t}\n\treturn null;\n};\n\nmodule.exports.prototype.removeTag = function(tagname){\n\tvar tags = this;\n\tdelete tags.tagObjects[tagname];\n\ttags.updateSecondaryData();\n};\n\nmodule.exports.prototype.removeTags = function(tagnames){\n\tvar tags = this;\n\ttagnames.forEach(function(tagname){\n\t\tdelete tags.tagObjects[tagname];\n\t});\n\ttags.updateSecondaryData();\n};\n\nmodule.exports.prototype.plainTagsList = function(tagsArray){\n\tlog.debug('Zotero.Tags.plainTagsList', 3);\n\tvar plainList = [];\n\ttagsArray.forEach(function(tag){\n\t\tplainList.push(tag.apiObj.tag);\n\t});\n\treturn plainList;\n};\n\nmodule.exports.prototype.clear = function(){\n\tlog.debug('Zotero.Tags.clear', 3);\n\tthis.tagsVersion = 0;\n\tthis.syncState.earliestVersion = null;\n\tthis.syncState.latestVersion = null;\n\tthis.displayTagsArray = [];\n\tthis.displayTagsUrl = '';\n\tthis.tagObjects = {};\n\tthis.tagsArray = [];\n};\n\nmodule.exports.prototype.updateSecondaryData = function(){\n\tlog.debug('Zotero.Tags.updateSecondaryData', 3);\n\tvar tags = this;\n\ttags.tagsArray = [];\n\tObject.keys(tags.tagObjects).forEach(function(key){\n\t\tvar val = tags.tagObjects[key];\n\t\ttags.tagsArray.push(val);\n\t});\n\ttags.tagsArray.sort(Zotero.Tag.prototype.tagComparer());\n\tvar plainList = tags.plainTagsList(tags.tagsArray);\n\tplainList.sort(Zotero.Library.prototype.comparer());\n\ttags.plainList = plainList;\n};\n\nmodule.exports.prototype.updateTagsVersion = function(tagsVersion) {\n\tvar tags = this;\n\tObject.keys(tags.tagObjects).forEach(function(key){\n\t\tvar tag = tags.tagObjects[key];\n\t\ttag.set('version', tagsVersion);\n\t});\n};\n\nmodule.exports.prototype.rebuildTagsArray = function() {\n\tvar tags = this;\n\ttags.tagsArray = [];\n\tObject.keys(tags.tagObjects).forEach(function(key){\n\t\tvar tag = tags.tagObjects[key];\n\t\ttags.tagsArray.push(tag);\n\t});\n};\n\nmodule.exports.prototype.addTagsFromJson = function(jsonBody){\n\tlog.debug('Zotero.Tags.addTagsFromJson', 3);\n\tvar tags = this;\n\tvar tagsAdded = [];\n\tjsonBody.forEach(function(tagObj){\n\t\tvar tag = new Zotero.Tag(tagObj);\n\t\ttags.addTag(tag);\n\t\ttagsAdded.push(tag);\n\t});\n\treturn tagsAdded;\n};\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Url');\n\n// Url.js - construct certain urls and links locally that may depend on the\n// current website's routing scheme etc. Not necessarily pointing to zotero.org\n// - href for a particular item's local representation\n// - link with appropriate text, to download file or view framed snapshot\n// - href for file download/view, depending on whether config says to download\n// directly from the api, or to proxy it\n// - displayable string describing the attachment file (attachmentFileDetails)\n// - list of urls for supported export formats\n// \n\nvar Url = {};\n\n//locally construct a url for the item on the current website\nUrl.itemHref = function(item){\n\tvar href = '';\n\thref += Zotero.config.librarySettings.libraryPathString + '/itemKey/' + item.get('key');\n\treturn href;\n};\n\n//construct a download link for an item's enclosure file that takes into\n//account size and whether the file is a snapshot\nUrl.attachmentDownloadLink = function(item){\n\tvar retString = '';\n\tvar downloadUrl = item.attachmentDownloadUrl;\n\tvar contentType = item.get('contentType');\n\t\n\tif(item.apiObj.links && item.apiObj.links['enclosure']){\n\t\tif(!item.apiObj.links['enclosure']['length'] && item.isSnapshot()){\n\t\t\t//snapshot: redirect to view\n\t\t\tretString += '<a href=\"' + downloadUrl + '\">' + 'View Snapshot</a>';\n\t\t}\n\t\telse{\n\t\t\t//file: offer download\n\t\t\tvar enctype = Zotero.utils.translateMimeType(item.apiObj.links['enclosure'].type);\n\t\t\tvar enc = item.apiObj.links['enclosure'];\n\t\t\tvar filesize = parseInt(enc['length'], 10);\n\t\t\tvar filesizeString = '' + filesize + ' B';\n\t\t\tif(filesize > 1073741824){\n\t\t\t\tfilesizeString = '' + (filesize / 1073741824).toFixed(1) + ' GB';\n\t\t\t}\n\t\t\telse if(filesize > 1048576){\n\t\t\t\tfilesizeString = '' + (filesize / 1048576).toFixed(1) + ' MB';\n\t\t\t}\n\t\t\telse if(filesize > 1024){\n\t\t\t\tfilesizeString = '' + (filesize / 1024).toFixed(1) + ' KB';\n\t\t\t}\n\t\t\tlog.debug(enctype, 3);\n\t\t\tretString += '<a href=\"' + downloadUrl + '\">';\n\t\t\tif(enctype == 'undefined' || enctype === '' || typeof enctype == 'undefined'){\n\t\t\t\tretString += filesizeString + '</a>';\n\t\t\t}\n\t\t\telse{\n\t\t\t\tretString += enctype + ', ' + filesizeString + '</a>';\n\t\t\t}\n\t\t\treturn retString;\n\t\t}\n\t}\n\treturn retString;\n};\n\nUrl.attachmentDownloadUrl = function(item){\n\tif(item.apiObj.links && item.apiObj.links['enclosure']){\n\t\tif(Zotero.config.proxyDownloads){\n\t\t\t//we have a proxy for downloads at baseDownloadUrl so just pass an itemkey to that\n\t\t\treturn Url.wwwDownloadUrl(item);\n\t\t}\n\t\telse {\n\t\t\treturn Url.apiDownloadUrl(item);\n\t\t}\n\t}\n\treturn false;\n};\n\nUrl.apiDownloadUrl = function(item){\n\tif(item.apiObj.links['enclosure']){\n\t\treturn item.apiObj.links['enclosure']['href'];\n\t}\n\treturn false;\n};\n\nUrl.proxyDownloadUrl = function(item){\n\tif(item.apiObj.links['enclosure']){\n\t\tif(Zotero.config.proxyDownloads){\n\t\t\treturn Zotero.config.baseDownloadUrl + '?itemkey=' + item.get('key');\n\t\t}\n\t\telse{\n\t\t\treturn Url.apiDownloadUrl(item);\n\t\t}\n\t}\n\telse {\n\t\treturn false;\n\t}\n};\n\nUrl.wwwDownloadUrl = function(item){\n\tif(item.apiObj.links['enclosure']){\n\t\treturn Zotero.config.baseZoteroWebsiteUrl + Zotero.config.librarySettings.libraryPathString + '/' + item.get('key') + '/file/view';\n\t}\n\telse {\n\t\treturn false;\n\t}\n};\n\nUrl.publicationsDownloadUrl = function(item){\n\tif(item.apiObj.links['enclosure']){\n\t\treturn item.apiObj.links['enclosure']['href'];\n\t}\n\treturn false;\n};\n\nUrl.attachmentFileDetails = function(item){\n\t//file: offer download\n\tif(!item.apiObj.links['enclosure']) return '';\n\tvar enctype = Zotero.utils.translateMimeType(item.apiObj.links['enclosure'].type);\n\tvar enc = item.apiObj.links['enclosure'];\n\tvar filesizeString = '';\n\tif(enc['length']){\n\t\tvar filesize = parseInt(enc['length'], 10);\n\t\tfilesizeString = '' + filesize + ' B';\n\t\tif(filesize > 1073741824){\n\t\t\tfilesizeString = '' + (filesize / 1073741824).toFixed(1) + ' GB';\n\t\t}\n\t\telse if(filesize > 1048576){\n\t\t\tfilesizeString = '' + (filesize / 1048576).toFixed(1) + ' MB';\n\t\t}\n\t\telse if(filesize > 1024){\n\t\t\tfilesizeString = '' + (filesize / 1024).toFixed(1) + ' KB';\n\t\t}\n\t\treturn '(' + enctype + ', ' + filesizeString + ')';\n\t}\n\telse {\n\t\treturn '(' + enctype + ')';\n\t}\n};\n\nUrl.userWebLibrary = function(slug) {\n\treturn [Zotero.config.baseWebsiteUrl, slug, 'items'].join('/');\n};\n\nUrl.groupWebLibrary = function(group) {\n\tif(group.type == 'Private'){\n\t\treturn [Zotero.config.baseWebsiteUrl, 'groups', group.get('id'), 'items'].join('/');\n\t}\n\telse {\n\t\treturn [Zotero.config.baseWebsiteUrl, 'groups', Zotero.utils.slugify(group.get('name')), 'items'].join('/');\n\t}\n};\n\nUrl.exportUrls = function(config){\n\tlog.debug('Zotero.url.exportUrls', 3);\n\tvar exportUrls = {};\n\tvar exportConfig = {};\n\tZotero.config.exportFormats.forEach(function(format){\n\t\texportConfig = Z.extend(config, {'format':format});\n\t\texportUrls[format] = Zotero.ajax.apiRequestUrl(exportConfig) + Zotero.ajax.apiQueryString({format:format, limit:'25'});\n\t});\n\treturn exportUrls;\n};\n\nUrl.relationUrl = function(libraryType, libraryID, itemKey){\n\tswitch(libraryType){\n\t\tcase 'group':\n\t\t\treturn `http://zotero.org/groups/${libraryID}/items/${itemKey}`;\n\t\tcase 'user':\n\t\t\treturn `http://zotero.org/users/${libraryID}/items/${itemKey}`;\n\t\tcase 'publications':\n\t\t\treturn `http://zotero.org/users/${libraryID}/publications/items/${itemKey}`;\n\t}\n\treturn '';\n};\n\nmodule.exports = Url;","'use strict';\n\nmodule.exports = function () {this.instance = 'Zotero.User';};\nmodule.exports.prototype = new Zotero.ApiObject();\nmodule.exports.prototype.loadObject = function(ob){\n\tthis.title = ob.title;\n\tthis.author = ob.author;\n\tthis.tagID = ob.tagID;\n\tthis.published = ob.published;\n\tthis.updated = ob.updated;\n\tthis.links = ob.links;\n\tthis.numItems = ob.numItems;\n\tthis.items = ob.items;\n\tthis.tagType = ob.tagType;\n\tthis.modified = ob.modified;\n\tthis.added = ob.added;\n\tthis.key = ob.key;\n};\n\nmodule.exports.prototype.parseXmlUser = function (tel) {\n\tthis.parseXmlEntry(tel);\n\t\n\tvar tagEl = tel.find('content>tag');\n\tif(tagEl.length !== 0){\n\t\tthis.tagKey = tagEl.attr('key');// find(\"zapi\\\\:itemID\").text();\n\t\tthis.libraryID = tagEl.attr('libraryID');\n\t\tthis.tagName = tagEl.attr('name');\n\t\tthis.dateAdded = tagEl.attr('dateAdded');\n\t\tthis.dateModified = tagEl.attr('dateModified');\n\t}\n\t\n};\n","'use strict';\n\nvar log = require('./Log.js').Logger('libZotero:Utils');\n\nvar Utils = {\n\trandomString:function(len, chars) {\n\t\tif (!chars) {\n\t\t\tchars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\n\t\t}\n\t\tif (!len) {\n\t\t\tlen = 8;\n\t\t}\n\t\tvar randomstring = '';\n\t\tfor (var i=0; i<len; i++) {\n\t\t\tvar rnum = Math.floor(Math.random() * chars.length);\n\t\t\trandomstring += chars.substring(rnum,rnum+1);\n\t\t}\n\t\treturn randomstring;\n\t},\n\t\n\tgetKey: function() {\n\t\tvar baseString = '23456789ABCDEFGHIJKMNPQRSTUVWXZ';\n\t\treturn Utils.randomString(8, baseString);\n\t},\n\t\n\tslugify: function(name){\n\t\tvar slug = name.trim();\n\t\tslug = slug.toLowerCase();\n\t\tslug = slug.replace( /[^a-z0-9 ._-]/g , '');\n\t\tslug = slug.replace(/\\s/g, '_');\n\t\t\n\t\treturn slug;\n\t},\n\t\n\tprependAutocomplete: function(pre, source){\n\t\tlog.debug('Zotero.utils.prependAutocomplete', 3);\n\t\tlog.debug('prepend match: ' + pre, 4);\n\t\tvar satisfy;\n\t\tif(!source){\n\t\t\tlog.warn('source is not defined');\n\t\t}\n\t\tif(pre === ''){\n\t\t\tsatisfy = source.slice(0);\n\t\t\treturn satisfy;\n\t\t}\n\t\tvar plen = pre.length;\n\t\tvar plower = pre.toLowerCase();\n\t\tsatisfy = source.map(function(n){\n\t\t\tif(n.substr(0, plen).toLowerCase() == plower){\n\t\t\t\treturn n;\n\t\t\t}\n\t\t\telse{\n\t\t\t\treturn null;\n\t\t\t}\n\t\t});\n\t\treturn satisfy;\n\t},\n\t\n\tmatchAnyAutocomplete: function(pre, source){\n\t\tlog.debug('Zotero.utils.matchAnyAutocomplete', 3);\n\t\tlog.debug('matchAny match: ' + pre, 4);\n\t\tvar satisfy;\n\t\tif(!source){\n\t\t\tlog.warn('source is not defined');\n\t\t}\n\t\tif(pre === ''){\n\t\t\tsatisfy = source.slice(0);\n\t\t\treturn satisfy;\n\t\t}\n\t\tvar plower = pre.toLowerCase();\n\t\tsatisfy = source.map(function(n){\n\t\t\tif(n.toLowerCase().indexOf(plower) != -1){\n\t\t\t\treturn n;\n\t\t\t}\n\t\t\telse{\n\t\t\t\treturn null;\n\t\t\t}\n\t\t});\n\t\treturn satisfy;\n\t},\n\t\n\tlibraryString: function(type, libraryID){\n\t\tvar lstring = '';\n\t\tif(type == 'user') lstring = 'u';\n\t\telse if(type == 'group') lstring = 'g';\n\t\telse if(type == 'publications') lstring = 'p';\n\t\tlstring += libraryID;\n\t\treturn lstring;\n\t},\n\t\n\tparseLibString: function(libraryString){\n\t\tvar type;\n\t\tvar libraryID;\n\t\tif(libraryString.charAt(0) == 'u'){\n\t\t\ttype = 'user';\n\t\t}\n\t\telse if(libraryString.charAt(0) == 'g'){\n\t\t\ttype = 'group';\n\t\t}\n\t\telse if(libraryString.charAt(0) == 'p'){\n\t\t\ttype = 'publications';\n\t\t}\n\t\telse{\n\t\t\tthrow new Error('unexpected type character in libraryString');\n\t\t}\n\t\tlibraryID = parseInt(libraryString.substring(1), 10);\n\t\tif(isNaN(libraryID)){\n\t\t\tthrow new Error('NaN libraryID');\n\t\t}\n\t\treturn {libraryType:type, libraryID: libraryID};\n\t},\n\t\n\t//return true if retrieved more than lifetime minutes ago\n\tstale: function(retrievedDate, lifetime){\n\t\tvar now = Date.now(); //current local time\n\t\tvar elapsed = now.getTime() - retrievedDate.getTime();\n\t\tif((elapsed / 60000) > lifetime){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\t\n\tentityify: function(str){\n\t\tvar character = {\n\t\t\t'<' : '&lt;',\n\t\t\t'>' : '&gt;',\n\t\t\t'&' : '&amp;',\n\t\t\t'\"' : '&quot;'\n\t\t};\n\t\treturn str.replace(/[<>&\"]/g, function(c) {\n\t\t\treturn character[c];\n\t\t});\n\t},\n\t\n\tparseApiDate: function(datestr){\n\t\t//var parsems = Date.parse(datestr);\n\t\t\n\t\tvar re = /([0-9]+)-([0-9]+)-([0-9]+)T([0-9]+):([0-9]+):([0-9]+)Z/;\n\t\tvar matches = re.exec(datestr);\n\t\tif(matches === null){\n\t\t\tlog.debug(`error parsing api date: ${datestr}`, 2);\n\t\t\treturn null;\n\t\t}\n\t\telse{\n\t\t\tvar date = new Date(Date.UTC(matches[1], matches[2]-1, matches[3], matches[4], matches[5], matches[6]));\n\t\t\treturn date;\n\t\t}\n\t},\n\t\n\treadCookie: function(name) {\n\t\tvar nameEQ = name + '=';\n\t\tvar ca = document.cookie.split(';');\n\t\tfor(var i=0;i < ca.length;i++) {\n\t\t\tvar c = ca[i];\n\t\t\twhile (c.charAt(0)==' ') c = c.substring(1,c.length);\n\t\t\tif (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length,c.length);\n\t\t}\n\t\treturn null;\n\t},\n\t\n\t/**\n\t * Translate common mimetypes to user friendly versions\n\t *\n\t * @param string $mimeType\n\t * @return string\n\t */\n\ttranslateMimeType: function(mimeType)\n\t{\n\t\tswitch (mimeType) {\n\t\t\tcase 'text/html':\n\t\t\t\treturn 'html';\n\t\t\t\n\t\t\tcase 'application/pdf':\n\t\t\tcase 'application/x-pdf':\n\t\t\tcase 'application/acrobat':\n\t\t\tcase 'applications/vnd.pdf':\n\t\t\tcase 'text/pdf':\n\t\t\tcase 'text/x-pdf':\n\t\t\t\treturn 'pdf';\n\t\t\t\n\t\t\tcase 'image/jpg':\n\t\t\tcase 'image/jpeg':\n\t\t\t\treturn 'jpg';\n\t\t\t\n\t\t\tcase 'image/gif':\n\t\t\t\treturn 'gif';\n\t\t\t\n\t\t\tcase 'application/msword':\n\t\t\tcase 'application/doc':\n\t\t\tcase 'application/vnd.msword':\n\t\t\tcase 'application/vnd.ms-word':\n\t\t\tcase 'application/winword':\n\t\t\tcase 'application/word':\n\t\t\tcase 'application/x-msw6':\n\t\t\tcase 'application/x-msword':\n\t\t\t\treturn 'doc';\n\t\t\t\n\t\t\tcase 'application/vnd.oasis.opendocument.text':\n\t\t\tcase 'application/x-vnd.oasis.opendocument.text':\n\t\t\t\treturn 'odt';\n\t\t\t\n\t\t\tcase 'video/flv':\n\t\t\tcase 'video/x-flv':\n\t\t\t\treturn 'flv';\n\t\t\t\n\t\t\tcase 'image/tif':\n\t\t\tcase 'image/tiff':\n\t\t\tcase 'image/x-tif':\n\t\t\tcase 'image/x-tiff':\n\t\t\tcase 'application/tif':\n\t\t\tcase 'application/x-tif':\n\t\t\tcase 'application/tiff':\n\t\t\tcase 'application/x-tiff':\n\t\t\t\treturn 'tiff';\n\t\t\t\n\t\t\tcase 'application/zip':\n\t\t\tcase 'application/x-zip':\n\t\t\tcase 'application/x-zip-compressed':\n\t\t\tcase 'application/x-compress':\n\t\t\tcase 'application/x-compressed':\n\t\t\tcase 'multipart/x-zip':\n\t\t\t\treturn 'zip';\n\t\t\t\t\n\t\t\tcase 'video/quicktime':\n\t\t\tcase 'video/x-quicktime':\n\t\t\t\treturn 'mov';\n\t\t\t\t\n\t\t\tcase 'video/avi':\n\t\t\tcase 'video/msvideo':\n\t\t\tcase 'video/x-msvideo':\n\t\t\t\treturn 'avi';\n\t\t\t\t\n\t\t\tcase 'audio/wav':\n\t\t\tcase 'audio/x-wav':\n\t\t\tcase 'audio/wave':\n\t\t\t\treturn 'wav';\n\t\t\t\t\n\t\t\tcase 'audio/aiff':\n\t\t\tcase 'audio/x-aiff':\n\t\t\tcase 'sound/aiff':\n\t\t\t\treturn 'aiff';\n\t\t\t\n\t\t\tcase 'text/plain':\n\t\t\t\treturn 'plain text';\n\t\t\tcase 'application/rtf':\n\t\t\t\treturn 'rtf';\n\t\t\t\t\n\t\t\tdefault:\n\t\t\t\treturn mimeType;\n\t\t}\n\t},\n\n\t/**\n\t * Get the permissions a key has for a library\n\t * if no key is passed use the currently set key for the library\n\t *\n\t * @param int|string $userID\n\t * @param string $key\n\t * @return array $keyPermissions\n\t */\n\tgetKeyPermissions: function(userID, key) {\n\t\tif(!userID){\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tif(!key){\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tvar urlconfig = {'target':'key', 'apiKey':key, 'libraryType':''};\n\t\t\n\t\treturn Zotero.ajaxRequest(urlconfig)\n\t\t.then(function(response){\n\t\t\tvar keyObject = JSON.parse(response.data);\n\t\t\treturn keyObject;\n\t\t});\n\t},\n\n\t/**\n\t * Given a query string, parse keys/values into an object\n\t **/\n\tparseQuery: function(query) {\n\t\tlog.debug('parseQuery');\n\t\tlog.debug(query);\n\t\tvar params = {};\n\t\tvar match;\n\t\tvar pl = /\\+/g;  // Regex for replacing addition symbol with a space\n\t\tvar search = /([^&=]+)=?([^&]*)/g;\n\t\tvar decode = function (s) {\n\t\t\treturn decodeURIComponent(s.replace(pl, ' '));\n\t\t};\n\n\t\twhile(match = search.exec(query)) {\n\t\t\tparams[decode(match[1])] = decode(match[2]);\n\t\t}\n\t\treturn params;\n\t},\n\n\tbuildQuery: function(params = {}) {\n\t\tlet q = '?';\n\t\tfor(let p in params) {\n\t\t\tq += `&${encodeURIComponent(p)}=${encodeURIComponent(params[p])}`;\n\t\t}\n\t\treturn q;\n\t},\n\n\t//extract the section of a url between ? and #\n\tquerystring: function(href) {\n\t\tif(href.indexOf('?') == -1) {\n\t\t\treturn '';\n\t\t}\n\t\tvar hashindex = (href.indexOf('#') != -1) ? href.indexOf('#') : undefined;\n\t\tvar q = href.substring(href.indexOf('?') + 1, hashindex);\n\t\treturn q;\n\t}\n};\n\nmodule.exports = Utils;","// use strict;\nif(typeof window === 'undefined') {\n\tvar globalScope = global;\n\tif(!globalScope.XMLHttpRequest) {\n\t\tglobalScope.XMLHttpRequest = require('w3c-xmlhttprequest').XMLHttpRequest;\n\t}\n} else {\n\tvar globalScope = window;\n\tif(typeof Promise === 'undefined') {\n\t\trequire('es6-promise').polyfill();\n\t}\n}\n\nvar Zotero = require('./Base.js');\nglobalScope.Zotero = globalScope.Z = Zotero;\nZotero.Cache = require('./Cache.js');\nZotero.Ajax = Zotero.ajax = require('./Ajax.js');\nZotero.ApiObject = require('./ApiObject.js');\nZotero.ApiResponse = require('./ApiResponse.js');\nZotero.Net = Zotero.net = require('./Net.js');\nZotero.Library = require('./Library.js');\nZotero.Container = require('./Container');\nZotero.Collections = require('./Collections.js');\nZotero.Items = require('./Items.js');\nZotero.Tags = require('./Tags.js');\nZotero.Groups = require('./Groups.js');\nZotero.Searches = require('./Searches.js');\nZotero.Deleted = require('./Deleted.js');\nZotero.Collection = require('./Collection.js');\nZotero.Localizations = Zotero.localizations = require('./Localizations.js');\nZotero.Item = require('./Item.js');\nZotero.Tag = require('./Tag.js');\nZotero.Search = require('./Search.js');\nZotero.Group = require('./Group.js');\nZotero.User = require('./User.js');\nZotero.Utils = Zotero.utils = require('./Utils.js');\nZotero.Url = Zotero.url = require('./Url.js');\nZotero.File = Zotero.file = require('./File.js');\nZotero.Idb = require('./Idb.js');\nZotero.Preferences = require('./Preferences.js');\nZotero.Client = require('./Client.js');\nZotero.MultiFetch = require('./MultiFetch.js');\n\nmodule.exports = Zotero;"]}